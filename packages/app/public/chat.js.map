{"version":3,"sources":["webpack://MCS/webpack/universalModuleDefinition","webpack://MCS/webpack/bootstrap","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/belter/src/device.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/@babel/runtime/helpers/esm/extends.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zalgo-promise/src/utils.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zalgo-promise/src/exceptions.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zalgo-promise/src/flush.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zalgo-promise/src/promise.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/cross-domain-utils/src/util.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/cross-domain-utils/src/constants.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/cross-domain-utils/src/utils.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/cross-domain-utils/src/types.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/cross-domain-utils/src/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/cross-domain-safe-weakmap/src/native.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/cross-domain-safe-weakmap/src/util.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/cross-domain-safe-weakmap/src/weakmap.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/belter/src/util.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/belter/src/constants.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/belter/src/dom.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/belter/src/storage.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/belter/src/experiment.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/belter/src/global.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/belter/src/http.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/belter/src/types.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/belter/src/decorators.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/belter/src/css.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/belter/src/test.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/belter/src/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/conf/config.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/conf/constants.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/conf/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/global.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/lib/hello.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/lib/compat.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/lib/windows.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/lib/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/constants.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/common.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/serializers/array.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/serializers/boolean.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/serializers/date.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/serializers/error.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/serializers/function.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/serializers/number.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/serializers/object.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/serializers/promise.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/serializers/regex.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/serializers/string.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/serializers/null.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/serializers/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/serialize.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/deserialize.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/types.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/universal-serialize/src/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/bridge/bridge.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/bridge/common.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/bridge/child.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/bridge/parent.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/bridge/setup.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/bridge/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/serialize/window.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/serialize/function.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/serialize/promise.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/serialize/serialize.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/serialize/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/drivers/send/strategies.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/drivers/send/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/drivers/listeners.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/drivers/receive/types.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/drivers/receive/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/drivers/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/public/on.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/public/send.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/public/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/setup.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/types.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/clean.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/post-robot/src/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/lib/global.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/lib/serialize.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/lib/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/constants.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/child/props.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/child/window.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/child/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/parent/drivers.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/parent/props.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/parent/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/delegate/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/drivers/react.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/drivers/vue.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/drivers/angular.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/drivers/angular2.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/drivers/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/component/validate.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/component/templates/container.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/component/templates/component.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/component/templates/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/component/props.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/component/component.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/component/index.js","webpack://MCS//Users/mcs/Documents/whatsapp-widget/node_modules/zoid/src/index.js","webpack://MCS/./src/chat/template/container.jsx","webpack://MCS/./src/chat/component.jsx","webpack://MCS/./src/index.js"],"names":["getUserAgent","window","navigator","mockUserAgent","userAgent","isDevice","match","isWebView","test","isStandAlone","standalone","matchMedia","matches","isFacebookWebView","ua","indexOf","isFirefoxIOS","isEdgeIOS","isOperaMini","isAndroid","isIos","isGoogleSearchApp","isQQBrowser","isIosWebview","isAndroidWebview","isIE","document","documentMode","Boolean","isIECompHeader","mHttp","querySelector","mContent","isElectron","process","versions","electron","isIEIntranet","status","err","isMacOsCna","supportsPopups","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","isPromise","item","Promise","Window","constructor","toString","name","then","dispatchedErrors","possiblyUnhandledPromiseHandlers","dispatchPossiblyUnhandledError","promise","push","setTimeout","__DEBUG__","j","onPossiblyUnhandledException","handler","cancel","splice","activeCount","flushPromise","flushActive","resolve","startActive","endActive","awaitActive","Zalgo","ZalgoPromise","resolved","rejected","errorHandled","value","error","handlers","dispatching","stack","result","isAsync","res","reject","Error","dispatch","asyncReject","chain","firstPromise","secondPromise","onSuccess","onError","catch","undefined","finally","onFinally","try","timeout","time","clearTimeout","toPromise","TypeError","all","promises","count","results","prom","hash","keys","map","items","method","context","args","delay","flush","isRegex","noop","PROTOCOL","MOCK","FILE","ABOUT","WILDCARD","WINDOW_TYPE","IFRAME","POPUP","IE_WIN_ACCESS_ERROR","isFileProtocol","win","location","protocol","isAboutProtocol","getParent","parent","getOpener","opener","canReadFromWindow","href","getActualDomain","host","getDomain","domain","mockDomain","isBlankDomain","isActuallySameDomain","desc","getOwnPropertyDescriptor","enumerable","isSameDomain","assertSameDomain","getParents","isAncestorParent","child","childParent","getFrames","frames","len","frame","getAllChildFrames","childFrame","getTop","top","getNextOpener","getUltimateTop","getAllFramesInWindow","getAllWindows","isTop","isFrameWindowClosed","contentWindow","parentNode","doc","ownerDocument","documentElement","contains","safeIndexOf","collection","iframeWindows","iframeFrames","isWindowClosed","allowMock","closed","message","mockclosed","iframeIndex","cleanIframes","linkFrameWindow","getFrameByName","winFrames","findChildFrameByName","namedFrame","findFrameByName","isParent","frameParent","isOpener","getAncestor","getAncestors","ancestor","isAncestor","actualParent","isPopup","isIframe","isFullpage","anyMatch","collection1","collection2","item1","item2","getDistanceFromTop","distance","getNthParent","n","getNthParentFromTop","isSameTopWindow","win1","win2","top1","top2","allFrames1","allFrames2","opener1","opener2","matchDomain","pattern","origin","Array","isArray","JSON","stringify","some","subpattern","stringifyDomainPattern","join","getDomainFromUrl","url","split","slice","onCloseWindow","callback","maxtime","Infinity","check","isWindow","obj","self","__cross_domain_utils_window_check__","isBrowser","isCurrentDomain","isMockDomain","normalizeMockUrl","replace","closeWindow","close","TYPES","hasNativeWeakMap","WeakMap","freeze","testWeakMap","testKey","testValue","set","get","CrossDomainSafeWeakMap","weakmap","values","Math","random","_cleanupClosedWindows","delete","isSafeToReadWrite","entry","defineProperty","writable","index","has","getOrSet","getter","getFunctionName","fn","__name__","displayName","setFunctionName","base64encode","str","btoa","encodeURIComponent","m","p1","String","fromCharCode","parseInt","Buffer","from","base64decode","atob","decodeURIComponent","c","charCodeAt","uniqueID","chars","randomID","charAt","floor","timeID","Date","toISOString","toLowerCase","getGlobal","global","__GLOBAL__","objectIDs","getObjectID","uid","serializeArgs","subkey","val","memoize","options","cacheMap","memoizedFunction","cache","thisNamespace","cacheTime","now","reset","memoizePromise","memoizedPromiseFunction","promisify","promisifiedFunction","inlineMemoize","logic","__inline_memoize_cache__","once","called","onceFunction","hashStr","pow","sqrt","strHashStr","total","abs","regmatch","awaitKey","configurable","stringifyError","level","newErr","stringifyErrorMessage","defaultMessage","domainMatches","hostname","patchMethod","original","patchedMethod","callOriginal","extend","perc","pixels","percentage","round","min","max","regexMap","regexp","regexMapMatcher","svgToBase64","svg","objFilter","filter","identity","regexTokenize","text","token","promiseDebounce","promiseDebounced","localPromise","safeInterval","loop","isInteger","isFloat","serializePrimitive","deserializePrimitive","parseFloat","dotify","prefix","newobj","every","undotify","keyResult","parts","part","isLast","isIndex","eventEmitter","triggered","on","eventName","handlerList","cancelled","listener","trigger","triggerOnce","camelToDasherize","string","g","dasherizeToCamel","toUpperCase","capitalizeFirstLetter","path","def","pathParts","safeTimeout","interval","defineLazyProp","arrayFrom","isObject","isObjectObject","isPlainObject","replaceObject","replacer","fullKey","itemKey","el","copyProp","descriptor","regex","start","RegExp","groups","end","regexAll","isDefined","cycle","debounce","debounceWrapper","weakMapMemoize","weakmapMemoized","arg","weakMapMemoizePromise","weakmapMemoizedPromise","cleanup","tasks","cleaned","register","task","pop","tryCatch","removeFromArray","arr","assertExists","thing","unique","KEY_CODES","ENTER","isDocumentReady","body","readyState","urlEncode","waitForWindowReady","addEventListener","waitForDocumentReady","setInterval","clearInterval","waitForDocumentBody","parseQuery","queryString","params","pair","getQueryParam","search","urlWillRedirectPage","formatQuery","extendQuery","originalQuery","props","extendUrl","query","originalUrl","originalHash","hashString","redirect","hasMetaViewPort","meta","screen","width","isElementVisible","offsetWidth","offsetHeight","getClientRects","enablePerformance","performance","timing","connectEnd","navigationStart","getPageRenderTime","domInteractive","htmlEncode","html","querySelectorAll","selector","onClick","element","event","keyCode","getScript","scripts","getElementsByTagName","script","src","isLocalStorageEnabled","localStorage","setItem","getItem","removeItem","getBrowserLocales","nav","locales","languages","language","userLanguage","locale","lang","country","appendChild","container","isElement","Element","nodeType","style","getElementSafe","id","getElement","elementReady","PopupOpenError","create","popup","height","left","outerWidth","screenX","outerHeight","screenY","toolbar","menubar","resizable","scrollbars","open","writeToWindow","write","err2","writeElementToWindow","tag","tagName","children","removeChild","setStyle","styleText","styleSheet","cssText","createTextNode","awaitFrameLoadPromises","awaitFrameLoad","awaitFrameWindow","loadedFrame","createElement","class","className","setAttribute","attributes","innerHTML","iframe","allowTransparency","backgroundColor","border","hasAttribute","removeEventListener","bindEvents","eventNames","VENDOR_PREFIXES","setVendorCSS","capitalizedName","ANIMATION_START_EVENTS","ANIMATION_END_EVENTS","animate","clean","hasStarted","startTimeout","endTimeout","startEvent","endEvent","cleanUp","animationName","stopPropagation","STYLE","DISPLAY","NONE","BLOCK","VISIBILITY","VISIBLE","HIDDEN","IMPORTANT","makeElementVisible","setProperty","makeElementInvisible","showElement","hideElement","destroyElement","showAndAnimate","animation","animateAndHide","addClass","classList","add","removeClass","remove","isElementClosed","watchElementForClose","fixScripts","newScript","textContent","replaceChild","onResize","currentWidth","currentHeight","newWidth","newHeight","observer","ResizeObserver","observe","MutationObserver","childList","subtree","characterData","disconnect","getResourceLoadTime","getEntries","entries","duration","DEFAULT_SESSION_STORAGE","getStorage","lifetime","STORAGE_KEY","accessedStorage","getState","localStorageEnabled","storage","rawStorage","parse","getID","getSession","session","__session__","created","guid","getSessionState","state","getSessionID","getBelterExperimentStorage","isEventUnique","loggedBeacons","getThrottlePercentile","throttlePercentiles","THROTTLE_GROUP","TEST","CONTROL","THROTTLE","experiment","sample","logTreatment","logCheckpoint","throttle","group","treatment","started","forced","isEnabled","isDisabled","getTreatment","log","checkpoint","payload","logStart","logComplete","getGlobalNameSpace","version","globalKey","namespace","defValue","HEADERS","CONTENT_TYPE","ACCEPT","headerBuilders","parseHeaders","rawHeaders","trim","line","request","headers","json","data","normalizedHeaders","headerBuilder","builtHeaders","xhr","XMLHttpRequest","xhrLoad","responseHeaders","getAllResponseHeaders","contentType","isJSON","responseBody","responseText","evt","setRequestHeader","ontimeout","xhrTimeout","send","addHeaderBuilder","memoized","isPerc","isPx","toNum","toPx","toCSS","percOf","num","normalizeDimension","dim","wrapPromise","expected","timer","expect","expectWrapper","avoid","avoidWrapper","expectError","expectErrorWrapper","drain","BRIDGE_TIMEOUT","CHILD_WINDOW_TIMEOUT","ACK_TIMEOUT","ACK_TIMEOUT_KNOWN","RES_TIMEOUT","__TEST__","RESPONSE_CYCLE_TIME","MESSAGE_TYPE","REQUEST","RESPONSE","ACK","MESSAGE_ACK","SUCCESS","ERROR","MESSAGE_NAME","METHOD","HELLO","OPEN_TUNNEL","SEND_STRATEGY","POST_MESSAGE","BRIDGE","GLOBAL","BRIDGE_NAME_PREFIX","POSTROBOT_PROXY","SERIALIZATION_TYPE","CROSS_DOMAIN_ZALGO_PROMISE","CROSS_DOMAIN_FUNCTION","CROSS_DOMAIN_WINDOW","__POST_ROBOT__","deleteGlobal","getObj","globalStore","defStore","store","storeKey","defVal","del","WildCard","getWildcard","WINDOW_WILDCARD","windowStore","winStore","getStore","getInstanceID","getHelloPromise","helloPromises","resolveHelloPromise","existingPromise","newPromise","listenForHello","instanceID","sayHello","getWindowInstanceID","initHello","awaitWindowHello","needsGlobalMessagingForBrowser","markWindowKnown","knownWindows","isWindowKnown","TYPE","FUNCTION","PROMISE","REGEX","DATE","ARRAY","OBJECT","STRING","NUMBER","BOOLEAN","NULL","UNDEFINED","isSerializedType","__type__","determineType","serializeType","type","__val__","serializeArray","deserializeArray","serializeBoolean","deserializeBoolean","serializeDate","toJSON","deserializeDate","serializeError","code","deserializeError","serializeFunction","deserializeFunction","serializeNumber","deserializeNumber","serializeObject","deserializeObject","serializePromise","deserializePromise","serializeRegex","deserializeRegex","serializeString","deserializeString","serializeNull","deserializeNull","SERIALIZER","defaultSerializers","serialize","serializers","serializer","DESERIALIZER","defaultDeserializers","deserialize","deserializers","deserializer","cleanTunnelWindows","tunnelWindows","tunnelWindow","addTunnelWindow","canary","sendMessage","setupOpenTunnelToParent","openTunnelToParent","parentWindow","needsBridgeForBrowser","needsBridgeForWin","needsBridgeForDomain","needsBridge","getBridgeName","sanitizedDomain","isBridge","documentBodyReady","registerRemoteWindow","remoteWindowPromises","findRemoteWindow","remoteWinPromise","registerRemoteSendMessage","sendMessageWrapper","remoteWin","remoteDomain","fireAndForget","rejectRemoteSendMessage","sendBridgeMessage","messagingChild","messagingParent","awaitRemoteBridgeForWindow","openTunnelToOpener","receiveMessage","bridge","listenForOpenTunnel","popupWindowsByName","bridgePromise","winDetails","openBridgeFrame","hasBridge","bridges","openBridge","bridgeFrames","linkWindow","popupWindowsByWin","winName","details","linkUrl","listenForWindowOpen","windowOpen","windowOpenWrapper","last","destroyBridges","setupBridge","cleanupProxyWindows","idToProxyWindow","shouldClean","getSerializedWindow","winPromise","windowName","getType","getName","focus","isClosed","setLocation","setName","sameDomainWin","frameElement","ProxyWindow","serializedWindow","isProxyWindow","actualWindow","actualWindowPromise","setWindow","isPopupPromise","getNamePromise","reopenPromise","focusPromise","getWindow","awaitWindow","matchWindow","proxyInstanceID","knownWindowInstanceID","unwrap","toProxyWindow","serializeWindow","destination","deserializeWindow","addMethod","methodStore","proxyWindowMethods","methods","lookupMethod","listenForFunctionCalls","meth","methodSource","__id__","getDeserializedFunction","opts","crossDomainFunctionWrapper","originalStack","__origin__","__source__","serializeMessage","deserializeMessage","serializedPromise","serializedFunction","SEND_MESSAGE_STRATEGIES","serializedMessage","domains","dom","forEach","postMessage","foreignGlobal","strategies","errors","strategyName","resetListeners","responseListeners","erroredResponseListeners","__DOMAIN_REGEX__","addResponseListener","getResponseListener","deleteResponseListener","cancelResponseListeners","markResponseListenerErrored","isResponseListenerErrored","getRequestListener","requestListeners","winQualifier","nameListeners","domainListeners","addRequestListener","listenersCollection","cancelListener","existingListener","strDomain","regexListeners","regexListener","RECEIVE_MESSAGE_TYPES","logName","sendResponse","ack","response","pathname","handleError","parseMessage","parsedMessage","receivedMessages","setupGlobalReceiveMessage","messageListener","sourceElement","originalEvent","listenForMessages","stopListenForMessages","listenerOptions","errorHandler","requestListener","validateOptions","normalizeDomain","targetDomain","actualDomain","normalizedDomain","responseTimeout","childTimeout","responseListener","reqPromises","totalAckTimeout","totalResTimeout","ackTimeout","resTimeout","internalSerializeMessage","internalDeserializeMessage","createProxyWindow","setup","initialized","destroy","cleanUpWindow","requestPromises","__ZOID__","destroyGlobal","getProxyObject","ZOID","DELEGATE","ALLOW_DELEGATE","PROP_TYPE","INITIAL_PROPS","RAW","UID","WINDOW_REFERENCES","OPENER","PARENT","PROP_SERIALIZATION","DOTIFY","BASE64","CONTEXT","DEFAULT_DIMENSIONS","WIDTH","HEIGHT","EVENT","RENDER","RENDERED","CLOSE","PROPS","RESIZE","FOCUS","normalizeChildProp","component","helpers","prop","getPropDefinition","childDecorate","onProps","resize","getParentDomain","show","hide","normalizeChildProps","parentComponentWindow","isUpdate","sameDomain","alias","getPropNames","parseChildWindowName","zoidcomp","encodedPayload","getChildPayload","ChildComponent","parentDomain","onPropHandlers","autoResize","childPayload","exports","getParentComponentWindow","checkParentDomain","initialProps","getPropsByRef","setProps","watchForClose","init","buildExports","watchForResize","getHelpers","allowedParentDomains","ref","windows","getProps","existingProps","normalizedProps","checkClose","getAutoResize","updateProps","RENDER_DRIVERS","openOnClick","openFrame","title","proxyFrame","frameWatcher","openPrerenderFrame","openPrerender","proxyWin","proxyPrerenderFrame","prerenderFrame","prerenderFrameWindow","delegate","dimensions","extendProps","inputProps","propNames","aliases","propDef","default","validate","decorate","required","queryParam","getQueryValue","queryValue","propsToQuery","propsDef","serialization","dotkey","ParentComponent","driver","initPromise","handledErrors","proxyContainer","visible","setupEvents","registerActiveComponent","destroyActiveComponent","watchForUnload","onRender","onDisplay","onRendered","onClose","onFocus","render","childDomain","getChildDomain","checkAllowRender","buildUrl","getProxyContainer","renderContainer","setState","setProxyWin","prerender","proxyPrerenderWin","buildWindowName","setWindowName","loadUrl","runTimeout","containerElement","buildChildPayload","getPropsRef","getPropsForChild","propRef","getWindowRef","buildParentExports","builtinProps","getUrl","sendToChild","windowProp","propName","allowDelegate","overridesPromise","overrides","overriddenFunction","unloadWindowListener","initChild","secondClosed","prerenderTemplate","prerenderWindow","renderTemplate","renderer","innerContainer","containerTemplate","bridgeUrl","getBridgeUrl","bridgeDomain","DelegateComponent","watchForSourceClose","getDelegate","getOverrides","closeSourceWindowListener","delegateOverride","_inheritsLoose","subClass","superClass","__proto__","react","React","ReactDOM","componentDidMount","findDOMNode","componentDidUpdate","Component","vue","Vue","inheritAttrs","mounted","$el","$attrs","watch","deep","angular","ng","module","directive","scope","restrict","controller","$scope","$element","safeApply","$root","$$phase","$apply","angularWrapped","instance","$watch","equals","obj1","obj2","checked","angular2","zoid","AngularComponent","NgModule","ElementRef","NgZone","internalProps","angular2Wrapped","zone","run","ComponentInstance","template","inputs","Class","angularConstructor","elementRef","_props","ngOnInit","targetElement","nativeElement","ngDoCheck","ModuleInstance","declarations","validatePropDefinitions","PROP_TYPE_LIST","defaultContext","CLASS","INVISIBLE","defaultContainerTemplate","div","cspNonce","defaultPrerenderTemplate","spinner","defaultNoop","decorateOnce","getBuiltInProps","driverCache","xprops","logger","components","debug","info","warn","registerChild","listenDelegate","dep","isChild","canRenderTo","getDefaultContainer","getDefaultContext","finalContext","renderTo","activeComponents","setupPostRobot","destroyAll","destroyComponents","destroyPostRobot","OUTLET","COMPONENT_FRAME","PRERENDER_FRAME","numInPixel","overflow","Chat","mobileLocal","__LOCAL_MOBILE_URL__","local","production","env","scrolling","phoneNumber","chatHeader","caption","avatar","welcomeMessage","author","timestamp","layout","web","mobile","__DEFAULT_CONTEXT__"],"mappings":"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","file":"chat.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"MCS\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MCS\"] = factory();\n\telse\n\t\troot[\"MCS\"] = factory();\n})((typeof self !== 'undefined' ? self : this), function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/* @flow */\n\nexport function getUserAgent() : string {\n    return window.navigator.mockUserAgent || window.navigator.userAgent;\n}\n\nexport function isDevice(userAgent? : string = getUserAgent()) : boolean {\n    if (userAgent.match(/Android|webOS|iPhone|iPad|iPod|bada|Symbian|Palm|CriOS|BlackBerry|IEMobile|WindowsMobile|Opera Mini/i)) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function isWebView() : boolean {\n    let userAgent = getUserAgent();\n    return (/(iPhone|iPod|iPad|Macintosh).*AppleWebKit(?!.*Safari)/i).test(userAgent) ||\n        (/\\bwv\\b/).test(userAgent) ||\n    (/Android.*Version\\/(\\d)\\.(\\d)/i).test(userAgent);\n}\n\nexport function isStandAlone() : boolean {\n    return (window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches);\n}\n\nexport function isFacebookWebView(ua? : string = getUserAgent()) : boolean {\n    return (ua.indexOf('FBAN') !== -1) || (ua.indexOf('FBAV') !== -1);\n}\n\nexport function isFirefoxIOS(ua? : string = getUserAgent()) : boolean {\n    return (/FxiOS/i).test(ua);\n}\n\nexport function isEdgeIOS(ua? : string = getUserAgent()) : boolean {\n    return (/EdgiOS/i).test(ua);\n}\n\nexport function isOperaMini(ua? : string = getUserAgent()) : boolean {\n    return ua.indexOf('Opera Mini') > -1;\n}\n\nexport function isAndroid(ua? : string = getUserAgent()) : boolean {\n    return (/Android/).test(ua);\n}\n\nexport function isIos(ua? : string = getUserAgent()) : boolean {\n    return (/iPhone|iPod|iPad/).test(ua);\n}\n\nexport function isGoogleSearchApp(ua? : string = getUserAgent()) : boolean {\n    return (/\\bGSA\\b/).test(ua);\n}\n\nexport function isQQBrowser(ua? : string = getUserAgent()) : boolean {\n    return (/QQBrowser/).test(ua);\n}\n\nexport function isIosWebview(ua? : string = getUserAgent()) : boolean {\n    if (isIos(ua)) {\n        if (isGoogleSearchApp(ua)) {\n            return true;\n        }\n        return (/.+AppleWebKit(?!.*Safari)/).test(ua);\n    }\n    return false;\n}\n\nexport function isAndroidWebview(ua? : string = getUserAgent()) : boolean {\n    if (isAndroid(ua)) {\n        return (/Version\\/[\\d.]+/).test(ua) && !isOperaMini(ua);\n    }\n    return false;\n}\n\nexport function isIE() : boolean {\n\n    if (window.document.documentMode) {\n        return true;\n    }\n\n    return Boolean(\n        window.navigator &&\n        window.navigator.userAgent &&\n        (/Edge|MSIE|rv:11/i).test(window.navigator.userAgent)\n    );\n}\n\nexport function isIECompHeader() : boolean {\n    let mHttp = window.document.querySelector('meta[http-equiv=\"X-UA-Compatible\"]');\n    let mContent = window.document.querySelector('meta[content=\"IE=edge\"]');\n    if (mHttp && mContent) {\n        return true;\n    }\n    return false;\n}\n\nexport function isElectron() : boolean {\n    if (typeof process !== 'undefined' && process.versions && process.versions.electron) {\n        return true;\n    }\n    return false;\n}\n\nexport function isIEIntranet() : boolean {\n\n    // This status check only works for older versions of IE with document.documentMode set\n\n    if (window.document.documentMode) {\n        try {\n            let status = window.status;\n\n            window.status = 'testIntranetMode';\n\n            if (window.status === 'testIntranetMode') {\n                window.status = status;\n\n                return true;\n            }\n\n            return false;\n\n        } catch (err) {\n\n            return false;\n        }\n    }\n\n    return false;\n}\n\nexport function isMacOsCna() : boolean {\n    let userAgent = getUserAgent();\n    return (/Macintosh.*AppleWebKit(?!.*Safari)/i).test(userAgent);\n}\n\nexport function supportsPopups(ua? : string = getUserAgent()) : boolean {\n    return !(isIosWebview(ua) || isAndroidWebview(ua) || isOperaMini(ua) ||\n        isFirefoxIOS(ua) || isEdgeIOS(ua) || isFacebookWebView(ua) || isQQBrowser(ua) || isElectron() || isMacOsCna() || isStandAlone());\n}\n","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","/* @flow */\n\nexport function isPromise(item : mixed) : boolean {\n    try {\n        if (!item) {\n            return false;\n        }\n\n        if (typeof Promise !== 'undefined' && item instanceof Promise) {\n            return true;\n        }\n\n        if (typeof window !== 'undefined' && typeof window.Window === 'function' && item instanceof window.Window) {\n            return false;\n        }\n\n        if (typeof window !== 'undefined' && typeof window.constructor === 'function' && item instanceof window.constructor) {\n            return false;\n        }\n\n        let toString = ({}).toString;\n\n        if (toString) {\n            let name = toString.call(item);\n\n            if (name === '[object Window]' || name === '[object global]' || name === '[object DOMWindow]') {\n                return false;\n            }\n        }\n\n        if (typeof item.then === 'function') {\n            return true;\n        }\n    } catch (err) {\n        return false;\n    }\n\n    return false;\n}\n","/* @flow */\n\nimport type { ZalgoPromise } from './promise';\n\nconst dispatchedErrors = [];\nconst possiblyUnhandledPromiseHandlers : Array<(mixed, promise? : ZalgoPromise<mixed>) => void> = [];\n\nexport function dispatchPossiblyUnhandledError<T>(err : mixed, promise : ZalgoPromise<T>) {\n\n    if (dispatchedErrors.indexOf(err) !== -1) {\n        return;\n    }\n\n    dispatchedErrors.push(err);\n\n    setTimeout(() => {\n        if (__DEBUG__) {\n            // $FlowFixMe\n            throw new Error(`${ err.stack || err.toString() }\\n\\nFrom promise:\\n\\n${ promise.stack }`);\n        }\n\n        throw err;\n    }, 1);\n\n    for (let j = 0; j < possiblyUnhandledPromiseHandlers.length; j++) {\n        // $FlowFixMe\n        possiblyUnhandledPromiseHandlers[j](err, promise);\n    }\n}\n\nexport function onPossiblyUnhandledException(handler : (mixed, promise? : ZalgoPromise<mixed>) => void) : { cancel : () => void } {\n    possiblyUnhandledPromiseHandlers.push(handler);\n\n    return {\n        cancel() {\n            possiblyUnhandledPromiseHandlers.splice(possiblyUnhandledPromiseHandlers.indexOf(handler), 1);\n        }\n    };\n}\n","/* @flow */\n\nimport type { ZalgoPromise } from './promise';\n\nlet activeCount = 0;\nlet flushPromise;\n\nfunction flushActive() {\n    if (!activeCount && flushPromise) {\n        const promise = flushPromise;\n        flushPromise = null;\n        promise.resolve();\n    }\n}\n\nexport function startActive() {\n    activeCount += 1;\n}\n\nexport function endActive() {\n    activeCount -= 1;\n    flushActive();\n}\n\nexport function awaitActive(Zalgo : Class<ZalgoPromise<*>>) : ZalgoPromise<void> { // eslint-disable-line no-undef\n    let promise = flushPromise = flushPromise || new Zalgo();\n    flushActive();\n    return promise;\n}\n","/* @flow */\n\nimport { isPromise } from './utils';\nimport { onPossiblyUnhandledException, dispatchPossiblyUnhandledError } from './exceptions';\nimport { startActive, endActive, awaitActive } from './flush';\n\nexport class ZalgoPromise<R : mixed> {\n\n    resolved : boolean\n    rejected : boolean\n    errorHandled : boolean\n    value : R\n    error : mixed\n    handlers : Array<{\n        promise : ZalgoPromise<*>,\n        onSuccess : void | (result : R) => mixed,\n        onError : void | (error : mixed) => mixed\n    }>\n    dispatching : boolean\n    stack : string\n\n    constructor(handler : ?(resolve : (result : R) => void, reject : (error : mixed) => void) => void) {\n\n        this.resolved = false;\n        this.rejected = false;\n        this.errorHandled = false;\n\n        this.handlers = [];\n\n        if (handler) {\n\n            let result;\n            let error;\n            let resolved = false;\n            let rejected = false;\n            let isAsync = false;\n\n            startActive();\n\n            try {\n                handler(res => {\n                    if (isAsync) {\n                        this.resolve(res);\n                    } else {\n                        resolved = true;\n                        result = res;\n                    }\n\n                }, err => {\n                    if (isAsync) {\n                        this.reject(err);\n                    } else {\n                        rejected = true;\n                        error = err;\n                    }\n                });\n\n            } catch (err) {\n                endActive();\n                this.reject(err);\n                return;\n            }\n\n            endActive();\n\n            isAsync = true;\n\n            if (resolved) {\n                // $FlowFixMe\n                this.resolve(result);\n            } else if (rejected) {\n                this.reject(error);\n            }\n        }\n\n        if (__DEBUG__) {\n            try {\n                throw new Error(`ZalgoPromise`);\n            } catch (err) {\n                this.stack = err.stack;\n            }\n        }\n    }\n\n    resolve(result : R) : ZalgoPromise<R> {\n        if (this.resolved || this.rejected) {\n            return this;\n        }\n\n        if (isPromise(result)) {\n            throw new Error('Can not resolve promise with another promise');\n        }\n\n        this.resolved = true;\n        this.value = result;\n        this.dispatch();\n\n        return this;\n    }\n\n    reject(error : mixed) : ZalgoPromise<R> {\n        if (this.resolved || this.rejected) {\n            return this;\n        }\n\n        if (isPromise(error)) {\n            throw new Error('Can not reject promise with another promise');\n        }\n\n        if (!error) {\n            // $FlowFixMe\n            let err = (error && typeof error.toString === 'function' ? error.toString() : Object.prototype.toString.call(error));\n            error = new Error(`Expected reject to be called with Error, got ${ err }`);\n        }\n\n        this.rejected = true;\n        this.error = error;\n\n        if (!this.errorHandled) {\n            setTimeout(() => {\n                if (!this.errorHandled) {\n                    dispatchPossiblyUnhandledError(error, this);\n                }\n            }, 1);\n        }\n\n        this.dispatch();\n\n        return this;\n    }\n\n    asyncReject(error : mixed) : ZalgoPromise<R> {\n        this.errorHandled = true;\n        this.reject(error);\n        return this;\n    }\n    \n    dispatch() {\n\n        let { dispatching, resolved, rejected, handlers } = this;\n\n        if (dispatching) {\n            return;\n        }\n\n        if (!resolved && !rejected) {\n            return;\n        }\n\n        this.dispatching = true;\n        startActive();\n\n        const chain = <T>(firstPromise : ZalgoPromise<T>, secondPromise : ZalgoPromise<T>) => {\n            return firstPromise.then(res => {\n                secondPromise.resolve(res);\n            }, err => {\n                secondPromise.reject(err);\n            });\n        };\n\n        for (let i = 0; i < handlers.length; i++) {\n\n            let { onSuccess, onError, promise } = handlers[i];\n\n            let result;\n\n            if (resolved) {\n\n                try {\n                    result = onSuccess ? onSuccess(this.value) : this.value;\n                } catch (err) {\n                    promise.reject(err);\n                    continue;\n                }\n\n            } else if (rejected) {\n\n                if (!onError) {\n                    promise.reject(this.error);\n                    continue;\n                }\n\n                try {\n                    result = onError(this.error);\n                } catch (err) {\n                    promise.reject(err);\n                    continue;\n                }\n            }\n\n            if (result instanceof ZalgoPromise && (result.resolved || result.rejected)) {\n\n                if (result.resolved) {\n                    promise.resolve(result.value);\n                } else {\n                    promise.reject(result.error);\n                }\n\n                result.errorHandled = true;\n\n            } else if (isPromise(result)) {\n\n                if (result instanceof ZalgoPromise && (result.resolved || result.rejected)) {\n                    if (result.resolved) {\n                        promise.resolve(result.value);\n                    } else {\n                        promise.reject(result.error);\n                    }\n\n                } else {\n                    // $FlowFixMe\n                    chain(result, promise);\n                }\n\n            } else {\n\n                promise.resolve(result);\n            }\n        }\n\n        handlers.length = 0;\n        this.dispatching = false;\n        endActive();\n    }\n\n    then<X : mixed, Y : mixed>(onSuccess : void | (result : R) => (ZalgoPromise<X> | Y), onError : void | (error : mixed) => (ZalgoPromise<X> | Y)) : ZalgoPromise<X | Y> {\n\n        if (onSuccess && typeof onSuccess !== 'function' && !onSuccess.call) {\n            throw new Error('Promise.then expected a function for success handler');\n        }\n\n        if (onError && typeof onError !== 'function' && !onError.call) {\n            throw new Error('Promise.then expected a function for error handler');\n        }\n\n        let promise : ZalgoPromise<X | Y> = new ZalgoPromise();\n\n        this.handlers.push({\n            promise,\n            onSuccess,\n            onError\n        });\n\n        this.errorHandled = true;\n\n        this.dispatch();\n\n        return promise;\n    }\n\n    catch<X : mixed, Y : mixed>(onError : (error : mixed) => ZalgoPromise<X> | Y) : ZalgoPromise<X | Y> {\n        return this.then(undefined, onError);\n    }\n\n    finally(onFinally : () => mixed) : ZalgoPromise<R> {\n\n        if (onFinally && typeof onFinally !== 'function' && !onFinally.call) {\n            throw new Error('Promise.finally expected a function');\n        }\n\n        return this.then((result) => {\n            return ZalgoPromise.try(onFinally)\n                .then(() => {\n                    return result;\n                });\n        }, (err) => {\n            return ZalgoPromise.try(onFinally)\n                .then(() => {\n                    throw err;\n                });\n        });\n    }\n\n    timeout(time : number, err : ?Error) : ZalgoPromise<R> {\n\n        if (this.resolved || this.rejected) {\n            return this;\n        }\n\n        let timeout = setTimeout(() => {\n\n            if (this.resolved || this.rejected) {\n                return;\n            }\n\n            this.reject(err || new Error(`Promise timed out after ${ time }ms`));\n\n        }, time);\n\n        return this.then(result => {\n            clearTimeout(timeout);\n            return result;\n        });\n    }\n\n    // $FlowFixMe\n    toPromise() : Promise<R> {\n        // $FlowFixMe\n        if (typeof Promise === 'undefined') {\n            throw new TypeError(`Could not find Promise`);\n        }\n        // $FlowFixMe\n        return Promise.resolve(this); // eslint-disable-line compat/compat\n    }\n\n    static resolve<X : mixed>(value : X | ZalgoPromise<X>) : ZalgoPromise<X> {\n\n        if (value instanceof ZalgoPromise) {\n            return value;\n        }\n\n        if (isPromise(value)) {\n            // $FlowFixMe\n            return new ZalgoPromise((resolve, reject) => value.then(resolve, reject));\n        }\n\n        return new ZalgoPromise().resolve(value);\n    }\n\n    static reject(error : mixed) : ZalgoPromise<R> {\n        return new ZalgoPromise().reject(error);\n    }\n\n    static asyncReject(error : mixed) : ZalgoPromise<R> {\n        return new ZalgoPromise().asyncReject(error);\n    }\n\n    static all<X : Array<mixed>>(promises : X) : ZalgoPromise<$TupleMap<X, <Y>(ZalgoPromise<Y> | Y) => Y>> { // eslint-disable-line no-undef\n\n        let promise = new ZalgoPromise();\n        let count = promises.length;\n        let results = [];\n\n        if (!count) {\n            promise.resolve(results);\n            return promise;\n        }\n\n        const chain = <T>(i : number, firstPromise : ZalgoPromise<T>, secondPromise : ZalgoPromise<T>) => {\n            return firstPromise.then(res => {\n                results[i] = res;\n                count -= 1;\n                if (count === 0) {\n                    promise.resolve(results);\n                }\n            }, err => {\n                secondPromise.reject(err);\n            });\n        };\n\n        for (let i = 0; i < promises.length; i++) {\n            let prom = promises[i];\n\n            if (prom instanceof ZalgoPromise) {\n                if (prom.resolved) {\n                    results[i] = prom.value;\n                    count -= 1;\n                    continue;\n                }\n            } else if (!isPromise(prom)) {\n                results[i] = prom;\n                count -= 1;\n                continue;\n            }\n\n            chain(i, ZalgoPromise.resolve(prom), promise);\n        }\n\n        if (count === 0) {\n            promise.resolve(results);\n        }\n\n        return promise;\n    }\n\n    static hash<O : Object>(promises : O) : ZalgoPromise<$ObjMap<O, <Y>(ZalgoPromise<Y> | Y) => Y>> { // eslint-disable-line no-undef\n        let result = {};\n        \n        return ZalgoPromise.all(Object.keys(promises).map(key => {\n            return ZalgoPromise.resolve(promises[key]).then(value => {\n                result[key] = value;\n            });\n        })).then(() => {\n            return result;\n        });\n    }\n\n    static map<T, X>(items : Array<T>, method : (T) => (ZalgoPromise<X> | X)) : ZalgoPromise<Array<X>> {\n        // $FlowFixMe\n        return ZalgoPromise.all(items.map(method));\n    }\n\n    static onPossiblyUnhandledException(handler : (err : mixed) => void) : { cancel : () => void } {\n        return onPossiblyUnhandledException(handler);\n    }\n\n    static try<X : mixed, Y : mixed, C : mixed, A : Array<mixed>>(method : (...args : A) => (ZalgoPromise<X> | Y), context : ?C, args : ?A) : ZalgoPromise<X | Y> {\n\n        if (method && typeof method !== 'function' && !method.call) {\n            throw new Error('Promise.try expected a function');\n        }\n\n        let result;\n\n        startActive();\n        \n        try {\n            // $FlowFixMe\n            result = method.apply(context, args || []);\n        } catch (err) {\n            endActive();\n            return ZalgoPromise.reject(err);\n        }\n\n        endActive();\n\n        return ZalgoPromise.resolve(result);\n    }\n\n    static delay(delay : number) : ZalgoPromise<void> {\n        return new ZalgoPromise(resolve => {\n            setTimeout(resolve, delay);\n        });\n    }\n\n    static isPromise(value : mixed) : boolean {\n\n        if (value && value instanceof ZalgoPromise) {\n            return true;\n        }\n\n        return isPromise(value);\n    }\n\n    static flush() : ZalgoPromise<void> {\n        return awaitActive(ZalgoPromise);\n    }\n}\n","/* @flow */\n\nexport function isRegex(item : mixed) : boolean {\n    return Object.prototype.toString.call(item) === '[object RegExp]';\n}\n\n// eslint-disable-next-line no-unused-vars\nexport function noop(...args : Array<mixed>) {\n    // pass\n}\n","/* @flow */\n\nexport const PROTOCOL = {\n    MOCK:  ('mock:' : 'mock:'),\n    FILE:  ('file:' : 'file:'),\n    ABOUT: ('about:' : 'about:')\n};\n\nexport const WILDCARD = '*';\n\nexport const WINDOW_TYPE = {\n    IFRAME: ('iframe' : 'iframe'),\n    POPUP:  ('popup' : 'popup')\n};\n","/* @flow */\n/* eslint max-lines: 0 */\n\nimport { isRegex, noop } from './util';\nimport type { CrossDomainWindowType, SameDomainWindowType, DomainMatcher } from './types';\nimport { PROTOCOL, WILDCARD } from './constants';\n\nlet IE_WIN_ACCESS_ERROR = 'Call was rejected by callee.\\r\\n';\n\nexport function isFileProtocol(win : SameDomainWindowType = window) : boolean {\n    return win.location.protocol === PROTOCOL.FILE;\n}\n\nexport function isAboutProtocol(win : SameDomainWindowType = window) : boolean {\n    return win.location.protocol === PROTOCOL.ABOUT;\n}\n\nexport function getParent(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n\n    if (!win) {\n        return;\n    }\n\n    try {\n        if (win.parent && win.parent !== win) {\n            return win.parent;\n        }\n    } catch (err) {\n        // pass\n    }\n}\n\nexport function getOpener(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n\n    if (!win) {\n        return;\n    }\n\n    // Make sure we're not actually an iframe which has had window.open() called on us\n    if (getParent(win)) {\n        return;\n    }\n\n    try {\n        return win.opener;\n    } catch (err) {\n        // pass\n    }\n}\n\nexport function canReadFromWindow(win : CrossDomainWindowType | SameDomainWindowType) : boolean {\n    try {\n        // $FlowFixMe\n        noop(win && win.location && win.location.href);\n        return true;\n    } catch (err) {\n        // pass\n    }\n\n    return false;\n}\n\nexport function getActualDomain(win? : SameDomainWindowType = window) : string {\n\n    let location = win.location;\n\n    if (!location) {\n        throw new Error(`Can not read window location`);\n    }\n\n    let protocol = location.protocol;\n\n    if (!protocol) {\n        throw new Error(`Can not read window protocol`);\n    }\n\n    if (protocol === PROTOCOL.FILE) {\n        return `${ PROTOCOL.FILE }//`;\n    }\n\n    if (protocol === PROTOCOL.ABOUT) {\n\n        let parent = getParent(win);\n        if (parent && canReadFromWindow(parent)) {\n            // $FlowFixMe\n            return getActualDomain(parent);\n        }\n\n        return `${ PROTOCOL.ABOUT }//`;\n    }\n\n    let host = location.host;\n\n    if (!host) {\n        throw new Error(`Can not read window host`);\n    }\n\n    return `${ protocol }//${ host }`;\n}\n\nexport function getDomain(win? : SameDomainWindowType = window) : string {\n\n    let domain = getActualDomain(win);\n\n    if (domain && win.mockDomain && win.mockDomain.indexOf(PROTOCOL.MOCK) === 0) {\n        return win.mockDomain;\n    }\n\n    return domain;\n}\n\nexport function isBlankDomain(win : CrossDomainWindowType) : boolean {\n    try {\n        // $FlowFixMe\n        if (!win.location.href) {\n            return true;\n        }\n\n        if (win.location.href === 'about:blank') {\n            return true;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    return false;\n}\n\nexport function isActuallySameDomain(win : CrossDomainWindowType) : boolean {\n\n    try {\n        if (win === window) {\n            return true;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        let desc = Object.getOwnPropertyDescriptor(win, 'location');\n\n        if (desc && desc.enumerable === false) {\n            return false;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        // $FlowFixMe\n        if (isAboutProtocol(win) && canReadFromWindow(win)) {\n            return true;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        // $FlowFixMe\n        if (getActualDomain(win) === getActualDomain(window)) {\n            return true;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    return false;\n}\n\nexport function isSameDomain(win : CrossDomainWindowType | SameDomainWindowType) : boolean {\n\n    if (!isActuallySameDomain(win)) {\n        return false;\n    }\n\n    try {\n\n        if (win === window) {\n            return true;\n        }\n\n        // $FlowFixMe\n        if (isAboutProtocol(win) && canReadFromWindow(win)) {\n            return true;\n        }\n\n        // $FlowFixMe\n        if (getDomain(window) === getDomain(win)) {\n            return true;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    return false;\n}\n\n\nexport function assertSameDomain(win : CrossDomainWindowType | SameDomainWindowType) : SameDomainWindowType {\n    if (!isSameDomain(win)) {\n        throw new Error(`Expected window to be same domain`);\n    }\n\n    // $FlowFixMe\n    return win;\n}\n\nexport function getParents(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n\n    let result = [];\n\n    try {\n\n        while (win.parent !== win) {\n            result.push(win.parent);\n            win = win.parent;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    return result;\n}\n\nexport function isAncestorParent(parent : CrossDomainWindowType, child : CrossDomainWindowType) : boolean {\n\n    if (!parent || !child) {\n        return false;\n    }\n\n    let childParent = getParent(child);\n\n    if (childParent) {\n        return childParent === parent;\n    }\n\n    if (getParents(child).indexOf(parent) !== -1) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function getFrames(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n\n    let result = [];\n\n    let frames;\n\n    try {\n        frames = win.frames;\n    } catch (err) {\n        frames = win;\n    }\n\n    let len;\n\n    try {\n        len = frames.length;\n    } catch (err) {\n        // pass\n    }\n\n    if (len === 0) {\n        return result;\n    }\n\n    if (len) {\n        for (let i = 0; i < len; i++) {\n\n            let frame;\n\n            try {\n                frame = frames[i];\n            } catch (err) {\n                continue;\n            }\n\n            result.push(frame);\n        }\n\n        return result;\n    }\n\n    for (let i = 0; i < 100; i++) {\n        let frame;\n\n        try {\n            frame = frames[i];\n        } catch (err) {\n            return result;\n        }\n\n        if (!frame) {\n            return result;\n        }\n\n        result.push(frame);\n    }\n\n    return result;\n}\n\n\nexport function getAllChildFrames(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n\n    let result = [];\n\n    for (let frame of getFrames(win)) {\n        result.push(frame);\n\n        for (let childFrame of getAllChildFrames(frame)) {\n            result.push(childFrame);\n        }\n    }\n\n    return result;\n}\n\nexport function getTop(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n\n    try {\n        if (win.top) {\n            return win.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    if (getParent(win) === win) {\n        return win;\n    }\n\n    try {\n        if (isAncestorParent(window, win) && window.top) {\n            return window.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        if (isAncestorParent(win, window) && window.top) {\n            return window.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    for (let frame of getAllChildFrames(win)) {\n        try {\n            if (frame.top) {\n                return frame.top;\n            }\n        } catch (err) {\n            // pass\n        }\n\n        if (getParent(frame) === frame) {\n            return frame;\n        }\n    }\n}\n\nexport function getNextOpener(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n    return getOpener(getTop(win) || win);\n}\n\nexport function getUltimateTop(win? : CrossDomainWindowType = window) : CrossDomainWindowType {\n    let opener = getNextOpener(win);\n\n    if (opener) {\n        return getUltimateTop(opener);\n    }\n\n    return top;\n}\n\nexport function getAllFramesInWindow(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n    let top = getTop(win);\n\n    if (!top) {\n        throw new Error(`Can not determine top window`);\n    }\n\n    return [ ...getAllChildFrames(top), top ];\n}\n\nexport function getAllWindows(win? : CrossDomainWindowType = window) : $ReadOnlyArray<CrossDomainWindowType> {\n    let frames = getAllFramesInWindow(win);\n    let opener = getNextOpener(win);\n\n    if (opener) {\n        return [ ...getAllWindows(opener), ...frames ];\n    } else {\n        return frames;\n    }\n}\n\nexport function isTop(win : CrossDomainWindowType) : boolean {\n    return win === getTop(win);\n}\n\nexport function isFrameWindowClosed(frame : HTMLIFrameElement) : boolean {\n\n    if (!frame.contentWindow) {\n        return true;\n    }\n\n    if (!frame.parentNode) {\n        return true;\n    }\n\n    let doc = frame.ownerDocument;\n\n    if (doc && doc.documentElement && !doc.documentElement.contains(frame)) {\n        return true;\n    }\n\n    return false;\n}\n\nfunction safeIndexOf<T>(collection : Array<T>, item : T) : number {\n    for (let i = 0; i < collection.length; i++) {\n\n        try {\n            if (collection[i] === item) {\n                return i;\n            }\n        } catch (err) {\n            // pass\n        }\n    }\n\n    return -1;\n}\n\nlet iframeWindows = [];\nlet iframeFrames = [];\n\nexport function isWindowClosed(win : CrossDomainWindowType, allowMock : boolean = true) : boolean {\n\n    try {\n        if (win === window) {\n            return false;\n        }\n    } catch (err) {\n        return true;\n    }\n\n    try {\n        if (!win) {\n            return true;\n        }\n\n    } catch (err) {\n        return true;\n    }\n\n    try {\n        if (win.closed) {\n            return true;\n        }\n\n    } catch (err) {\n\n        // I love you so much IE\n\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return false;\n        }\n\n        return true;\n    }\n\n\n    if (allowMock && isSameDomain(win)) {\n        try {\n            // $FlowFixMe\n            if (win.mockclosed) {\n                return true;\n            }\n        } catch (err) {\n            // pass\n        }\n    }\n\n    // Mobile safari\n\n    try {\n        if (!win.parent || !win.top) {\n            return true;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    // Yes, this actually happens in IE. win === win errors out when the window\n    // is from an iframe, and the iframe was removed from the page.\n\n    try {\n        noop(win === win); // eslint-disable-line no-self-compare\n    } catch (err) {\n        return true;\n    }\n\n    // IE orphaned frame\n\n    let iframeIndex = safeIndexOf(iframeWindows, win);\n\n    if (iframeIndex !== -1) {\n        let frame = iframeFrames[iframeIndex];\n\n        if (frame && isFrameWindowClosed(frame)) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nfunction cleanIframes() {\n    for (let i = 0; i < iframeWindows.length; i++) {\n        let closed = false;\n\n        try {\n            closed = iframeWindows[i].closed;\n        } catch (err) {\n            // pass\n        }\n\n        if (closed) {\n            iframeFrames.splice(i, 1);\n            iframeWindows.splice(i, 1);\n        }\n    }\n}\n\nexport function linkFrameWindow(frame : HTMLIFrameElement) {\n\n    cleanIframes();\n\n    if (frame && frame.contentWindow) {\n        try {\n            iframeWindows.push(frame.contentWindow);\n            iframeFrames.push(frame);\n        } catch (err) {\n            // pass\n        }\n    }\n}\n\nexport function getUserAgent(win : ?SameDomainWindowType) : string {\n    win = win || window;\n    return win.navigator.mockUserAgent || win.navigator.userAgent;\n}\n\n\nexport function getFrameByName(win : CrossDomainWindowType, name : string) : ?CrossDomainWindowType {\n\n    let winFrames = getFrames(win);\n\n    for (let childFrame of winFrames) {\n        try {\n            // $FlowFixMe\n            if (isSameDomain(childFrame) && childFrame.name === name && winFrames.indexOf(childFrame) !== -1) {\n                return childFrame;\n            }\n        } catch (err) {\n            // pass\n        }\n    }\n\n    try {\n        // $FlowFixMe\n        if (winFrames.indexOf(win.frames[name]) !== -1) {\n            // $FlowFixMe\n            return win.frames[name];\n        }\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        if (winFrames.indexOf(win[name]) !== -1) {\n            return win[name];\n        }\n    } catch (err) {\n        // pass\n    }\n}\n\nexport function findChildFrameByName(win : CrossDomainWindowType, name : string) : ?CrossDomainWindowType {\n\n    let frame = getFrameByName(win, name);\n\n    if (frame) {\n        return frame;\n    }\n\n    for (let childFrame of getFrames(win)) {\n        let namedFrame = findChildFrameByName(childFrame, name);\n\n        if (namedFrame) {\n            return namedFrame;\n        }\n    }\n}\n\nexport function findFrameByName(win : CrossDomainWindowType, name : string) : ?CrossDomainWindowType {\n\n    let frame;\n\n    frame = getFrameByName(win, name);\n\n    if (frame) {\n        return frame;\n    }\n\n    let top = getTop(win) || win;\n\n    return findChildFrameByName(top, name);\n}\n\nexport function isParent(win : CrossDomainWindowType, frame : CrossDomainWindowType) : boolean {\n\n    let frameParent = getParent(frame);\n\n    if (frameParent) {\n        return frameParent === win;\n    }\n\n    for (let childFrame of getFrames(win)) {\n        if (childFrame === frame) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function isOpener(parent : CrossDomainWindowType, child : CrossDomainWindowType) : boolean {\n\n    return parent === getOpener(child);\n}\n\nexport function getAncestor(win? : CrossDomainWindowType = window) : ?CrossDomainWindowType {\n    win = win || window;\n\n    let opener = getOpener(win);\n\n    if (opener) {\n        return opener;\n    }\n\n    let parent = getParent(win);\n\n    if (parent) {\n        return parent;\n    }\n}\n\nexport function getAncestors(win : CrossDomainWindowType) : Array<CrossDomainWindowType> {\n\n    let results = [];\n\n    let ancestor = win;\n\n    while (ancestor) {\n        ancestor = getAncestor(ancestor);\n        if (ancestor) {\n            results.push(ancestor);\n        }\n    }\n\n    return results;\n}\n\n\nexport function isAncestor(parent : CrossDomainWindowType, child : CrossDomainWindowType) : boolean {\n\n    let actualParent = getAncestor(child);\n\n    if (actualParent) {\n        if (actualParent === parent) {\n            return true;\n        }\n\n        return false;\n    }\n\n    if (child === parent) {\n        return false;\n    }\n\n    if (getTop(child) === child) {\n        return false;\n    }\n\n    for (let frame of getFrames(parent)) {\n        if (frame === child) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function isPopup(win? : CrossDomainWindowType = window) : boolean {\n    return Boolean(getOpener(win));\n}\n\nexport function isIframe(win? : CrossDomainWindowType = window) : boolean {\n    return Boolean(getParent(win));\n}\n\nexport function isFullpage(win? : CrossDomainWindowType = window) : boolean {\n    return Boolean(!isIframe(win) && !isPopup(win));\n}\n\nfunction anyMatch(collection1, collection2) : boolean {\n\n    for (let item1 of collection1) {\n        for (let item2 of collection2) {\n            if (item1 === item2) {\n                return true;\n            }\n        }\n    }\n\n    return false;\n}\n\nexport function getDistanceFromTop(win : CrossDomainWindowType = window) : number {\n    let distance = 0;\n    let parent = win;\n\n    while (parent) {\n        parent = getParent(parent);\n        if (parent) {\n            distance += 1;\n        }\n    }\n\n    return distance;\n}\n\nexport function getNthParent(win : CrossDomainWindowType, n : number = 1) : ?CrossDomainWindowType {\n    let parent = win;\n\n    for (let i = 0; i < n; i++) {\n        if (!parent) {\n            return;\n        }\n\n        parent = getParent(parent);\n    }\n\n    return parent;\n}\n\nexport function getNthParentFromTop(win : CrossDomainWindowType, n : number = 1) : ?CrossDomainWindowType {\n    return getNthParent(win, getDistanceFromTop(win) - n);\n}\n\nexport function isSameTopWindow(win1 : CrossDomainWindowType, win2 : CrossDomainWindowType) : boolean {\n\n    let top1 = getTop(win1) || win1;\n    let top2 = getTop(win2) || win2;\n\n    try {\n        if (top1 && top2) {\n            if (top1 === top2) {\n                return true;\n            }\n\n            return false;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    let allFrames1 = getAllFramesInWindow(win1);\n    let allFrames2 = getAllFramesInWindow(win2);\n\n    if (anyMatch(allFrames1, allFrames2)) {\n        return true;\n    }\n\n    let opener1 = getOpener(top1);\n    let opener2 = getOpener(top2);\n\n    if (opener1 && anyMatch(getAllFramesInWindow(opener1), allFrames2)) {\n        return false;\n    }\n\n    if (opener2 && anyMatch(getAllFramesInWindow(opener2), allFrames1)) {\n        return false;\n    }\n\n    return false;\n}\n\nexport function matchDomain(pattern : DomainMatcher, origin : DomainMatcher) : boolean {\n\n    if (typeof pattern === 'string') {\n\n        if (typeof origin === 'string') {\n            return pattern === WILDCARD || origin === pattern;\n        }\n\n        if (isRegex(origin)) {\n            return false;\n        }\n\n        if (Array.isArray(origin)) {\n            return false;\n        }\n    }\n\n    if (isRegex(pattern)) {\n\n        if (isRegex(origin)) {\n            return pattern.toString() === origin.toString();\n        }\n\n        if (Array.isArray(origin)) {\n            return false;\n        }\n\n        // $FlowFixMe\n        return Boolean(origin.match(pattern));\n    }\n\n    if (Array.isArray(pattern)) {\n\n        if (Array.isArray(origin)) {\n            return JSON.stringify(pattern) === JSON.stringify(origin);\n        }\n\n        if (isRegex(origin)) {\n            return false;\n        }\n\n        return pattern.some(subpattern => matchDomain(subpattern, origin));\n    }\n\n    return false;\n}\n\nexport function stringifyDomainPattern(pattern : DomainMatcher) : string {\n    if (Array.isArray(pattern)) {\n        return `(${ pattern.join(' | ') })`;\n    } else if (isRegex(pattern)) {\n        return `RegExp(${ pattern.toString() }`;\n    } else {\n        return pattern.toString();\n    }\n}\n\nexport function getDomainFromUrl(url : string) : string {\n\n    let domain;\n\n    if (url.match(/^(https?|mock|file):\\/\\//)) {\n        domain = url;\n    } else {\n        return getDomain();\n    }\n\n    domain = domain.split('/').slice(0, 3).join('/');\n\n    return domain;\n}\n\nexport function onCloseWindow(win : CrossDomainWindowType, callback : Function, delay : number = 1000, maxtime : number = Infinity) : { cancel : () => void } {\n\n    let timeout;\n\n    let check = () => {\n\n        if (isWindowClosed(win)) {\n\n            if (timeout) {\n                clearTimeout(timeout);\n            }\n\n            return callback();\n        }\n\n        if (maxtime <= 0) {\n            clearTimeout(timeout);\n        } else {\n            maxtime -= delay;\n            timeout = setTimeout(check, delay);\n        }\n    };\n\n    check();\n\n    return {\n        cancel() {\n            if (timeout) {\n                clearTimeout(timeout);\n            }\n        }\n    };\n}\n\n// eslint-disable-next-line complexity\nexport function isWindow(obj : Object) : boolean {\n\n    try {\n        if (obj === window) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (Object.prototype.toString.call(obj) === '[object Window]') {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (window.Window && obj instanceof window.Window) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (obj && obj.self === obj) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (obj && obj.parent === obj) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (obj && obj.top === obj) {\n            return true;\n        }\n    } catch (err) {\n        if (err && err.message === IE_WIN_ACCESS_ERROR) {\n            return true;\n        }\n    }\n\n    try {\n        if (noop(obj === obj) === '__unlikely_value__') { // eslint-disable-line no-self-compare\n            return false;\n        }\n\n    } catch (err) {\n        return true;\n    }\n\n    try {\n        if (obj && obj.__cross_domain_utils_window_check__ === '__unlikely_value__') {\n            return false;\n        }\n\n    } catch (err) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function isBrowser() : boolean {\n    return (typeof window !== 'undefined' && typeof window.location !== 'undefined');\n}\n\nexport function isCurrentDomain(domain : string) : boolean {\n    if (!isBrowser()) {\n        return false;\n    }\n\n    return (getDomain() === domain);\n}\n\nexport function isMockDomain(domain : string) : boolean {\n    return domain.indexOf(PROTOCOL.MOCK) === 0;\n}\n\nexport function normalizeMockUrl(url : string) : string {\n    if (!isMockDomain(getDomainFromUrl(url))) {\n        return url;\n    }\n\n    if (!__TEST__) {\n        throw new Error(`Mock urls not supported out of test mode`);\n    }\n\n    return url.replace(/^mock:\\/\\/[^/]+/, getActualDomain(window));\n}\n\nexport function closeWindow(win : CrossDomainWindowType) {\n    try {\n        win.close();\n    } catch (err) {\n        // pass\n    }\n}\n","/* @flow */\n\n// export something to force webpack to see this as an ES module\nexport const TYPES = true;\n\nexport type CrossDomainLocationType = {|\n\n|};\n\nexport type CrossDomainWindowType = {|\n    location : string | CrossDomainLocationType,\n    self : CrossDomainWindowType,\n    closed : boolean,\n    open : (string, string, string) => CrossDomainWindowType,\n    close : () => void,\n    focus : () => void,\n    top : CrossDomainWindowType,\n    frames : Array<CrossDomainWindowType>,\n    opener ? : CrossDomainWindowType,\n    parent : CrossDomainWindowType,\n    length : number,\n    postMessage : (string, string) => void\n|};\n\nexport type SameDomainWindowType = Object & {\n    location : string | Object,\n    self : CrossDomainWindowType,\n    closed : boolean,\n    open : (string, string, string) => CrossDomainWindowType,\n    close : () => void,\n    focus : () => void,\n    XMLHttpRequest : typeof XMLHttpRequest,\n    document : Document,\n    navigator : {\n        userAgent : string,\n        mockUserAgent? : string\n    }\n};\n\nexport type DomainMatcher = string | Array<string> | $ReadOnlyArray<string> | RegExp;\n","/* @flow */\n\nexport * from './utils';\nexport * from './types';\nexport * from './constants';\n","/* @flow */\n\nexport function hasNativeWeakMap() : boolean {\n\n    if (typeof WeakMap === 'undefined') {\n        return false;\n    }\n\n    if (typeof Object.freeze === 'undefined') {\n        return false;\n    }\n\n    try {\n\n        let testWeakMap = new WeakMap();\n        let testKey = {};\n        let testValue = '__testvalue__';\n\n        Object.freeze(testKey);\n\n        testWeakMap.set(testKey, testValue);\n\n        if (testWeakMap.get(testKey) === testValue) {\n            return true;\n        }\n\n        return false;\n\n    } catch (err) {\n\n        return false;\n    }\n}\n","/* @flow */\n\nexport function safeIndexOf<T>(collection : Array<T>, item : T) : number {\n    for (let i = 0; i < collection.length; i++) {\n\n        try {\n            if (collection[i] === item) {\n                return i;\n            }\n        } catch (err) {\n            // pass\n        }\n    }\n\n    return -1;\n}\n\n// eslint-disable-next-line no-unused-vars\nexport function noop(...args : Array<mixed>) {\n    // pass\n}\n","/* @flow */\n\nimport { isWindow, isWindowClosed } from 'cross-domain-utils/src';\n\nimport { hasNativeWeakMap } from './native';\nimport { noop, safeIndexOf } from './util';\n\nexport class CrossDomainSafeWeakMap<K : Object, V : mixed> {\n\n    name : string\n    weakmap : WeakMap<K, V>\n    keys : Array<K>\n    values : Array<V>\n\n    constructor() {\n        // eslint-disable-next-line no-bitwise\n        this.name = `__weakmap_${ Math.random() * 1e9 >>> 0 }__`;\n\n        if (hasNativeWeakMap()) {\n            try {\n                this.weakmap = new WeakMap();\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this.keys  = [];\n        this.values = [];\n    }\n\n    _cleanupClosedWindows() {\n\n        let weakmap = this.weakmap;\n        let keys = this.keys;\n\n        for (let i = 0; i < keys.length; i++) {\n            let value = keys[i];\n\n            if (isWindow(value) && isWindowClosed(value)) {\n\n                if (weakmap) {\n                    try {\n                        weakmap.delete(value);\n                    } catch (err) {\n                        // pass\n                    }\n                }\n\n                keys.splice(i, 1);\n                this.values.splice(i, 1);\n\n                i -= 1;\n            }\n        }\n    }\n\n    isSafeToReadWrite(key : K) : boolean {\n\n        if (isWindow(key)) {\n            return false;\n        }\n\n        try {\n            noop(key && key.self);\n            noop(key && key[this.name]);\n        } catch (err) {\n            return false;\n        }\n\n        return true;\n    }\n\n    set(key : K, value : V) {\n\n        if (!key) {\n            throw new Error(`WeakMap expected key`);\n        }\n\n        let weakmap = this.weakmap;\n\n        if (weakmap) {\n            try {\n                weakmap.set(key, value);\n            } catch (err) {\n                delete this.weakmap;\n            }\n        }\n\n        if (this.isSafeToReadWrite(key)) {\n            try {\n                let name = this.name;\n                let entry = key[name];\n\n                if (entry && entry[0] === key) {\n                    entry[1] = value;\n                } else {\n                    Object.defineProperty(key, name, {\n                        value:    [ key, value ],\n                        writable: true\n                    });\n                }\n\n                return;\n\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this._cleanupClosedWindows();\n\n        let keys = this.keys;\n        let values = this.values;\n        let index = safeIndexOf(keys, key);\n\n        if (index === -1) {\n            keys.push(key);\n            values.push(value);\n        } else {\n            values[index] = value;\n        }\n    }\n\n    get(key : K) : V | void {\n\n        if (!key) {\n            throw new Error(`WeakMap expected key`);\n        }\n\n        let weakmap = this.weakmap;\n\n        if (weakmap) {\n            try {\n                if (weakmap.has(key)) {\n                    return weakmap.get(key);\n                }\n                \n            } catch (err) {\n                delete this.weakmap;\n            }\n        }\n\n        if (this.isSafeToReadWrite(key)) {\n            try {\n                let entry = key[this.name];\n\n                if (entry && entry[0] === key) {\n                    return entry[1];\n                }\n\n                return;\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this._cleanupClosedWindows();\n\n        let keys = this.keys;\n        let index = safeIndexOf(keys, key);\n\n        if (index === -1) {\n            return;\n        }\n\n        return this.values[index];\n    }\n\n    delete(key : K) {\n\n        if (!key) {\n            throw new Error(`WeakMap expected key`);\n        }\n\n        let weakmap = this.weakmap;\n\n        if (weakmap) {\n            try {\n                weakmap.delete(key);\n            } catch (err) {\n                delete this.weakmap;\n            }\n        }\n\n        if (this.isSafeToReadWrite(key)) {\n            try {\n                let entry = key[this.name];\n\n                if (entry && entry[0] === key) {\n                    entry[0] = entry[1] = undefined;\n                }\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this._cleanupClosedWindows();\n\n        let keys = this.keys;\n        let index = safeIndexOf(keys, key);\n\n        if (index !== -1) {\n            keys.splice(index, 1);\n            this.values.splice(index, 1);\n        }\n    }\n\n    has(key : K) : boolean {\n\n        if (!key) {\n            throw new Error(`WeakMap expected key`);\n        }\n\n        let weakmap = this.weakmap;\n\n        if (weakmap) {\n            try {\n                if (weakmap.has(key)) {\n                    return true;\n                }\n            } catch (err) {\n                delete this.weakmap;\n            }\n        }\n\n        if (this.isSafeToReadWrite(key)) {\n            try {\n                let entry = key[this.name];\n\n                if (entry && entry[0] === key) {\n                    return true;\n                }\n\n                return false;\n            } catch (err) {\n                // pass\n            }\n        }\n\n        this._cleanupClosedWindows();\n\n        let index = safeIndexOf(this.keys, key);\n        return index !== -1;\n    }\n\n    getOrSet(key : K, getter : () => V) : V {\n        if (this.has(key)) {\n            // $FlowFixMe\n            return this.get(key);\n        }\n\n        let value = getter();\n        this.set(key, value);\n        return value;\n    }\n}\n","/* @flow */\n/* eslint max-lines: 0 */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { WeakMap } from 'cross-domain-safe-weakmap/src';\n\nimport type { CancelableType } from './types';\n\nexport function getFunctionName <T : Function>(fn : T) : string {\n    return fn.name || fn.__name__ || fn.displayName || 'anonymous';\n}\n\nexport function setFunctionName <T : Function>(fn : T, name : string) : T {\n    try {\n        delete fn.name;\n        fn.name = name;\n    } catch (err) {\n        // pass\n    }\n\n    fn.__name__ = fn.displayName = name;\n    return fn;\n}\n\nexport function base64encode(str : string) : string {\n    if (typeof btoa === 'function') {\n        return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (m, p1) => {\n            return String.fromCharCode(parseInt(p1, 16));\n        }));\n    }\n\n    if (typeof Buffer !== 'undefined') {\n        return Buffer.from(str, 'utf8').toString('base64');\n    }\n\n    throw new Error(`Can not find window.btoa or Buffer`);\n}\n\nexport function base64decode(str : string) : string {\n    if (typeof atob === 'function') {\n        return decodeURIComponent(Array.prototype.map.call(atob(str), c => {\n            // eslint-disable-next-line prefer-template\n            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n        }).join(''));\n    }\n\n    if (typeof Buffer !== 'undefined') {\n        return Buffer.from(str, 'base64').toString('utf8');\n    }\n\n    throw new Error(`Can not find window.atob or Buffer`);\n}\n\nexport function uniqueID() : string {\n\n    let chars = '0123456789abcdef';\n\n    let randomID = 'xxxxxxxxxx'.replace(/./g, () => {\n        return chars.charAt(Math.floor(Math.random() * chars.length));\n    });\n\n    let timeID = base64encode(\n        new Date().toISOString().slice(11, 19).replace('T', '.')\n    ).replace(/[^a-zA-Z0-9]/g, '').toLowerCase();\n\n    return `${ randomID }_${ timeID }`;\n}\n\nexport function getGlobal() : Object {\n    if (typeof window !== 'undefined') {\n        return window;\n    }\n    if (typeof global !== 'undefined') {\n        return global;\n    }\n    if (typeof __GLOBAL__ !== 'undefined') {\n        return __GLOBAL__;\n    }\n    throw new Error(`No global found`);\n}\n\nlet objectIDs;\n\nexport function getObjectID(obj : Object) : string {\n\n    objectIDs = objectIDs || new WeakMap();\n\n    if (obj === null || obj === undefined || (typeof obj !== 'object' && typeof obj !== 'function')) {\n        throw new Error(`Invalid object`);\n    }\n\n    let uid = objectIDs.get(obj);\n\n    if (!uid) {\n        uid = `${ typeof obj }:${ uniqueID() }`;\n        objectIDs.set(obj, uid);\n    }\n\n    return uid;\n}\n\nfunction serializeArgs<T>(args : Array<T>) : string {\n    try {\n        return JSON.stringify(Array.prototype.slice.call(args), (subkey, val) => {\n            if (typeof val === 'function') {\n                return `memoize[${ getObjectID(val) }]`;\n            }\n            return val;\n        });\n    } catch (err) {\n        throw new Error(`Arguments not serializable -- can not be used to memoize`);\n    }\n}\nexport function memoize<A, R, F : (...args : Array<A>) => R, X : { (...args : Array<A>) : R, displayName : string, reset : () => void }>(method : F, options : { time? : number, thisNamespace? : boolean } = {}) : X {\n    let cacheMap = new WeakMap();\n\n    // $FlowFixMe\n    let memoizedFunction : X = function memoizedFunction(...args : Array<A>) : R {\n        let cache = cacheMap.getOrSet(options.thisNamespace ? this : method, () => ({}));\n\n        let key : string = serializeArgs(args);\n\n        let cacheTime = options.time;\n        if (cache[key] && cacheTime && (Date.now() - cache[key].time) < cacheTime) {\n            delete cache[key];\n        }\n\n        if (cache[key]) {\n            return cache[key].value;\n        }\n\n        let time  = Date.now();\n        let value = method.apply(this, arguments);\n\n        cache[key] = { time, value };\n\n        return cache[key].value;\n    };\n\n    memoizedFunction.reset = () => {\n        cacheMap.delete(options.thisNamespace ? this : method);\n    };\n\n    return setFunctionName(memoizedFunction, `${ getFunctionName(method) }::memoized`);\n}\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport function memoizePromise<R>(method : (...args : Array<any>) => ZalgoPromise<R>) : ((...args : Array<any>) => ZalgoPromise<R>) {\n    let cache = {};\n\n    // eslint-disable-next-line flowtype/no-weak-types\n    function memoizedPromiseFunction(...args : Array<any>) : ZalgoPromise<R> {\n        let key : string = serializeArgs(args);\n\n        if (cache.hasOwnProperty(key)) {\n            return cache[key];\n        }\n\n        cache[key] = ZalgoPromise.try(() => method.apply(this, arguments))\n            .finally(() => {\n                delete cache[key];\n            });\n\n        return cache[key];\n    }\n\n    memoizedPromiseFunction.reset = () => {\n        cache = {};\n    };\n\n    return setFunctionName(memoizedPromiseFunction, `${ getFunctionName(method) }::promiseMemoized`);\n}\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport function promisify<R>(method : (...args : Array<any>) => R, options : { name? : string } = {}) : ((...args : Array<any>) => ZalgoPromise<R>) {\n    function promisifiedFunction() : ZalgoPromise<R> {\n        return ZalgoPromise.try(method, this, arguments);\n    }\n\n    if (options.name) {\n        promisifiedFunction.displayName = `${ options.name }:promisified`;\n    }\n\n    return setFunctionName(promisifiedFunction, `${ getFunctionName(method) }::promisified`);\n}\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport function inlineMemoize<R>(method : (...args : Array<any>) => R, logic : (...args : Array<any>) => R, args : Array<any> = []) : R {\n    // $FlowFixMe\n    let cache = method.__inline_memoize_cache__ = method.__inline_memoize_cache__ || {};\n    let key = serializeArgs(args);\n\n    if (cache.hasOwnProperty(key)) {\n        return cache[key];\n    }\n    \n    let result = cache[key] = logic(...args);\n\n    return result;\n}\n\n// eslint-disable-next-line no-unused-vars\nexport function noop(...args : Array<mixed>) {\n    // pass\n}\n\nexport function once(method : Function) : Function {\n    let called = false;\n\n    const onceFunction = function() : mixed {\n        if (!called) {\n            called = true;\n            return method.apply(this, arguments);\n        }\n    };\n\n    return setFunctionName(onceFunction, `${ getFunctionName(method) }::once`);\n}\n\nexport function hashStr(str : string) : number {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n        hash += str[i].charCodeAt(0) * Math.pow((i % 10) + 1, 5);\n    }\n    return Math.floor(Math.pow(Math.sqrt(hash), 5));\n}\n\nexport function strHashStr(str : string) : string {\n    let hash = '';\n\n    for (let i = 0; i < str.length; i++) {\n        let total = (str[i].charCodeAt(0) * i);\n\n        if (str[i + 1]) {\n            total += (str[i + 1].charCodeAt(0) * (i - 1));\n        }\n\n        hash += String.fromCharCode(97 + (Math.abs(total) % 26));\n    }\n\n    return hash;\n}\n\nexport function match(str : string, pattern : RegExp) : ?string {\n    let regmatch = str.match(pattern);\n    if (regmatch) {\n        return regmatch[1];\n    }\n}\n\nexport function awaitKey<T: mixed>(obj : Object, key : string) : ZalgoPromise<T> {\n    return new ZalgoPromise(resolve => {\n\n        let value = obj[key];\n\n        if (value) {\n            return resolve(value);\n        }\n\n        delete obj[key];\n\n        Object.defineProperty(obj, key, {\n\n            configurable: true,\n\n            set(item) {\n                value = item;\n\n                if (value) {\n                    resolve(value);\n                }\n            },\n\n            get() : mixed {\n                return value;\n            }\n        });\n    });\n}\n\nexport function stringifyError(err : mixed, level : number = 1) : string {\n\n    if (level >= 3) {\n        return 'stringifyError stack overflow';\n    }\n\n    try {\n        if (!err) {\n            return `<unknown error: ${ Object.prototype.toString.call(err) }>`;\n        }\n\n        if (typeof err === 'string') {\n            return err;\n        }\n\n        if (err instanceof Error) {\n            let stack = err && err.stack;\n            let message = err && err.message;\n\n            if (stack && message) {\n                if (stack.indexOf(message) !== -1) {\n                    return stack;\n                } else {\n                    return `${ message }\\n${ stack }`;\n                }\n            } else if (stack) {\n                return stack;\n            } else if (message) {\n                return message;\n            }\n        }\n\n        if (err && err.toString && typeof err.toString === 'function') {\n            // $FlowFixMe\n            return err.toString();\n        }\n\n        return Object.prototype.toString.call(err);\n\n    } catch (newErr) { // eslint-disable-line unicorn/catch-error-name\n        return `Error while stringifying error: ${ stringifyError(newErr, level + 1) }`;\n    }\n}\n\nexport function stringifyErrorMessage(err : mixed) : string {\n\n    let defaultMessage = `<unknown error: ${ Object.prototype.toString.call(err) }>`;\n\n    if (!err) {\n        return defaultMessage;\n    }\n\n    if (err instanceof Error) {\n        return err.message || defaultMessage;\n    }\n\n    if (typeof err.message === 'string') {\n        return err.message || defaultMessage;\n    }\n\n    return defaultMessage;\n}\n\nexport function stringify(item : mixed) : string {\n    if (typeof item === 'string') {\n        return item;\n    }\n\n    if (item && item.toString && typeof item.toString === 'function') {\n        // $FlowFixMe\n        return item.toString();\n    }\n\n    return Object.prototype.toString.call(item);\n}\n\nexport function domainMatches(hostname : string, domain : string) : boolean {\n    hostname = hostname.split('://')[1];\n    let index = hostname.indexOf(domain);\n    return (index !== -1 && hostname.slice(index) === domain);\n}\n\nexport function patchMethod(obj : Object, name : string, handler : Function) {\n    let original = obj[name];\n\n    obj[name] = function patchedMethod() : mixed {\n        return handler({\n            context:      this,\n            args:         Array.prototype.slice.call(arguments),\n            original,\n            callOriginal: () => original.apply(this, arguments)\n        });\n    };\n}\n\nexport function extend<T : Object | Function>(obj : T, source : Object) : T {\n    if (!source) {\n        return obj;\n    }\n\n    if (Object.assign) {\n        return Object.assign(obj, source);\n    }\n\n    for (let key in source) {\n        if (source.hasOwnProperty(key)) {\n            obj[key] = source[key];\n        }\n    }\n\n    return obj;\n}\n\nexport function values<T>(obj : { [string] : T }) : Array<T> {\n    let result = [];\n    for (let key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            result.push(obj[key]);\n        }\n    }\n    return result;\n}\n\nexport function perc(pixels : number, percentage : number) : number {\n    return Math.round((pixels * percentage) / 100);\n}\n\nexport function min(...args : Array<number>) : number {\n    return Math.min(...args);\n}\n\nexport function max(...args : Array<number>) : number {\n    return Math.max(...args);\n}\n\nexport function regexMap<T>(str : string, regexp : RegExp, handler : () => T) : Array<T> {\n    let results = [];\n\n    // $FlowFixMe\n    str.replace(regexp, function regexMapMatcher(item) {\n        results.push(handler ? handler.apply(null, arguments) : item);\n    });\n\n    // $FlowFixMe\n    return results;\n}\n\nexport function svgToBase64(svg : string) : string {\n    return `data:image/svg+xml;base64,${ base64encode(svg) }`;\n}\n\nexport function objFilter<T, R>(obj : { [string] : T }, filter? : (T, ?string) => mixed = Boolean) : { [string] : R } {\n    let result = {};\n\n    for (let key in obj) {\n        if (!obj.hasOwnProperty(key) || !filter(obj[key], key)) {\n            continue;\n        }\n\n        result[key] = obj[key];\n    }\n\n    return result;\n}\n\nexport function identity <T>(item : T) : T {\n    return item;\n}\n\nexport function regexTokenize(text : string, regexp : RegExp) : Array<string> {\n    let result = [];\n    text.replace(regexp, token => {\n        result.push(token);\n        return '';\n    });\n    return result;\n}\n\nexport function promiseDebounce<T>(method : () => ZalgoPromise<T> | T, delay : number = 50) : () => ZalgoPromise<T> {\n\n    let promise;\n    let timeout;\n\n    const promiseDebounced = function() : ZalgoPromise<T> {\n        if (timeout) {\n            clearTimeout(timeout);\n        }\n\n        let localPromise = promise = promise || new ZalgoPromise();\n\n        timeout = setTimeout(() => {\n            promise = null;\n            timeout = null;\n\n            ZalgoPromise.try(method).then(\n                result => { localPromise.resolve(result); },\n                err => { localPromise.reject(err); }\n            );\n        }, delay);\n\n        return localPromise;\n    };\n\n    return setFunctionName(promiseDebounced, `${ getFunctionName(method) }::promiseDebounced`);\n}\n\nexport function safeInterval(method : Function, time : number) : { cancel : () => void } {\n\n    let timeout;\n\n    function loop() {\n        timeout = setTimeout(() => {\n            method();\n            loop();\n        }, time);\n    }\n\n    loop();\n\n    return {\n        cancel() {\n            clearTimeout(timeout);\n        }\n    };\n}\n\nexport function isInteger(str : string) : boolean {\n    return Boolean(str.match(/^[0-9]+$/));\n}\n\nexport function isFloat(str : string) : boolean {\n    return Boolean(str.match(/^[0-9]+\\.[0-9]+$/));\n}\n\nexport function serializePrimitive(value : string | number | boolean) : string {\n    return value.toString();\n}\n\nexport function deserializePrimitive(value : string) : string | number | boolean {\n    if (value === 'true') {\n        return true;\n    } else if (value === 'false') {\n        return false;\n    } else if (isInteger(value)) {\n        return parseInt(value, 10);\n    } else if (isFloat(value)) {\n        return parseFloat(value);\n    } else {\n        return value;\n    }\n}\n\nexport function dotify(obj : Object, prefix : string = '', newobj : Object = {}) : { [string] : string } {\n    prefix = prefix ? `${ prefix }.` : prefix;\n    for (let key in obj) {\n        if (!obj.hasOwnProperty(key) || obj[key] === undefined || obj[key] === null || typeof obj[key] === 'function') {\n            continue;\n        } else if (obj[key] && Array.isArray(obj[key]) && obj[key].length && obj[key].every(val => typeof val !== 'object')) {\n            newobj[`${ prefix }${ key }[]`] = obj[key].join(',');\n        } else if (obj[key] && typeof obj[key] === 'object') {\n            newobj = dotify(obj[key], `${ prefix }${ key }`, newobj);\n        } else {\n            newobj[`${ prefix }${ key }`] = serializePrimitive(obj[key]);\n        }\n    }\n    return newobj;\n}\n\nexport function undotify(obj : { [string] : string }) : Object {\n    \n    let result = {};\n\n    for (let key in obj) {\n        if (!obj.hasOwnProperty(key) || typeof obj[key] !== 'string') {\n            continue;\n        }\n\n        let value = obj[key];\n\n        if (key.match(/^.+\\[\\]$/)) {\n            key = key.slice(0, key.length - 2);\n            value = value.split(',').map(deserializePrimitive);\n        } else {\n            value = deserializePrimitive(value);\n        }\n\n        let keyResult = result;\n        let parts = key.split('.');\n        for (let i = 0; i < parts.length; i++) {\n            let part = parts[i];\n            let isLast = (i + 1 === parts.length);\n            let isIndex = !isLast && isInteger(parts[i + 1]);\n\n            if (part === 'constructor' || part === 'prototype' || part === '__proto__') {\n                throw new Error(`Disallowed key: ${ part }`);\n            }\n\n            if (isLast) {\n                // $FlowFixMe\n                keyResult[part] = value;\n            } else {\n                // $FlowFixMe\n                keyResult = keyResult[part] = keyResult[part] || (isIndex ? [] : {});\n            }\n        }\n    }\n\n    return result;\n}\n\nexport type EventEmitterType = {\n    on : (eventName : string, handler : Function) => CancelableType,\n    once : (eventName : string, handler : Function) => CancelableType,\n    trigger : (eventName : string, ...args : $ReadOnlyArray<mixed>) => ZalgoPromise<void>,\n    triggerOnce : (eventName : string, ...args : $ReadOnlyArray<mixed>) => ZalgoPromise<void>\n};\n\nexport function eventEmitter() : EventEmitterType {\n    let triggered = {};\n    let handlers = {};\n\n    return {\n\n        on(eventName : string, handler : Function) : CancelableType {\n            let handlerList = handlers[eventName] = handlers[eventName] || [];\n\n            handlerList.push(handler);\n\n            let cancelled = false;\n\n            return {\n                cancel() {\n                    if (!cancelled) {\n                        cancelled = true;\n                        handlerList.splice(handlerList.indexOf(handler), 1);\n                    }\n\n                }\n            };\n        },\n\n        once(eventName : string, handler : Function) : CancelableType {\n\n            let listener = this.on(eventName, () => {\n                listener.cancel();\n                handler();\n            });\n\n            return listener;\n        },\n\n        trigger(eventName : string, ...args : $ReadOnlyArray<mixed>) : ZalgoPromise<void> {\n\n            let handlerList = handlers[eventName];\n            let promises = [];\n\n            if (handlerList) {\n                for (let handler of handlerList) {\n                    promises.push(ZalgoPromise.try(() => handler(...args)));\n                }\n            }\n\n            return ZalgoPromise.all(promises).then(noop);\n        },\n\n        triggerOnce(eventName : string, ...args : $ReadOnlyArray<mixed>) : ZalgoPromise<void> {\n\n            if (triggered[eventName]) {\n                return ZalgoPromise.resolve();\n            }\n\n            triggered[eventName] = true;\n            return this.trigger(eventName, ...args);\n        }\n    };\n}\n\nexport function camelToDasherize(string : string) : string {\n    return string.replace(/([A-Z])/g, (g) => {\n        return `-${ g.toLowerCase() }`;\n    });\n}\n\nexport function dasherizeToCamel(string : string) : string {\n    return string.replace(/-([a-z])/g, (g) => {\n        return g[1].toUpperCase();\n    });\n}\n\nexport function capitalizeFirstLetter(string : string) : string {\n    return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n}\n\nexport function get(item : Object, path : string, def : mixed) : mixed {\n\n    if (!path) {\n        return def;\n    }\n\n    let pathParts = path.split('.');\n\n    // Loop through each section of our key path\n\n    for (let i = 0; i < pathParts.length; i++) {\n\n        // If we have an object, we can get the key\n        if (typeof item === 'object' && item !== null) {\n            item = item[pathParts[i]];\n\n        // Otherwise, we should return the default (undefined if not provided)\n        } else {\n            return def;\n        }\n    }\n\n    // If our final result is undefined, we should return the default\n\n    return item === undefined ? def : item;\n}\n\nexport function safeTimeout(method : Function, time : number) {\n\n    let interval = safeInterval(() => {\n        time -= 100;\n        if (time <= 0) {\n            interval.cancel();\n            method();\n        }\n    }, 100);\n}\n\nexport function defineLazyProp<T>(obj : Object | Array<mixed>, key : string | number, getter : () => T) {\n    if (Array.isArray(obj)) {\n        if (typeof key !== 'number') {\n            throw new TypeError(`Array key must be number`);\n        }\n    } else if (typeof obj === 'object' && obj !== null) {\n        if (typeof key !== 'string') {\n            throw new TypeError(`Object key must be string`);\n        }\n    }\n    \n    Object.defineProperty(obj, key, {\n        configurable: true,\n        enumerable:   true,\n        get:          () => {\n            // $FlowFixMe\n            delete obj[key];\n            let value = getter();\n            // $FlowFixMe\n            obj[key] = value;\n            return value;\n        },\n        set: (value : T) => {\n            // $FlowFixMe\n            delete obj[key];\n            // $FlowFixMe\n            obj[key] = value;\n        }\n    });\n}\n\nexport function arrayFrom<T>(item : Iterable<T>) : Array<T> { // eslint-disable-line no-undef\n    return Array.prototype.slice.call(item);\n}\n\nexport function isObject(item : mixed) : boolean {\n    return (typeof item === 'object' && item !== null);\n}\n\nexport function isObjectObject(obj : mixed) : boolean {\n    return isObject(obj) && Object.prototype.toString.call(obj) === '[object Object]';\n}\n\nexport function isPlainObject(obj : mixed) : boolean {\n    if (!isObjectObject(obj)) {\n        return false;\n    }\n\n    // $FlowFixMe\n    let constructor = obj.constructor;\n\n    if (typeof constructor !== 'function') {\n        return false;\n    }\n\n    let prototype = constructor.prototype;\n\n    if (!isObjectObject(prototype)) {\n        return false;\n    }\n\n    if (!prototype.hasOwnProperty('isPrototypeOf')) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function replaceObject<T : Array<mixed> | Object> (item : T, replacer : (mixed, string | number, string) => mixed, fullKey : string = '') : T {\n\n    if (Array.isArray(item)) {\n        let length = item.length;\n        let result : Array<mixed> = [];\n\n        for (let i = 0; i < length; i++) {\n\n            \n            defineLazyProp(result, i, () => {\n                let itemKey = fullKey ? `${ fullKey }.${ i }` : `${ i }`;\n                let el = item[i];\n\n                let child = replacer(el, i, itemKey);\n\n                if (isPlainObject(child) || Array.isArray(child)) {\n                    // $FlowFixMe\n                    child = replaceObject(child, replacer, itemKey);\n                }\n\n                return child;\n            });\n        }\n\n        // $FlowFixMe\n        return result;\n    } else if (isPlainObject(item)) {\n        let result = {};\n\n        for (let key in item) {\n            if (!item.hasOwnProperty(key)) {\n                continue;\n            }\n\n            defineLazyProp(result, key, () => {\n                let itemKey = fullKey ? `${ fullKey }.${ key }` : `${ key }`;\n                // $FlowFixMe\n                let el = item[key];\n\n                let child = replacer(el, key, itemKey);\n\n                if (isPlainObject(child) || Array.isArray(child)) {\n                    // $FlowFixMe\n                    child = replaceObject(child, replacer, itemKey);\n                }\n\n                return child;\n            });\n        }\n\n        // $FlowFixMe\n        return result;\n    } else {\n        throw new Error(`Pass an object or array`);\n    }\n}\n\n\nexport function copyProp(source : Object, target : Object, name : string, def : mixed) {\n    if (source.hasOwnProperty(name)) {\n        let descriptor = Object.getOwnPropertyDescriptor(source, name);\n        // $FlowFixMe\n        Object.defineProperty(target, name, descriptor);\n\n    } else {\n        target[name] = def;\n    }\n}\n\ntype RegexResultType = {\n    text : string,\n    groups : Array<string>,\n    start : number,\n    end : number,\n    length : number,\n    replace : (text : string) => string\n};\n\nexport function regex(pattern : string | RegExp, string : string, start : number = 0) : ?RegexResultType {\n\n    if (typeof pattern === 'string') {\n        // eslint-disable-next-line security/detect-non-literal-regexp\n        pattern = new RegExp(pattern);\n    }\n\n    let result = string.slice(start).match(pattern);\n\n    if (!result) {\n        return;\n    }\n\n    // $FlowFixMe\n    let index : number = result.index;\n    let regmatch = result[0];\n\n    return {\n        text:   regmatch,\n        groups: result.slice(1),\n        start:  start + index,\n        end:    start + index + regmatch.length,\n        length: regmatch.length,\n\n        replace(text : string) : string {\n\n            if (!regmatch) {\n                return '';\n            }\n\n            return `${ regmatch.slice(0, start + index) }${ text }${ regmatch.slice(index + regmatch.length) }`;\n        }\n    };\n}\n\nexport function regexAll(pattern : string | RegExp, string : string) : Array<RegexResultType> {\n\n    let matches = [];\n    let start = 0;\n\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n        let regmatch = regex(pattern, string, start);\n\n        if (!regmatch) {\n            break;\n        }\n\n        matches.push(regmatch);\n        start = match.end;\n    }\n\n    return matches;\n}\n\nexport function isDefined(value : ?mixed) : boolean {\n    return value !== null && value !== undefined;\n}\n\nexport function cycle(method : Function) : ZalgoPromise<void> {\n    return ZalgoPromise.try(method).then(() => cycle(method));\n}\n\nexport function debounce<T>(method : (...args : Array<mixed>) => T, time : number = 100) : (...args : Array<mixed>) => void {\n\n    let timeout;\n\n    const debounceWrapper = function() {\n        clearTimeout(timeout);\n\n        timeout = setTimeout(() => {\n            return method.apply(this, arguments);\n        }, time);\n    };\n\n    return setFunctionName(debounceWrapper, `${ getFunctionName(method) }::debounced`);\n}\n\nexport function isRegex(item : mixed) : boolean {\n    return Object.prototype.toString.call(item) === '[object RegExp]';\n}\n\ntype FunctionProxy<T : Function> = (method : T) => T;\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport let weakMapMemoize : FunctionProxy<*> = <R : mixed>(method : (arg : any) => R) : ((...args : Array<any>) => R) => {\n\n    let weakmap = new WeakMap();\n\n    // eslint-disable-next-line flowtype/no-weak-types\n    return function weakmapMemoized(arg : any) : R {\n        return weakmap.getOrSet(arg, () => method.call(this, arg));\n    };\n};\n\ntype FunctionPromiseProxy<R : mixed, T : (...args : $ReadOnlyArray<mixed>) => ZalgoPromise<R>> = (T) => T;\n\n// eslint-disable-next-line flowtype/no-weak-types\nexport let weakMapMemoizePromise : FunctionPromiseProxy<*, *> = <R : mixed>(method : (arg : any) => ZalgoPromise<R>) : ((...args : Array<any>) => ZalgoPromise<R>) => {\n\n    let weakmap = new WeakMap();\n\n    // eslint-disable-next-line flowtype/no-weak-types\n    return function weakmapMemoizedPromise(arg : any) : ZalgoPromise<R> {\n        return weakmap.getOrSet(arg, () =>\n            method.call(this, arg).finally(() => {\n                weakmap.delete(arg);\n            })\n        );\n    };\n};\n\nexport function getOrSet<O : Object, T : mixed>(obj : O, key : string, getter : () => T) : T {\n    if (obj.hasOwnProperty(key)) {\n        return obj[key];\n    }\n\n    const val = getter();\n    obj[key] = val;\n    return val;\n}\n\nexport type CleanupType = {|\n    set : <T : mixed>(string, T) => T, // eslint-disable-line no-undef\n    register : (Function) => void,\n    all : () => ZalgoPromise<void>\n|};\n\nexport function cleanup(obj : Object) : CleanupType {\n\n    const tasks = [];\n    let cleaned = false;\n\n    return {\n        set<T : mixed>(name : string, item : T) : T {\n            if (!cleaned) {\n                obj[name] = item;\n                this.register(() => {\n                    delete obj[name];\n                });\n            }\n            return item;\n        },\n\n        register(method : Function) {\n            if (cleaned) {\n                method();\n            } else {\n                tasks.push(once(method));\n            }\n        },\n\n        all() : ZalgoPromise<void> {\n            const results = [];\n            cleaned = true;\n\n            while (tasks.length) {\n                const task = tasks.pop();\n                results.push(task());\n            }\n\n            return ZalgoPromise.all(results).then(noop);\n        }\n    };\n}\n\nexport function tryCatch<T>(fn : () => T) : {| result : T, error : void |} | {| result : void, error : mixed |} {\n    let result;\n    let error;\n\n    try {\n        result = fn();\n    } catch (err) {\n        error = err;\n    }\n    \n    // $FlowFixMe\n    return { result, error };\n}\n\nexport function removeFromArray<X, T : Array<X>>(arr : T, item : X) {\n    const index = arr.indexOf(item);\n    if (index !== -1) {\n        arr.splice(index, 1);\n    }\n}\n\nexport function assertExists<T>(name : string, thing : void | null | T) : T {\n    if (thing === null || typeof thing === 'undefined') {\n        throw new Error(`Expected ${ name } to be present`);\n    }\n                            \n    return thing;\n}\n                            \nexport function unique(arr : $ReadOnlyArray<string>) : $ReadOnlyArray<string> {\n    const result = {};\n    for (const item of arr) {\n        // eslint-disable-next-line const-immutable/no-mutation\n        result[item] = true;\n    }\n    return Object.keys(result);\n}\n","/* @flow */\n\nexport const KEY_CODES = {\n    ENTER: 13\n};\n","/* @flow */\n/* eslint max-lines: off */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { linkFrameWindow, isWindowClosed,\n    type SameDomainWindowType, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { WeakMap } from 'cross-domain-safe-weakmap/src';\n\nimport { inlineMemoize, noop, stringify, capitalizeFirstLetter,\n    once, extend, safeInterval, uniqueID, arrayFrom } from './util';\nimport { isDevice } from './device';\nimport { KEY_CODES } from './constants';\nimport type { CancelableType } from './types';\n\ntype ElementRefType = string | HTMLElement;\n\nexport function isDocumentReady() : boolean {\n    return Boolean(document.body) && document.readyState === 'complete';\n}\n\nexport function urlEncode(str : string) : string {\n    return str.replace(/\\?/g, '%3F').replace(/&/g, '%26').replace(/#/g, '%23').replace(/\\+/g, '%2B');\n}\n\nexport function waitForWindowReady() : ZalgoPromise<void> {\n    return inlineMemoize(waitForWindowReady, () : ZalgoPromise<void> => {\n        return new ZalgoPromise(resolve => {\n            if (isDocumentReady()) {\n                resolve();\n            }\n\n            window.addEventListener('load', () => resolve());\n        });\n    });\n}\n\nexport function waitForDocumentReady() : ZalgoPromise<void> {\n    return inlineMemoize(waitForDocumentReady, () : ZalgoPromise<void> => {\n        return new ZalgoPromise(resolve => {\n\n            if (isDocumentReady()) {\n                return resolve();\n            }\n\n            let interval = setInterval(() => {\n                if (isDocumentReady()) {\n                    clearInterval(interval);\n                    return resolve();\n                }\n            }, 10);\n        });\n    });\n}\n\nexport function waitForDocumentBody() : ZalgoPromise<HTMLBodyElement> {\n    return waitForDocumentReady().then(() => {\n        if (document.body) {\n            return document.body;\n        }\n\n        throw new Error('Document ready but document.body not present');\n    });\n}\n\nexport function parseQuery(queryString : string) : Object {\n    return inlineMemoize(parseQuery, () : Object => {\n        let params = {};\n\n        if (!queryString) {\n            return params;\n        }\n\n        if (queryString.indexOf('=') === -1) {\n            return params;\n        }\n\n        for (let pair of queryString.split('&')) {\n            pair = pair.split('=');\n\n            if (pair[0] && pair[1]) {\n                params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n            }\n        }\n\n        return params;\n    }, [ queryString ]);\n}\n\n\nexport function getQueryParam(name : string) : string {\n    return parseQuery(window.location.search.slice(1))[name];\n}\n\nexport function urlWillRedirectPage(url : string) : boolean {\n\n    if (url.indexOf('#') === -1) {\n        return true;\n    }\n\n    if (url.indexOf('#') === 0) {\n        return false;\n    }\n\n    if (url.split('#')[0] === window.location.href.split('#')[0]) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function formatQuery(obj : { [ string ] : string } = {}) : string {\n\n    return Object.keys(obj).filter(key => {\n        return typeof obj[key] === 'string';\n    }).map(key => {\n        return `${ urlEncode(key) }=${ urlEncode(obj[key]) }`;\n    }).join('&');\n}\n\nexport function extendQuery(originalQuery : string, props : { [ string ] : string } = {}) : string {\n\n    if (!props || !Object.keys(props).length) {\n        return originalQuery;\n    }\n\n    return formatQuery({\n        ...parseQuery(originalQuery),\n        ...props\n    });\n}\n\nexport function extendUrl(url : string, options : { query? : { [string] : string }, hash? : { [string] : string } } = {}) : string {\n\n    let query = options.query || {};\n    let hash = options.hash || {};\n\n    let originalUrl;\n    let originalQuery;\n    let originalHash;\n\n    [ originalUrl, originalHash ] = url.split('#');\n    [ originalUrl, originalQuery ] = originalUrl.split('?');\n\n    let queryString = extendQuery(originalQuery, query);\n    let hashString = extendQuery(originalHash, hash);\n\n    if (queryString) {\n        originalUrl = `${ originalUrl }?${ queryString }`;\n    }\n\n    if (hashString) {\n        originalUrl = `${ originalUrl }#${ hashString }`;\n    }\n\n    return originalUrl;\n}\n\nexport function redirect(url : string, win : CrossDomainWindowType = window) : ZalgoPromise<void> {\n    return new ZalgoPromise(resolve => {\n        win.location = url;\n        if (!urlWillRedirectPage(url)) {\n            resolve();\n        }\n    });\n}\n\nexport function hasMetaViewPort() : boolean {\n    let meta = document.querySelector('meta[name=viewport]');\n\n    if (isDevice() && window.screen.width < 660 && !meta) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function isElementVisible(el : HTMLElement) : boolean {\n    return Boolean(el.offsetWidth || el.offsetHeight || el.getClientRects().length);\n}\n\nexport function enablePerformance() : boolean {\n    return inlineMemoize(enablePerformance, () : boolean => {\n        /* eslint-disable compat/compat */\n        return Boolean(\n            window.performance &&\n            performance.now &&\n            performance.timing &&\n            performance.timing.connectEnd &&\n            performance.timing.navigationStart &&\n            (Math.abs(performance.now() - Date.now()) > 1000) &&\n            (performance.now() - (performance.timing.connectEnd - performance.timing.navigationStart)) > 0\n        );\n        /* eslint-enable compat/compat */\n    });\n}\n\nexport function getPageRenderTime() : ZalgoPromise<?number> {\n    return waitForDocumentReady().then(() => {\n\n        if (!enablePerformance()) {\n            return;\n        }\n\n        let timing = window.performance.timing;\n\n        if (timing.connectEnd && timing.domInteractive) {\n            return timing.domInteractive - timing.connectEnd;\n        }\n    });\n}\n\nexport function htmlEncode(html : string = '') : string {\n    return html.toString()\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#39;')\n        .replace(/\\//g, '&#x2F;');\n}\n\nexport function isBrowser() : boolean {\n    return (typeof window !== 'undefined');\n}\n\nexport function querySelectorAll(selector : string, doc : HTMLElement = window.document) : Array<HTMLElement> {\n    return Array.prototype.slice.call(doc.querySelectorAll(selector));\n}\n\nexport function onClick(element : HTMLElement, handler : (Event) => void) {\n    element.addEventListener('touchstart', noop);\n    element.addEventListener('click', handler);\n    element.addEventListener('keypress', (event : Event) => {\n        // $FlowFixMe\n        if (event.keyCode === KEY_CODES.ENTER) {\n            return handler(event);\n        }\n    });\n}\n\nexport function getScript({ host = window.location.host, path } : { host? : string, path : string }) : ?HTMLScriptElement {\n    return inlineMemoize(getScript, () : ?HTMLScriptElement => {\n\n        let url = `${ host }${ path }`;\n        let scripts = Array.prototype.slice.call(document.getElementsByTagName('script'));\n\n        for (let script of scripts) {\n            if (!script.src) {\n                continue;\n            }\n\n            let src = script.src.replace(/^https?:\\/\\//, '').split('?')[0];\n\n            if (src === url) {\n                return script;\n            }\n        }\n    }, [ path ]);\n}\n\nexport function isLocalStorageEnabled() : boolean {\n    return inlineMemoize(isLocalStorageEnabled, () => {\n        try {\n            if (typeof window === 'undefined') {\n                return false;\n            }\n\n            if (window.localStorage) {\n                let value = Math.random().toString();\n                window.localStorage.setItem('__test__localStorage__', value);\n                let result = window.localStorage.getItem('__test__localStorage__');\n                window.localStorage.removeItem('__test__localStorage__');\n                if (value === result) {\n                    return true;\n                }\n            }\n        } catch (err) {\n            // pass\n        }\n        return false;\n    });\n}\n\nexport function getBrowserLocales() : Array<{ country? : string, lang : string }> {\n    let nav = window.navigator;\n\n    let locales = nav.languages\n        ? Array.prototype.slice.apply(nav.languages)\n        : [];\n\n    if (nav.language) {\n        locales.push(nav.language);\n    }\n\n    if (nav.userLanguage) {\n        locales.push(nav.userLanguage);\n    }\n\n    return locales.map(locale => {\n\n        if (locale && locale.match(/^[a-z]{2}[-_][A-Z]{2}$/)) {\n            let [ lang, country ] = locale.split(/[-_]/);\n            return { country, lang };\n        }\n\n        if (locale && locale.match(/^[a-z]{2}$/)) {\n            return { lang: locale };\n        }\n\n        return null;\n\n    }).filter(Boolean);\n}\n\n\nexport function appendChild(container : HTMLElement, child : HTMLElement | Text) {\n    container.appendChild(child);\n}\n\nexport function isElement(element : mixed) : boolean {\n\n    if (element instanceof window.Element) {\n        return true;\n    }\n\n    if (element !== null && typeof element === 'object' && element.nodeType === 1 && typeof element.style === 'object' && typeof element.ownerDocument === 'object') {\n        return true;\n    }\n\n    return false;\n}\n\nexport function getElementSafe(id : ElementRefType, doc : Document | HTMLElement = document) : ?HTMLElement {\n\n    if (isElement(id)) {\n        // $FlowFixMe\n        return id;\n    }\n\n    if (typeof id === 'string') {\n        return doc.querySelector(id);\n    }\n}\n\nexport function getElement(id : ElementRefType, doc : Document | HTMLElement = document) : HTMLElement {\n\n    let element = getElementSafe(id, doc);\n\n    if (element) {\n        return element;\n    }\n\n    throw new Error(`Can not find element: ${ stringify(id) }`);\n}\n\nexport function elementReady(id : ElementRefType) : ZalgoPromise<window.HTMLElement> {\n    return new ZalgoPromise((resolve, reject) => {\n\n        let name = stringify(id);\n        let el = getElementSafe(id);\n\n        if (el) {\n            return resolve(el);\n        }\n\n        if (isDocumentReady()) {\n            return reject(new Error(`Document is ready and element ${ name } does not exist`));\n        }\n\n        let interval = setInterval(() => {\n\n            el = getElementSafe(id);\n\n            if (el) {\n                clearInterval(interval);\n                return resolve(el);\n            }\n\n            if (isDocumentReady()) {\n                clearInterval(interval);\n                return reject(new Error(`Document is ready and element ${ name } does not exist`));\n            }\n        }, 10);\n    });\n}\n\nexport function PopupOpenError(message : string) {\n    this.message = message;\n}\n\nPopupOpenError.prototype = Object.create(Error.prototype);\n\ntype PopupOptions = {|\n    name? : string,\n    width? : number,\n    height? : number,\n    top? : number,\n    left? : number,\n    status? : 0 | 1,\n    resizable? : 0 | 1,\n    toolbar? : 0 | 1,\n    menubar? : 0 | 1,\n    scrollbars? : 0 | 1\n|};\n\nexport function popup(url : string, options? : PopupOptions) : CrossDomainWindowType {\n\n    // $FlowFixMe\n    options = options || {};\n\n    let { width, height } = options;\n\n    let top = 0;\n    let left = 0;\n\n    if (width) {\n        if (window.outerWidth) {\n            left = Math.round((window.outerWidth - width) / 2) + window.screenX;\n        } else if (window.screen.width) {\n            left = Math.round((window.screen.width - width) / 2);\n        }\n    }\n\n    if (height) {\n        if (window.outerHeight) {\n            top = Math.round((window.outerHeight - height) / 2) + window.screenY;\n        } else if (window.screen.height) {\n            top = Math.round((window.screen.height - height) / 2);\n        }\n    }\n\n    if (width && height) {\n        options = {\n            top,\n            left,\n            width,\n            height,\n            status:     1,\n            toolbar:    0,\n            menubar:    0,\n            resizable:  1,\n            scrollbars: 1,\n            ...options\n        };\n    }\n\n    let name = options.name || '';\n    delete options.name;\n\n    // eslint-disable-next-line array-callback-return\n    let params = Object.keys(options).map(key => {\n        // $FlowFixMe\n        if (options[key] !== null && options[key] !== undefined) {\n            return `${ key }=${ stringify(options[key]) }`;\n        }\n    }).filter(Boolean).join(',');\n\n    let win;\n\n    try {\n        win = window.open(url, name, params, true);\n    } catch (err) {\n        throw new PopupOpenError(`Can not open popup window - ${ err.stack || err.message }`);\n    }\n\n    if (isWindowClosed(win)) {\n        let err = new PopupOpenError(`Can not open popup window - blocked`);\n        throw err;\n    }\n\n    window.addEventListener('unload', () => win.close());\n\n    return win;\n}\n\n\nexport function writeToWindow(win : SameDomainWindowType, html : string) {\n    try {\n        win.document.open();\n        win.document.write(html);\n        win.document.close();\n    } catch (err) {\n        try {\n            win.location = `javascript: document.open(); document.write(${ JSON.stringify(html) }); document.close();`;\n        } catch (err2) {\n            // pass\n        }\n    }\n}\n\nexport function writeElementToWindow(win : SameDomainWindowType, el : HTMLElement) {\n\n    let tag = el.tagName.toLowerCase();\n\n    if (tag !== 'html') {\n        throw new Error(`Expected element to be html, got ${ tag }`);\n    }\n\n    let documentElement = win.document.documentElement;\n\n    for (const child of arrayFrom(documentElement.children)) {\n        documentElement.removeChild(child);\n    }\n\n    for (const child of arrayFrom(el.children)) {\n        documentElement.appendChild(child);\n    }\n}\n\nexport function setStyle(el : HTMLElement, styleText : string, doc : Document = window.document) {\n    // $FlowFixMe\n    if (el.styleSheet) {\n        // $FlowFixMe\n        el.styleSheet.cssText = styleText;\n    } else {\n        el.appendChild(doc.createTextNode(styleText));\n    }\n}\n\nexport type ElementOptionsType = {\n    style? : { [ string ] : string },\n    id? : string,\n    class? : ?Array<string>,\n    attributes? : { [ string ] : string },\n    styleSheet? : ?string,\n    html? : ?string\n};\n\nlet awaitFrameLoadPromises : WeakMap<HTMLIFrameElement, ZalgoPromise<HTMLIFrameElement>>;\n\nexport function awaitFrameLoad(frame : HTMLIFrameElement) : ZalgoPromise<HTMLIFrameElement> {\n    awaitFrameLoadPromises = awaitFrameLoadPromises || new WeakMap();\n\n    if (awaitFrameLoadPromises.has(frame)) {\n        let promise = awaitFrameLoadPromises.get(frame);\n        if (promise) {\n            return promise;\n        }\n    }\n\n    let promise = new ZalgoPromise((resolve, reject) => {\n        frame.addEventListener('load', () => {\n            linkFrameWindow(frame);\n            resolve(frame);\n        });\n\n        frame.addEventListener('error', (err : Event) => {\n            if (frame.contentWindow) {\n                resolve(frame);\n            } else {\n                reject(err);\n            }\n        });\n    });\n\n    awaitFrameLoadPromises.set(frame, promise);\n\n    return promise;\n}\n\nexport function awaitFrameWindow(frame : HTMLIFrameElement) : ZalgoPromise<CrossDomainWindowType> {\n    return awaitFrameLoad(frame).then(loadedFrame => {\n\n        if (!loadedFrame.contentWindow) {\n            throw new Error(`Could not find window in iframe`);\n        }\n\n        return loadedFrame.contentWindow;\n    });\n}\n\nexport function createElement(tag : string = 'div', options : ElementOptionsType = {}, container : ?HTMLElement) : HTMLElement {\n\n    tag = tag.toLowerCase();\n    let element = document.createElement(tag);\n\n    if (options.style) {\n        extend(element.style, options.style);\n    }\n\n    if (options.class) {\n        element.className = options.class.join(' ');\n    }\n\n    if (options.id) {\n        element.setAttribute('id', options.id);\n    }\n\n    if (options.attributes) {\n        for (let key of Object.keys(options.attributes)) {\n            element.setAttribute(key, options.attributes[key]);\n        }\n    }\n\n    if (options.styleSheet) {\n        setStyle(element, options.styleSheet);\n    }\n\n    if (container) {\n        appendChild(container, element);\n    }\n\n    if (options.html) {\n        if (tag === 'iframe') {\n            // $FlowFixMe\n            if (!container || !element.contentWindow) {\n                throw new Error(`Iframe html can not be written unless container provided and iframe in DOM`);\n            }\n\n            // $FlowFixMe\n            writeToWindow(element.contentWindow, options.html);\n\n        } else {\n            element.innerHTML = options.html;\n        }\n    }\n\n    return element;\n}\n\n\nexport type IframeElementOptionsType = {\n    style? : { [ string ] : string },\n    class? : ?Array<string>,\n    attributes? : { [ string ] : string },\n    styleSheet? : ?string,\n    html? : ?string,\n    url? : ?string\n};\n\nexport function iframe(options : IframeElementOptionsType = {}, container : ?HTMLElement) : HTMLIFrameElement {\n\n    let attributes = options.attributes || {};\n    let style = options.style || {};\n\n    let frame = createElement('iframe', {\n        attributes: {\n            allowTransparency: 'true',\n            ...attributes\n        },\n        style: {\n            backgroundColor: 'transparent',\n            border:          'none',\n            ...style\n        },\n        html:  options.html,\n        class: options.class\n    });\n\n    const isIE = window.navigator.userAgent.match(/MSIE|Edge/i);\n    \n    if (!frame.hasAttribute('id')) {\n        frame.setAttribute('id', uniqueID());\n    }\n\n    // $FlowFixMe\n    awaitFrameLoad(frame);\n\n    if (container) {\n        let el = getElement(container);\n        el.appendChild(frame);\n    }\n\n    if (options.url || isIE) {\n        frame.setAttribute('src', options.url || 'about:blank');\n    }\n\n    // $FlowFixMe\n    return frame;\n}\n\nexport function addEventListener(obj : HTMLElement, event : string, handler : (event : Event) => void) : CancelableType {\n    obj.addEventListener(event, handler);\n    return {\n        cancel() {\n            obj.removeEventListener(event, handler);\n        }\n    };\n}\n\nexport function bindEvents(element : HTMLElement, eventNames : Array<string>, handler : (event : Event) => void) : CancelableType {\n\n    handler = once(handler);\n\n    for (let eventName of eventNames) {\n        element.addEventListener(eventName, handler);\n    }\n\n    return {\n        cancel: once(() => {\n            for (let eventName of eventNames) {\n                element.removeEventListener(eventName, handler);\n            }\n        })\n    };\n}\n\nconst VENDOR_PREFIXES = [ 'webkit', 'moz', 'ms', 'o' ];\n\nexport function setVendorCSS(element : HTMLElement, name : string, value : string) {\n\n    // $FlowFixMe\n    element.style[name] = value;\n\n    let capitalizedName = capitalizeFirstLetter(name);\n\n    for (let prefix of VENDOR_PREFIXES) {\n        // $FlowFixMe\n        element.style[`${ prefix }${ capitalizedName }`] = value;\n    }\n}\n\nconst ANIMATION_START_EVENTS = [ 'animationstart', 'webkitAnimationStart', 'oAnimationStart', 'MSAnimationStart' ];\nconst ANIMATION_END_EVENTS   = [ 'animationend', 'webkitAnimationEnd', 'oAnimationEnd', 'MSAnimationEnd' ];\n\nexport function animate(element : ElementRefType, name : string, clean : (Function) => void, timeout : number = 1000) : ZalgoPromise<void> {\n    return new ZalgoPromise((resolve, reject) => {\n\n        let el = getElement(element);\n\n        if (!el) {\n            return resolve();\n        }\n\n        let hasStarted = false;\n\n        let startTimeout;\n        let endTimeout;\n        let startEvent;\n        let endEvent;\n\n        function cleanUp() {\n            clearTimeout(startTimeout);\n            clearTimeout(endTimeout);\n            startEvent.cancel();\n            endEvent.cancel();\n        }\n\n        startEvent = bindEvents(el, ANIMATION_START_EVENTS, event => {\n\n            // $FlowFixMe\n            if (event.target !== el || event.animationName !== name) {\n                return;\n            }\n\n            clearTimeout(startTimeout);\n\n            event.stopPropagation();\n\n            startEvent.cancel();\n            hasStarted = true;\n\n            endTimeout = setTimeout(() => {\n                cleanUp();\n                resolve();\n            }, timeout);\n        });\n\n        endEvent = bindEvents(el, ANIMATION_END_EVENTS, event => {\n\n            // $FlowFixMe\n            if (event.target !== el || event.animationName !== name) {\n                return;\n            }\n\n            cleanUp();\n\n            // $FlowFixMe\n            if (typeof event.animationName === 'string' && event.animationName !== name) {\n                return reject(`Expected animation name to be ${ name }, found ${ event.animationName }`);\n            }\n\n            return resolve();\n        });\n\n        setVendorCSS(el, 'animationName', name);\n\n        startTimeout = setTimeout(() => {\n            if (!hasStarted) {\n                cleanUp();\n                return resolve();\n            }\n        }, 200);\n\n        if (clean) {\n            clean(cleanUp);\n        }\n    });\n}\n\nconst STYLE = {\n\n    DISPLAY: {\n        NONE:  'none',\n        BLOCK: 'block'\n    },\n\n    VISIBILITY: {\n        VISIBLE: 'visible',\n        HIDDEN:  'hidden'\n    },\n\n    IMPORTANT: 'important'\n};\n\nexport function makeElementVisible(element : HTMLElement) {\n    element.style.setProperty('visibility', '');\n}\n\nexport function makeElementInvisible(element : HTMLElement) {\n    element.style.setProperty('visibility', STYLE.VISIBILITY.HIDDEN, STYLE.IMPORTANT);\n}\n\n\nexport function showElement(element : HTMLElement) {\n    element.style.setProperty('display', '');\n}\n\nexport function hideElement(element : HTMLElement) {\n    element.style.setProperty('display', STYLE.DISPLAY.NONE, STYLE.IMPORTANT);\n}\n\nexport function destroyElement(element : HTMLElement) {\n    if (element && element.parentNode) {\n        element.parentNode.removeChild(element);\n    }\n}\n\nexport function showAndAnimate(element : HTMLElement, name : string, clean : (Function) => void) : ZalgoPromise<void> {\n    let animation = animate(element, name, clean);\n    showElement(element);\n    return animation;\n}\n\nexport function animateAndHide(element : HTMLElement, name : string, clean : (Function) => void) : ZalgoPromise<void> {\n    return animate(element, name, clean).then(() => {\n        hideElement(element);\n    });\n}\n\nexport function addClass(element : HTMLElement, name : string) {\n    element.classList.add(name);\n}\n\nexport function removeClass(element : HTMLElement, name : string) {\n    element.classList.remove(name);\n}\n\nexport function isElementClosed(el : HTMLElement) : boolean {\n    if (!el || !el.parentNode) {\n        return true;\n    }\n    return false;\n}\n\nexport function watchElementForClose(element : HTMLElement, handler : () => mixed) : CancelableType {\n    handler = once(handler);\n\n    let interval;\n\n    if (isElementClosed(element)) {\n        handler();\n    } else {\n        interval = safeInterval(() => {\n            if (isElementClosed(element)) {\n                interval.cancel();\n                handler();\n            }\n        }, 50);\n    }\n\n    return {\n        cancel() {\n            if (interval) {\n                interval.cancel();\n            }\n        }\n    };\n}\n\nexport function fixScripts(el : HTMLElement, doc : Document = window.document) {\n    for (let script of querySelectorAll('script', el)) {\n        let parentNode = script.parentNode;\n\n        if (!parentNode) {\n            continue;\n        }\n\n        let newScript = doc.createElement('script');\n        newScript.text = script.textContent;\n        parentNode.replaceChild(newScript, script);\n    }\n}\n\ntype OnResizeOptions = {|\n    width? : boolean,\n    height? : boolean,\n    interval? : number,\n    win? : SameDomainWindowType\n|};\n\nexport function onResize(el : HTMLElement, handler : ({ width : number, height : number }) => void, { width = true, height = true, interval = 100, win = window } : OnResizeOptions = {}) : {} {\n    let currentWidth = el.offsetWidth;\n    let currentHeight = el.offsetHeight;\n\n    handler({ width: currentWidth, height: currentHeight });\n\n    let check = () => {\n        let newWidth = el.offsetWidth;\n        let newHeight = el.offsetHeight;\n\n        if ((width && newWidth !== currentWidth) || (height && newHeight !== currentHeight)) {\n            handler({ width: newWidth, height: newHeight });\n        }\n\n        currentWidth = newWidth;\n        currentHeight = newHeight;\n    };\n\n    let observer;\n    let timeout;\n\n    if (typeof win.ResizeObserver !== 'undefined') {\n        observer = new win.ResizeObserver(check);\n        observer.observe(el);\n\n    } else if (typeof win.MutationObserver !== 'undefined') {\n        observer = new win.MutationObserver(check);\n        observer.observe(el, {\n            attributes:    true,\n            childList:     true,\n            subtree:       true,\n            characterData: false\n        });\n        win.addEventListener('resize', check);\n    } else {\n        let loop = () => {\n            check();\n            timeout = setTimeout(loop, interval);\n        };\n        loop();\n    }\n\n    return {\n        cancel: () => {\n            observer.disconnect();\n            window.removeEventListener('resize', check);\n            clearTimeout(timeout);\n        }\n    };\n}\n\nexport function getResourceLoadTime(url : string) : ?number {\n\n    if (!enablePerformance()) {\n        return;\n    }\n\n    if (!window.performance || typeof window.performance.getEntries !== 'function') {\n        return;\n    }\n\n    const entries = window.performance.getEntries();\n\n    for (let i = 0; i < entries.length; i++) {\n        const entry = entries[i];\n\n        if (entry && entry.name && entry.name.indexOf(url) === 0 && typeof entry.duration === 'number') {\n            return Math.floor(entry.duration);\n        }\n    }\n}\n","/* @flow */\n\nimport { uniqueID, getGlobal, inlineMemoize } from './util';\nimport { isLocalStorageEnabled } from './dom';\n\ntype Getter<T> = <T>(handler : (Object) => T) => T;\n\nexport type Storage = {\n    getState : Getter<*>,\n    getID : () => string,\n    getSessionState : Getter<*>,\n    getSessionID : () => string\n};\n\nconst DEFAULT_SESSION_STORAGE = 20 * 60 * 1000;\n\nexport function getStorage({ name, lifetime = DEFAULT_SESSION_STORAGE } : { name : string, lifetime? : number }) : Storage {\n    return inlineMemoize(getStorage, () => {\n        const STORAGE_KEY = `__${ name }_storage__`;\n\n        let accessedStorage;\n\n        function getState<T>(handler : (storage : Object) => T) : T {\n\n            let localStorageEnabled = isLocalStorageEnabled();\n            let storage;\n\n            if (accessedStorage) {\n                storage = accessedStorage;\n            }\n\n            if (!storage && localStorageEnabled) {\n                let rawStorage = window.localStorage.getItem(STORAGE_KEY);\n\n                if (rawStorage) {\n                    storage = JSON.parse(rawStorage);\n                }\n            }\n\n            if (!storage) {\n                storage = getGlobal()[STORAGE_KEY];\n            }\n\n            if (!storage) {\n                storage = {\n                    id: uniqueID()\n                };\n            }\n\n            if (!storage.id) {\n                storage.id = uniqueID();\n            }\n\n            accessedStorage = storage;\n\n            let result = handler(storage);\n\n            if (localStorageEnabled) {\n                window.localStorage.setItem(STORAGE_KEY, JSON.stringify(storage));\n            } else {\n                getGlobal()[STORAGE_KEY] = storage;\n            }\n\n            accessedStorage = null;\n\n            return result;\n        }\n\n        function getID() : string {\n            return getState(storage => storage.id);\n        }\n\n        function getSession<T>(handler : (state : Object) => T) : T {\n            return getState(storage => {\n\n                let session = storage.__session__;\n                let now = Date.now();\n\n                if (session && ((now - session.created) > lifetime)) {\n                    session = null;\n                }\n\n                if (!session) {\n                    session = {\n                        guid:    uniqueID(),\n                        created: now\n                    };\n                }\n\n                storage.__session__ = session;\n\n                return handler(session);\n            });\n        }\n\n        function getSessionState<T>(handler : (state : Object) => T) : T {\n            return getSession(session => {\n                session.state = session.state || {};\n                return handler(session.state);\n            });\n        }\n\n        function getSessionID() : string {\n            return getSession(session => session.guid);\n        }\n\n        return {\n            getState,\n            getID,\n            getSessionState,\n            getSessionID\n        };\n    }, [ { name, lifetime } ]);\n}\n","/* @flow */\n\nimport { noop } from './util';\nimport { getStorage } from './storage';\n\nfunction getBelterExperimentStorage() : Object {\n    return getStorage({ name: 'belter_experiment' });\n}\n\nfunction isEventUnique(name : string) : boolean {\n    return getBelterExperimentStorage().getSessionState(state => {\n        state.loggedBeacons = state.loggedBeacons || [];\n\n        if (state.loggedBeacons.indexOf(name) === -1) {\n            state.loggedBeacons.push(name);\n            return true;\n        }\n\n        return false;\n    });\n}\n\nexport type Experiment = {\n    isEnabled : () => boolean,\n    isDisabled : () => boolean,\n    getTreatment : () => string,\n    log : (string, payload? : { [string] : ?string }) => Experiment,\n    logStart : (payload? : { [string] : ?string }) => Experiment,\n    logComplete : (payload? : { [string] : ?string }) => Experiment\n};\n\nfunction getThrottlePercentile(name : string) : number {\n    return getBelterExperimentStorage().getState(state => {\n        state.throttlePercentiles = state.throttlePercentiles || {};\n        state.throttlePercentiles[name] = state.throttlePercentiles[name] || Math.floor(Math.random() * 100);\n        return state.throttlePercentiles[name];\n    });\n}\n\nconst THROTTLE_GROUP = {\n    TEST:     'test',\n    CONTROL:  'control',\n    THROTTLE: 'throttle'\n};\n\ntype ExperimentOptions = {\n    name : string,\n    sample? : number,\n    logTreatment? : ({ name : string, treatment : string }) => void,\n    logCheckpoint? : ({ name : string, treatment : string, checkpoint : string, payload? : { [string] : ?string } }) => void\n};\n\nexport function experiment({ name, sample = 50, logTreatment = noop, logCheckpoint = noop } : ExperimentOptions) : Experiment {\n\n    let throttle = getThrottlePercentile(name);\n\n    let group;\n\n    if (throttle < sample) {\n        group = THROTTLE_GROUP.TEST;\n    } else if ((sample >= 50) || ((sample <= throttle) && (throttle < (sample * 2)))) {\n        group = THROTTLE_GROUP.CONTROL;\n    } else {\n        group = THROTTLE_GROUP.THROTTLE;\n    }\n\n    let treatment = `${ name }_${ group }`;\n\n    let started = false;\n    let forced = false;\n\n    try {\n        if (window.localStorage && window.localStorage.getItem(name)) {\n            forced = true;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    return {\n\n        isEnabled() : boolean {\n            return (group === THROTTLE_GROUP.TEST) || forced;\n        },\n\n        isDisabled() : boolean {\n            return (group !== THROTTLE_GROUP.TEST) && !forced;\n        },\n\n        getTreatment() : string {\n            return treatment;\n        },\n\n        log(checkpoint : string, payload? : { [string] : ?string } = {}) : Experiment {\n            if (!started) {\n                return this;\n            }\n\n            if (isEventUnique(`${ name }_${ treatment }`)) {\n                logTreatment({ name, treatment });\n            }\n\n            if (isEventUnique(`${ name }_${ treatment }_${ checkpoint }`)) {\n                logCheckpoint({ name, treatment, checkpoint, payload });\n            }\n\n            return this;\n        },\n\n        logStart(payload? : { [string] : ?string } = {}) : Experiment {\n            started = true;\n            return this.log(`start`, payload);\n        },\n\n        logComplete(payload? : { [string] : ?string } = {}) : Experiment {\n            return this.log(`complete`, payload);\n        }\n    };\n}\n","/* @flow */\n\nimport { getGlobal } from './util';\n\nexport function getGlobalNameSpace<T : Object>({ name, version = 'latest' } : { name : string, version? : string }) : { get : (string, defValue? : T) => T } {\n\n    let global = getGlobal();\n    let globalKey = `__${ name }__${ version }_global__`;\n\n    let namespace = global[globalKey] = global[globalKey] || {};\n\n    return {\n        get: (key : string, defValue? : T) : T => {\n            // $FlowFixMe\n            defValue = defValue || {};\n            let item = namespace[key] = namespace[key] || defValue;\n            return item;\n        }\n    };\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { type SameDomainWindowType } from 'cross-domain-utils/src';\n\ntype RequestOptionsType = {\n    url : string,\n    method? : string,\n    headers? : { [key : string] : string },\n    json? : $ReadOnlyArray<mixed> | Object,\n    data? : { [key : string] : string },\n    body? : string,\n    win? : SameDomainWindowType,\n    timeout? : number\n};\n\ntype ResponseType = {\n    status : number,\n    headers : { [string] : string },\n    body : Object\n};\n\nconst HEADERS = {\n    CONTENT_TYPE: 'content-type',\n    ACCEPT:       'accept'\n};\n\nlet headerBuilders = [];\n\nfunction parseHeaders(rawHeaders : string = '') : { [string] : string } {\n    let result = {};\n    for (let line of rawHeaders.trim().split('\\n')) {\n        let [ key, ...values ] = line.split(':');\n        result[key.toLowerCase()] = values.join(':').trim();\n    }\n    return result;\n}\n\nexport function request({ url, method = 'get', headers = {}, json, data, body, win = window, timeout = 0 } : RequestOptionsType) : ZalgoPromise<ResponseType> {\n    return new ZalgoPromise((resolve, reject) => {\n\n        if ((json && data) || (json && body) || (data && json)) {\n            throw new Error(`Only options.json or options.data or options.body should be passed`);\n        }\n\n        let normalizedHeaders = {};\n\n        for (let key of Object.keys(headers)) {\n            normalizedHeaders[key.toLowerCase()] = headers[key];\n        }\n\n        if (json) {\n            normalizedHeaders[HEADERS.CONTENT_TYPE] = normalizedHeaders[HEADERS.CONTENT_TYPE] || 'application/json';\n        } else if (data || body) {\n            normalizedHeaders[HEADERS.CONTENT_TYPE] = normalizedHeaders[HEADERS.CONTENT_TYPE] || 'application/x-www-form-urlencoded; charset=utf-8';\n        }\n\n        normalizedHeaders[HEADERS.ACCEPT] = normalizedHeaders[HEADERS.ACCEPT] || 'application/json';\n\n        for (let headerBuilder of headerBuilders) {\n            let builtHeaders = headerBuilder();\n\n            for (let key of Object.keys(builtHeaders)) {\n                normalizedHeaders[key.toLowerCase()] = builtHeaders[key];\n            }\n        }\n\n        let xhr = new win.XMLHttpRequest();\n\n        xhr.addEventListener('load', function xhrLoad() : void {\n\n            let responseHeaders = parseHeaders(this.getAllResponseHeaders());\n\n            if (!this.status) {\n                return reject(new Error(`Request to ${ method.toLowerCase() } ${ url } failed: no response status code.`));\n            }\n            \n            let contentType = responseHeaders['content-type'];\n            let isJSON = contentType && (contentType.indexOf('application/json') === 0 || contentType.indexOf('text/json') === 0);\n            let responseBody = this.responseText;\n\n            try {\n                responseBody = JSON.parse(responseBody);\n            } catch (err) {\n                if (isJSON) {\n                    return reject(new Error(`Invalid json: ${ this.responseText }.`));\n                }\n            }\n\n            let res = {\n                status:  this.status,\n                headers: responseHeaders,\n                body:    responseBody\n            };\n\n            return resolve(res);\n\n        }, false);\n\n        xhr.addEventListener('error', (evt) => {\n            reject(new Error(`Request to ${ method.toLowerCase() } ${ url } failed: ${ evt.toString() }.`));\n        }, false);\n\n        xhr.open(method, url, true);\n\n        for (let key in normalizedHeaders) {\n            if (normalizedHeaders.hasOwnProperty(key)) {\n                xhr.setRequestHeader(key, normalizedHeaders[key]);\n            }\n        }\n\n        if (json) {\n            body = JSON.stringify(json);\n        } else if (data) {\n            body = Object.keys(data).map(key => {\n                return `${ encodeURIComponent(key) }=${ data ? encodeURIComponent(data[key]) : '' }`;\n            }).join('&');\n        }\n\n        xhr.timeout = timeout;\n        xhr.ontimeout = function xhrTimeout() {\n            reject(new Error(`Request to ${ method.toLowerCase() } ${ url } has timed out`));\n        };\n\n        xhr.send(body);\n    });\n}\n\nexport function addHeaderBuilder(method : () => { [string] : string }) {\n    headerBuilders.push(method);\n}\n","/* @flow */\n\n// export something to force webpack to see this as an ES module\nexport const TYPES = true;\n\ndeclare var __TEST__ : boolean;\n\nexport type JSONPrimitive = string | boolean | number;\nexport type JSONObject = { [string] : JSONPrimitive | JSONObject } | Array<JSONPrimitive | JSONObject>;\nexport type JSONType = JSONObject | JSONPrimitive;\n\nexport type CancelableType = {\n    cancel : () => void\n};\n","/* @flow */\n\nimport { memoize, promisify } from './util';\n\nexport function memoized(target : Object, name : string, descriptor : Object) {\n    descriptor.value = memoize(descriptor.value, { name, thisNamespace: true });\n}\n\nexport function promise(target : Object, name : string, descriptor : Object) {\n    descriptor.value = promisify(descriptor.value, { name });\n}\n","/* @flow */\n\nexport function isPerc(str : string) : boolean {\n    return typeof str === 'string' && (/^[0-9]+%$/).test(str);\n}\n\nexport function isPx(str : string) : boolean {\n    return typeof str === 'string' && (/^[0-9]+px$/).test(str);\n}\n\nexport function toNum(val : string | number) : number {\n\n    if (typeof val === 'number') {\n        return val;\n    }\n\n    let match = val.match(/^([0-9]+)(px|%)$/);\n\n    if (!match) {\n        throw new Error(`Could not match css value from ${ val }`);\n    }\n\n    return parseInt(match[1], 10);\n}\n\nexport function toPx(val : number | string) : string {\n    return `${ toNum(val) }px`;\n}\n\nexport function toCSS(val : number | string) : string {\n\n    if (typeof val === 'number') {\n        return toPx(val);\n    }\n\n    return isPerc(val) ? val : toPx(val);\n}\n\nexport function percOf(num : number, perc : string) : number {\n    return parseInt(num * toNum(perc)  / 100, 10);\n}\n\nexport function normalizeDimension(dim : string | number, max : number) : number {\n    if (typeof dim === 'number') {\n        return dim;\n    } else if (isPerc(dim)) {\n        return percOf(max, dim);\n    } else if (isPx(dim)) {\n        return toNum(dim);\n    } else {\n        throw new Error(`Can not normalize dimension: ${ dim }`);\n    }\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\n\nimport { noop, tryCatch, removeFromArray } from './util';\n\ntype Prom<X> = Promise<X> | ZalgoPromise<X>; // eslint-disable-line no-restricted-globals, promise/no-native\n\ntype Handler = <T, A : $ReadOnlyArray<mixed>>(name : string, fn? : (...args : A) => T) => (...args : A) => T; // eslint-disable-line no-undef\ntype Wrapper<T> = ({ expect : Handler, avoid : Handler, expectError : Handler, error : Handler }) => (Prom<T> | void);\n\nexport function wrapPromise<T>(method : Wrapper<T>, { timeout = 5000 } : { timeout? : number } = {}) : ZalgoPromise<void> {\n    let expected : Array<string> = [];\n    let promises : Array<ZalgoPromise<*>> = [];\n\n    let timer = setTimeout(() => {\n        if (expected) {\n            promises.push(ZalgoPromise.asyncReject(new Error(`Expected ${ expected[0] } to be called`)));\n        }\n    }, timeout);\n\n    let expect : Handler = (name, fn = noop) => {\n        expected.push(name);\n        \n        // $FlowFixMe\n        return function expectWrapper(...args) : * {\n            removeFromArray(expected, name);\n\n            // $FlowFixMe\n            let { result, error } = tryCatch(() => fn.call(this, ...args));\n\n            if (error) {\n                promises.push(ZalgoPromise.asyncReject(error));\n                throw error;\n            }\n\n            promises.push(ZalgoPromise.resolve(result));\n            return result;\n        };\n    };\n\n    let avoid : Handler = (name : string, fn = noop) => {\n\n        // $FlowFixMe\n        return function avoidWrapper(...args) : * {\n            promises.push(ZalgoPromise.asyncReject(new Error(`Expected ${ name } to not be called`)));\n            // $FlowFixMe\n            return fn.call(this, ...args);\n        };\n    };\n\n    let expectError : Handler = (name, fn = noop) => {\n        expected.push(name);\n\n        // $FlowFixMe\n        return function expectErrorWrapper(...args) : * {\n            removeFromArray(expected, name);\n\n            // $FlowFixMe\n            let { result, error } = tryCatch(() => fn.call(this, ...args));\n\n            if (error) {\n                throw error;\n            }\n\n            promises.push(ZalgoPromise.resolve(result).then(() => {\n                throw new Error(`Expected ${ name } to throw an error`);\n            }, noop));\n            return result;\n        };\n    };\n\n    promises.push(ZalgoPromise.try(() => method({ expect, avoid, expectError, error: avoid })));\n\n    let drain = () => {\n        return ZalgoPromise.try(() => {\n            if (promises.length) {\n                return promises.pop();\n            }\n        }).then(() => {\n            if (promises.length) {\n                return drain();\n            }\n            if (expected.length) {\n                return ZalgoPromise.delay(10).then(drain);\n            }\n        });\n    };\n\n    return drain().then(() => {\n        clearTimeout(timer);\n    });\n}\n","/* @flow */\n\nexport * from './device';\nexport * from './dom';\nexport * from './experiment';\nexport * from './global';\nexport * from './storage';\nexport * from './util';\nexport * from './http';\nexport * from './types';\nexport * from './decorators';\nexport * from './css';\nexport * from './test';\n","/* @flow */\n\nexport const BRIDGE_TIMEOUT = 5000;\nexport const CHILD_WINDOW_TIMEOUT = 5000;\n\nexport const ACK_TIMEOUT = 2000;\nexport const ACK_TIMEOUT_KNOWN = 10000;\nexport const RES_TIMEOUT = __TEST__ ? 2000 : -1;\nexport const RESPONSE_CYCLE_TIME = 500;\n","/* @flow */\n\nexport const MESSAGE_TYPE = {\n    REQUEST:  ('postrobot_message_request' : 'postrobot_message_request'),\n    RESPONSE: ('postrobot_message_response' : 'postrobot_message_response'),\n    ACK:      ('postrobot_message_ack' : 'postrobot_message_ack')\n};\n\nexport const MESSAGE_ACK = {\n    SUCCESS: ('success' : 'success'),\n    ERROR:   ('error' : 'error')\n};\n\nexport const MESSAGE_NAME = {\n    METHOD:      ('postrobot_method' : 'postrobot_method'),\n    HELLO:       ('postrobot_hello' : 'postrobot_hello'),\n    OPEN_TUNNEL: ('postrobot_open_tunnel' : 'postrobot_open_tunnel')\n};\n\nexport const SEND_STRATEGY = {\n    POST_MESSAGE: ('postrobot_post_message' : 'postrobot_post_message'),\n    BRIDGE:       ('postrobot_bridge' : 'postrobot_bridge'),\n    GLOBAL:       ('postrobot_global' : 'postrobot_global')\n};\n\nexport const BRIDGE_NAME_PREFIX = '__postrobot_bridge__';\nexport const POSTROBOT_PROXY =    '__postrobot_proxy__';\n\nexport const WILDCARD = '*';\n\nexport const SERIALIZATION_TYPE = {\n    CROSS_DOMAIN_ZALGO_PROMISE: ('cross_domain_zalgo_promise' : 'cross_domain_zalgo_promise'),\n    CROSS_DOMAIN_FUNCTION:      ('cross_domain_function' : 'cross_domain_function'),\n    CROSS_DOMAIN_WINDOW:        ('cross_domain_window' : 'cross_domain_window')\n};\n","/* @flow */\n\nexport * from './config';\nexport * from './constants';\n","/* @flow */\n\nimport { type CrossDomainWindowType, type SameDomainWindowType } from 'cross-domain-utils/src';\nimport { WeakMap } from 'cross-domain-safe-weakmap/src';\nimport { getOrSet } from 'belter/src';\n\nexport function getGlobal(win : SameDomainWindowType = window) : Object {\n    if (win !== window) {\n        return win[__POST_ROBOT__.__GLOBAL_KEY__];\n    }\n    const global : Object = win[__POST_ROBOT__.__GLOBAL_KEY__] = win[__POST_ROBOT__.__GLOBAL_KEY__] || {};\n    return global;\n}\n\nexport function deleteGlobal() {\n    delete window[__POST_ROBOT__.__GLOBAL_KEY__];\n}\n\ntype ObjectGetter = () => Object;\nconst getObj : ObjectGetter = () => ({});\n\ntype GetOrSet<T> = ((string, () => T) => T) & ((string, () => void) => void);\n\ntype GlobalStore<T> = {|\n    get : ((string, T) => T) & ((string, void) => T | void),\n    set : (string, T) => T,\n    has : (string) => boolean,\n    del : (string) => void,\n    getOrSet : GetOrSet<T>,\n    reset : () => void,\n    keys : () => $ReadOnlyArray<string>\n|};\n\nexport function globalStore<T : mixed>(key? : string = 'store', defStore? : ObjectGetter = getObj) : GlobalStore<T> {\n    return getOrSet(getGlobal(), key, () => {\n        let store = defStore();\n\n        return {\n            has: (storeKey) => {\n                return store.hasOwnProperty(storeKey);\n            },\n            get: (storeKey, defVal) => {\n                // $FlowFixMe\n                return store.hasOwnProperty(storeKey) ? store[storeKey] : defVal;\n            },\n            set: (storeKey, val) => {\n                store[storeKey] = val;\n                return val;\n            },\n            del: (storeKey) => {\n                delete store[storeKey];\n            },\n            getOrSet: (storeKey, getter) => {\n                // $FlowFixMe\n                return getOrSet(store, storeKey, getter);\n            },\n            reset: () => {\n                store = defStore();\n            },\n            keys: () => {\n                return Object.keys(store);\n            }\n        };\n    });\n}\n\nexport class WildCard {}\n\nexport function getWildcard() : WildCard {\n    const global = getGlobal();\n    global.WINDOW_WILDCARD = global.WINDOW_WILDCARD || new WildCard();\n    return global.WINDOW_WILDCARD;\n}\n\ntype WindowStore<T> = {|\n    get : ((CrossDomainWindowType | WildCard, T) => T) & ((CrossDomainWindowType | WildCard, void) => T | void),\n    set : (CrossDomainWindowType | WildCard, T) => T,\n    has : (CrossDomainWindowType | WildCard) => boolean,\n    del : (CrossDomainWindowType | WildCard) => void,\n    getOrSet : (CrossDomainWindowType | WildCard, () => T) => T\n|};\n\nexport function windowStore<T>(key? : string = 'store', defStore? : ObjectGetter = getObj) : WindowStore<T> {\n    return globalStore('windowStore').getOrSet(key, () => {\n        const winStore = new WeakMap();\n\n        const getStore = (win : CrossDomainWindowType | WildCard) : ObjectGetter => {\n            return winStore.getOrSet(win, defStore);\n        };\n    \n        return {\n            has: (win) => {\n                const store = getStore(win);\n                return store.hasOwnProperty(key);\n            },\n            get: (win, defVal) => {\n                const store = getStore(win);\n                // $FlowFixMe\n                return store.hasOwnProperty(key) ? store[key] : defVal;\n            },\n            set: (win, val) => {\n                const store = getStore(win);\n                store[key] = val;\n                return val;\n            },\n            del: (win) => {\n                const store = getStore(win);\n                delete store[key];\n            },\n            getOrSet: (win, getter) => {\n                const store = getStore(win);\n                return getOrSet(store, key, getter);\n            }\n        };\n    });\n}\n","/* @flow */\n\nimport { getAncestor, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { noop, uniqueID } from 'belter/src';\n\nimport { MESSAGE_NAME, WILDCARD } from '../conf';\nimport { windowStore, globalStore } from '../global';\nimport type { OnType, SendType, CancelableType } from '../types';\n\nfunction getInstanceID() : string {\n    return globalStore('instance').getOrSet('instanceID', uniqueID);\n}\n\nfunction getHelloPromise(win : CrossDomainWindowType) : ZalgoPromise<{ domain : string }> {\n    const helloPromises = windowStore('helloPromises');\n    return helloPromises.getOrSet(win, () => new ZalgoPromise());\n}\n\nfunction resolveHelloPromise(win : CrossDomainWindowType, { domain }) : ZalgoPromise<{ domain : string }> {\n    const helloPromises = windowStore('helloPromises');\n    const existingPromise = helloPromises.get(win);\n    if (existingPromise) {\n        existingPromise.resolve({ domain });\n    }\n    const newPromise = ZalgoPromise.resolve({ domain });\n    helloPromises.set(win, newPromise);\n    return newPromise;\n}\n\nfunction listenForHello({ on } : { on : OnType }) : CancelableType {\n    return on(MESSAGE_NAME.HELLO, { domain: WILDCARD }, ({ source, origin }) => {\n        resolveHelloPromise(source, { domain: origin });\n        return { instanceID: getInstanceID() };\n    });\n}\n\nexport function sayHello(win : CrossDomainWindowType, { send } : { send : SendType }) : ZalgoPromise<{ win : CrossDomainWindowType, domain : string, instanceID : string }> {\n    return send(win, MESSAGE_NAME.HELLO, { instanceID: getInstanceID() }, { domain: WILDCARD, timeout: -1 })\n        .then(({ origin, data: { instanceID } }) => {\n            resolveHelloPromise(win, { domain: origin });\n            return { win, domain: origin, instanceID };\n        });\n}\n\nexport function getWindowInstanceID(win : CrossDomainWindowType, { send } : { send : SendType }) : ZalgoPromise<string> {\n    return windowStore('windowInstanceIDPromises').getOrSet(win, () => {\n        return sayHello(win, { send }).then(({ instanceID }) => instanceID);\n    });\n}\n\nexport function initHello({ on, send } : { on : OnType, send : SendType }) : CancelableType {\n    return globalStore('builtinListeners').getOrSet('helloListener', () => {\n        const listener = listenForHello({ on });\n\n        const parent = getAncestor();\n        if (parent) {\n            sayHello(parent, { send }).catch(noop);\n        }\n\n        return listener;\n    });\n}\n\nexport function awaitWindowHello(win : CrossDomainWindowType, timeout : number = 5000, name : string = 'Window') : ZalgoPromise<{ domain : string }> {\n    let promise = getHelloPromise(win);\n\n    if (timeout !== -1) {\n        promise = promise.timeout(timeout, new Error(`${ name } did not load after ${ timeout }ms`));\n    }\n\n    return promise;\n}\n","/* @flow */\n\nimport { getUserAgent } from 'cross-domain-utils/src';\n\nexport function needsGlobalMessagingForBrowser() : boolean {\n\n    if (getUserAgent(window).match(/MSIE|rv:11|trident|edge\\/12|edge\\/13/i)) {\n        return true;\n    }\n\n    return false;\n}\n","/* @flow */\n\nimport { type CrossDomainWindowType } from 'cross-domain-utils/src';\n\nimport { windowStore } from '../global';\n\nexport function markWindowKnown(win : CrossDomainWindowType) {\n    const knownWindows = windowStore('knownWindows');\n    knownWindows.set(win, true);\n}\n\nexport function isWindowKnown(win : CrossDomainWindowType) : boolean {\n    const knownWindows = windowStore('knownWindows');\n    return knownWindows.get(win, false);\n}\n","/* @flow */\n\nexport * from './hello';\nexport * from './compat';\nexport * from './windows';\n","/* @flow */\n\nexport const TYPE = {\n    FUNCTION:  ('function' : 'function'),\n    ERROR:     ('error' : 'error'),\n    PROMISE:   ('promise' : 'promise'),\n    REGEX:     ('regex' : 'regex'),\n    DATE:      ('date' : 'date'),\n    ARRAY:     ('array' : 'array'),\n    OBJECT:    ('object' : 'object'),\n    STRING:    ('string' : 'string'),\n    NUMBER:    ('number' : 'number'),\n    BOOLEAN:   ('boolean' : 'boolean'),\n    NULL:      ('null' : 'null'),\n    UNDEFINED: ('undefined' : 'undefined')\n};\n","/* @flow */\n\nimport { TYPE } from './constants';\nimport type { CustomSerializedType } from './types';\n\nexport function isSerializedType(item : mixed) : boolean {\n    return (typeof item === 'object' && item !== null && typeof item.__type__ === 'string');\n}\n\nexport function determineType(val : mixed) : $Values<typeof TYPE> | void {\n    if (typeof val === 'undefined') {\n        return TYPE.UNDEFINED;\n    }\n\n    if (val === null) {\n        return TYPE.NULL;\n    }\n\n    if (Array.isArray(val)) {\n        return TYPE.ARRAY;\n    }\n\n    if (typeof val === 'function') {\n        return TYPE.FUNCTION;\n    }\n\n    if (typeof val === 'object') {\n\n        if (val instanceof Error) {\n            return TYPE.ERROR;\n        }\n\n        if (typeof val.then === 'function') {\n            return TYPE.PROMISE;\n        }\n\n        if (Object.prototype.toString.call(val) === '[object RegExp]') {\n            return TYPE.REGEX;\n        }\n\n        if (Object.prototype.toString.call(val) === '[object Date]') {\n            return TYPE.DATE;\n        }\n\n        return TYPE.OBJECT;\n    }\n\n    if (typeof val === 'string') {\n        return TYPE.STRING;\n    }\n\n    if (typeof val === 'number') {\n        return TYPE.NUMBER;\n    }\n\n    if (typeof val === 'boolean') {\n        return TYPE.BOOLEAN;\n    }\n}\n\nexport function serializeType<T : string, V : mixed>(type : T, val : V) : CustomSerializedType<T, V> {\n    return {\n        __type__: type,\n        __val__:  val\n    };\n}\n","/* @flow */\n\nexport type SerializedArray<T : mixed = mixed> = $ReadOnlyArray<T>;\n\nexport function serializeArray<T : mixed>(val : $ReadOnlyArray<T>) : SerializedArray<T> {\n    return val;\n}\n\nexport function deserializeArray<T : mixed>(val : SerializedArray<T>) : $ReadOnlyArray<T> {\n    return val;\n}\n","/* @flow */\n\nexport type SerializedBoolean = boolean;\n\nexport function serializeBoolean(val : boolean) : SerializedBoolean {\n    return val;\n}\n\nexport function deserializeBoolean(val : SerializedBoolean) : boolean {\n    return val;\n}\n","/* @flow */\n\nimport { serializeType } from '../common';\nimport { TYPE } from '../constants';\nimport type { NativeSerializedType } from '../types';\n\nexport type SerializedDate = string;\n\nexport function serializeDate(val : Date) : NativeSerializedType<typeof TYPE.DATE, SerializedDate> {\n    return serializeType(TYPE.DATE, val.toJSON());\n}\n\nexport function deserializeDate(val : string) : Date {\n    return new Date(val);\n}\n","/* @flow */\n\nimport { serializeType } from '../common';\nimport { TYPE } from '../constants';\nimport type { NativeSerializedType } from '../types';\n\nexport type SerializedError = {|\n    message : string,\n    stack : string,\n    code : string | number | void\n|};\n\n// $FlowFixMe\nexport function serializeError({ message, stack, code } : Error) : NativeSerializedType<typeof TYPE.ERROR, SerializedError> {\n    return serializeType(TYPE.ERROR, { message, stack, code });\n}\n\nexport function deserializeError({ message, stack, code } : SerializedError) : Error {\n    const error = new Error(message);\n    // $FlowFixMe\n    error.code = code;\n    error.stack = `${ stack }\\n\\n${ error.stack }`;\n    return error;\n}\n","/* @flow */\n\nexport type SerializedFunction = void;\n\nexport function serializeFunction() : SerializedFunction {\n    // pass\n}\n\nexport function deserializeFunction() {\n    throw new Error(`Function serialization is not implemented; nothing to deserialize`);\n}\n","/* @flow */\n\nexport type SerializedNumber = number;\n\nexport function serializeNumber(val : number) : SerializedNumber {\n    return val;\n}\n\nexport function deserializeNumber(val : SerializedNumber) : number {\n    return val;\n}\n","/* @flow */\n\nexport type SerializedObject = Object;\n\nexport function serializeObject(val : Object) : SerializedObject {\n    return val;\n}\n\nexport function deserializeObject(val : SerializedObject) : Object {\n    return val;\n}\n","/* @flow */\n\nexport type SerializedPromise = void;\n\nexport function serializePromise() : SerializedPromise {\n    // pass\n}\n\nexport function deserializePromise() {\n    throw new Error(`Promise serialization is not implemented; nothing to deserialize`);\n}\n","/* @flow */\n\nimport { serializeType } from '../common';\nimport { TYPE } from '../constants';\nimport type { NativeSerializedType } from '../types';\n\nexport type SerializedRegex = string;\n\nexport function serializeRegex(val : RegExp) : NativeSerializedType<typeof TYPE.REGEX, SerializedRegex> {\n    return serializeType(TYPE.REGEX, val.source);\n}\n\nexport function deserializeRegex(val : string) : RegExp {\n    // eslint-disable-next-line security/detect-non-literal-regexp\n    return new RegExp(val);\n}\n","/* @flow */\n\nexport type SerializedString = string;\n\nexport function serializeString(val : string) : SerializedString {\n    return val;\n}\n\nexport function deserializeString(val : SerializedString) : string {\n    return val;\n}\n","/* @flow */\n\nexport type SerializedNull = null;\n\nexport function serializeNull(val : null) : SerializedNull {\n    return val;\n}\n\nexport function deserializeNull(val : SerializedNull) : null {\n    return val;\n}\n","/* @flow */\n\nexport * from './array';\nexport * from './boolean';\nexport * from './date';\nexport * from './error';\nexport * from './function';\nexport * from './number';\nexport * from './object';\nexport * from './promise';\nexport * from './regex';\nexport * from './string';\nexport * from './null';\n","/* @flow */\n\nimport { TYPE } from './constants';\nimport type { Thenable, CustomSerializedType, NativeSerializedType } from './types';\nimport { determineType, isSerializedType } from './common';\nimport {\n    serializeFunction,\n    serializeError, type SerializedError,\n    serializePromise,\n    serializeRegex, type SerializedRegex,\n    serializeDate, type SerializedDate,\n    serializeArray,\n    serializeObject,\n    serializeString,\n    serializeNumber,\n    serializeBoolean,\n    serializeNull\n} from './serializers';\n\ntype NativeSerializer<V : mixed, S : mixed, T : $Values<typeof TYPE>> = (value : V, key : string) => NativeSerializedType<T, S>;\ntype CustomSerializer<V : mixed, S : mixed, T : string> = (value : V, key : string) => CustomSerializedType<T, S>;\ntype PrimitiveSerializer<V : mixed, S : mixed> = (value : V, key : string) => S;\ntype CustomOrPrimitiveSerializer<V : mixed, T : string> = CustomSerializer<V, *, T> | PrimitiveSerializer<V, *>;\ntype NativeOrCustomOrPrimitiveSerializer<V : mixed, S : mixed, T : string> = NativeSerializer<V, S, T> | CustomOrPrimitiveSerializer<V, T>;\n\ntype Serializers = {|\n    function? : CustomOrPrimitiveSerializer<Function, typeof TYPE.FUNCTION>,\n    error? : NativeOrCustomOrPrimitiveSerializer<Error, SerializedError, typeof TYPE.ERROR>,\n    promise? : CustomOrPrimitiveSerializer<Thenable, typeof TYPE.PROMISE>,\n    regex? : NativeOrCustomOrPrimitiveSerializer<RegExp, SerializedRegex, typeof TYPE.REGEX>,\n    date? : NativeOrCustomOrPrimitiveSerializer<Date, SerializedDate, typeof TYPE.DATE>,\n    array? : CustomOrPrimitiveSerializer<$ReadOnlyArray<mixed>, typeof TYPE.ARRAY>,\n    object? : CustomOrPrimitiveSerializer<Object, typeof TYPE.OBJECT>,\n    string? : CustomOrPrimitiveSerializer<string, typeof TYPE.STRING>,\n    number? : CustomOrPrimitiveSerializer<number, typeof TYPE.NUMBER>,\n    boolean? : CustomOrPrimitiveSerializer<boolean, typeof TYPE.BOOLEAN>,\n    null? : CustomOrPrimitiveSerializer<null, typeof TYPE.NULL>\n|};\n\nconst SERIALIZER : Serializers = {\n    [ TYPE.FUNCTION ]:  serializeFunction,\n    [ TYPE.ERROR ]:     serializeError,\n    [ TYPE.PROMISE ]:   serializePromise,\n    [ TYPE.REGEX ]:     serializeRegex,\n    [ TYPE.DATE ]:      serializeDate,\n    [ TYPE.ARRAY ]:     serializeArray,\n    [ TYPE.OBJECT ]:    serializeObject,\n    [ TYPE.STRING ]:    serializeString,\n    [ TYPE.NUMBER ]:    serializeNumber,\n    [ TYPE.BOOLEAN ]:   serializeBoolean,\n    [ TYPE.NULL ]:      serializeNull\n};\n\n// $FlowFixMe\nconst defaultSerializers : Serializers = {};\n\nexport function serialize<T : mixed>(obj : T, serializers : Serializers = defaultSerializers) : string {\n\n    function replacer(key) : ?mixed {\n        const val = this[key];\n\n        if (isSerializedType(this)) {\n            return val;\n        }\n        \n        const type = determineType(val);\n\n        if (!type) {\n            return val;\n        }\n\n        // $FlowFixMe\n        const serializer = serializers[type] || SERIALIZER[type];\n\n        if (!serializer) {\n            return val;\n        }\n\n        return serializer(val, key);\n    }\n\n    const result = JSON.stringify(obj, replacer);\n\n    if (typeof result === 'undefined') {\n        return TYPE.UNDEFINED;\n    }\n\n    return result;\n}\n","/* @flow */\n\nimport type { Thenable } from './types';\nimport { TYPE } from './constants';\nimport { determineType, isSerializedType } from './common';\nimport {\n    deserializeFunction,\n    deserializeError, type SerializedError,\n    deserializePromise,\n    deserializeRegex, type SerializedRegex,\n    deserializeDate, type SerializedDate,\n    deserializeArray,\n    deserializeObject,\n    deserializeString,\n    deserializeNumber,\n    deserializeBoolean,\n    deserializeNull\n} from './serializers';\n\ntype Deserializer<V : mixed, S : mixed> = (serializedValue : S, key : string) => V;\ntype PrimitiveDeserializer<V, S = V> = (serializedValue : S, key : string) => V;\n\ntype Deserializers = {\n    function? : Deserializer<Function, *>,\n    error? : Deserializer<Error, SerializedError>,\n    promise? : Deserializer<Thenable, *>,\n    regex? : Deserializer<RegExp, SerializedRegex>,\n    date? : Deserializer<Date, SerializedDate>,\n    array? : PrimitiveDeserializer<$ReadOnlyArray<mixed>>,\n    object? : PrimitiveDeserializer<Object>,\n    string? : PrimitiveDeserializer<string>,\n    number? : PrimitiveDeserializer<number>,\n    boolean? : PrimitiveDeserializer<boolean>,\n    null? : PrimitiveDeserializer<null>,\n    [string] : Deserializer<mixed, *>\n};\n\n// $FlowFixMe\nconst DESERIALIZER : Deserializers = {\n    [ TYPE.FUNCTION ]:  deserializeFunction,\n    [ TYPE.ERROR ]:     deserializeError,\n    [ TYPE.PROMISE ]:   deserializePromise,\n    [ TYPE.REGEX ]:     deserializeRegex,\n    [ TYPE.DATE ]:      deserializeDate,\n    [ TYPE.ARRAY ]:     deserializeArray,\n    [ TYPE.OBJECT ]:    deserializeObject,\n    [ TYPE.STRING ]:    deserializeString,\n    [ TYPE.NUMBER ]:    deserializeNumber,\n    [ TYPE.BOOLEAN ]:   deserializeBoolean,\n    [ TYPE.NULL ]:      deserializeNull\n};\n\n// $FlowFixMe\nconst defaultDeserializers : Deserializers = {};\n\nexport function deserialize<T : mixed | null | void>(str : string, deserializers : Deserializers = defaultDeserializers) : T {\n    if (str === TYPE.UNDEFINED) {\n        // $FlowFixMe\n        return;\n    }\n\n    function replacer(key, val) : ?mixed {\n        if (isSerializedType(this)) {\n            return val;\n        }\n\n        let type;\n        let value;\n\n        if (isSerializedType(val)) {\n            type = val.__type__;\n            value = val.__val__;\n        } else {\n            type = determineType(val);\n            value = val;\n        }\n\n        if (!type) {\n            return value;\n        }\n\n        // $FlowFixMe\n        const deserializer = deserializers[type] || DESERIALIZER[type];\n\n        if (!deserializer) {\n            return value;\n        }\n\n        return deserializer(value, key);\n    }\n\n    return JSON.parse(str, replacer);\n}\n","/* @flow */\n\nimport { TYPE } from './constants';\n\n// export something to force webpack to see this as an ES module\nexport const TYPES = true;\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type Thenable = {\n    then : (onSuccess? : (val? : mixed) => mixed, onError? : (err? : mixed) => mixed) => Thenable,\n    catch : (onError? : (err? : mixed) => mixed) => Thenable\n};\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type NativeSerializedType<T : $Values<typeof TYPE>, V : mixed> = {\n    __type__ : T,\n    __val__ : V\n};\n\nexport type CustomSerializedType<T : string, V : mixed> = {|\n    __type__ : T,\n    __val__ : V\n|};\n","/* @flow */\n\nexport * from './serialize';\nexport * from './deserialize';\nexport * from './serializers';\nexport * from './constants';\nexport * from './common';\nexport * from './types';\n","/* @flow */\n\nimport { type ZalgoPromise } from 'zalgo-promise/src';\nimport { getParent, isWindowClosed, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop, uniqueID } from 'belter/src';\n\nimport { MESSAGE_NAME, WILDCARD } from '../conf';\nimport { getGlobal, globalStore } from '../global';\nimport type { SendType, ResponseMessageEvent } from '../types';\n\nfunction cleanTunnelWindows() {\n    const tunnelWindows = globalStore('tunnelWindows');\n\n    for (const key of tunnelWindows.keys()) {\n        const tunnelWindow = tunnelWindows[key];\n\n        try {\n            noop(tunnelWindow.source);\n        } catch (err) {\n            tunnelWindows.del(key);\n            continue;\n        }\n\n        if (isWindowClosed(tunnelWindow.source)) {\n            tunnelWindows.del(key);\n        }\n    }\n}\n\ntype TunnelWindowDataType = {|\n    name : string,\n    source : CrossDomainWindowType,\n    canary : () => void,\n    sendMessage : (message : string) => void\n|};\n\nfunction addTunnelWindow({ name, source, canary, sendMessage } : TunnelWindowDataType) : string {\n    cleanTunnelWindows();\n    const id = uniqueID();\n    const tunnelWindows = globalStore('tunnelWindows');\n    tunnelWindows.set(id, { name, source, canary, sendMessage });\n    return id;\n}\n\nexport function setupOpenTunnelToParent({ send } : { send : SendType }) {\n    getGlobal(window).openTunnelToParent = function openTunnelToParent({ name, source, canary, sendMessage } : TunnelWindowDataType) : ZalgoPromise<ResponseMessageEvent> {\n\n        const tunnelWindows = globalStore('tunnelWindows');\n        const parentWindow = getParent(window);\n    \n        if (!parentWindow) {\n            throw new Error(`No parent window found to open tunnel to`);\n        }\n    \n        const id = addTunnelWindow({ name, source, canary, sendMessage });\n    \n        return send(parentWindow, MESSAGE_NAME.OPEN_TUNNEL, {\n    \n            name,\n    \n            sendMessage() {\n    \n                const tunnelWindow = tunnelWindows.get(id);\n    \n                try {\n                    // IE gets antsy if you try to even reference a closed window\n                    noop(tunnelWindow && tunnelWindow.source);\n                } catch (err) {\n                    tunnelWindows.del(id);\n                    return;\n                }\n    \n                if (!tunnelWindow || !tunnelWindow.source || isWindowClosed(tunnelWindow.source)) {\n                    return;\n                }\n    \n                try {\n                    tunnelWindow.canary();\n                } catch (err) {\n                    return;\n                }\n    \n                tunnelWindow.sendMessage.apply(this, arguments);\n            }\n    \n        }, { domain: WILDCARD });\n    };\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { getDomain, isSameDomain, isOpener, isSameTopWindow, matchDomain, getUserAgent, getDomainFromUrl, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop } from 'belter/src';\n\nimport { BRIDGE_NAME_PREFIX } from '../conf';\nimport { windowStore } from '../global';\n\nexport function needsBridgeForBrowser() : boolean {\n\n    if (getUserAgent(window).match(/MSIE|trident|edge\\/12|edge\\/13/i)) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function needsBridgeForWin(win : CrossDomainWindowType) : boolean {\n\n    if (!isSameTopWindow(window, win)) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function needsBridgeForDomain(domain : ?string, win : ?CrossDomainWindowType) : boolean {\n\n    if (domain) {\n        if (getDomain() !== getDomainFromUrl(domain)) {\n            return true;\n        }\n    } else if (win) {\n        if (!isSameDomain(win))  {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function needsBridge({ win, domain } : { win? : CrossDomainWindowType, domain? : string }) : boolean {\n\n    if (!needsBridgeForBrowser()) {\n        return false;\n    }\n\n    if (domain && !needsBridgeForDomain(domain, win)) {\n        return false;\n    }\n\n    if (win && !needsBridgeForWin(win)) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function getBridgeName(domain : string) : string {\n\n    domain = domain || getDomainFromUrl(domain);\n\n    const sanitizedDomain = domain.replace(/[^a-zA-Z0-9]+/g, '_');\n\n    const id = `${ BRIDGE_NAME_PREFIX }_${ sanitizedDomain }`;\n\n    return id;\n}\n\nexport function isBridge() : boolean {\n    return Boolean(window.name && window.name === getBridgeName(getDomain()));\n}\n\nexport const documentBodyReady = new ZalgoPromise(resolve => {\n\n    if (window.document && window.document.body) {\n        return resolve(window.document.body);\n    }\n\n    const interval = setInterval(() => {\n        if (window.document && window.document.body) {\n            clearInterval(interval);\n            return resolve(window.document.body);\n        }\n    }, 10);\n});\n\nexport function registerRemoteWindow(win : CrossDomainWindowType) {\n    const remoteWindowPromises = windowStore('remoteWindowPromises');\n    remoteWindowPromises.getOrSet(win, () => new ZalgoPromise());\n}\n\nexport function findRemoteWindow(win : CrossDomainWindowType) : ZalgoPromise<(remoteWin : CrossDomainWindowType, message : string, remoteDomain : string) => void> {\n    const remoteWindowPromises = windowStore('remoteWindowPromises');\n    const remoteWinPromise = remoteWindowPromises.get(win);\n\n    if (!remoteWinPromise) {\n        throw new Error(`Remote window promise not found`);\n    }\n\n    return remoteWinPromise;\n}\n\ntype SendMessageType = {|\n    (string) : void,\n    fireAndForget : (string) => void\n|};\n\nexport function registerRemoteSendMessage(win : CrossDomainWindowType, domain : string, sendMessage : SendMessageType) {\n    const sendMessageWrapper = (remoteWin : CrossDomainWindowType, remoteDomain : string, message : string) => {\n        if (remoteWin !== win) {\n            throw new Error(`Remote window does not match window`);\n        }\n\n        if (!matchDomain(remoteDomain, domain)) {\n            throw new Error(`Remote domain ${ remoteDomain } does not match domain ${ domain }`);\n        }\n\n        sendMessage.fireAndForget(message);\n    };\n\n    findRemoteWindow(win).resolve(sendMessageWrapper);\n}\n\nexport function rejectRemoteSendMessage(win : CrossDomainWindowType, err : Error) {\n    findRemoteWindow(win).reject(err).catch(noop);\n}\n\nexport function sendBridgeMessage(win : CrossDomainWindowType, domain : string, message : string) : ZalgoPromise<void> {\n\n    const messagingChild  = isOpener(window, win);\n    const messagingParent = isOpener(win, window);\n\n    if (!messagingChild && !messagingParent) {\n        throw new Error(`Can only send messages to and from parent and popup windows`);\n    }\n\n    return findRemoteWindow(win).then(sendMessage => {\n        return sendMessage(win, domain, message);\n    });\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { isSameDomain, getOpener, getDomain, getFrameByName, assertSameDomain, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop } from 'belter/src';\n\nimport { getGlobal, windowStore } from '../global';\nimport type { OnType, SendType, ReceiveMessageType } from '../types';\n\nimport { needsBridge, registerRemoteWindow, rejectRemoteSendMessage, registerRemoteSendMessage, getBridgeName } from './common';\n\nfunction awaitRemoteBridgeForWindow (win : CrossDomainWindowType) : ZalgoPromise<?CrossDomainWindowType> {\n    return windowStore('remoteBridgeAwaiters').getOrSet(win, () => {\n        return ZalgoPromise.try(() => {\n            const frame = getFrameByName(win, getBridgeName(getDomain()));\n\n            if (!frame) {\n                return;\n            }\n\n            if (isSameDomain(frame) && getGlobal(assertSameDomain(frame))) {\n                return frame;\n            }\n\n            return new ZalgoPromise(resolve => {\n\n                let interval;\n                let timeout; // eslint-disable-line prefer-const\n\n                interval = setInterval(() => { // eslint-disable-line prefer-const\n                    if (frame && isSameDomain(frame) && getGlobal(assertSameDomain(frame))) {\n                        clearInterval(interval);\n                        clearTimeout(timeout);\n                        return resolve(frame);\n                    }\n                }, 100);\n\n                timeout = setTimeout(() => {\n                    clearInterval(interval);\n                    return resolve();\n                }, 2000);\n            });\n        });\n    });\n}\n\nexport function openTunnelToOpener({ on, send, receiveMessage } : { on : OnType, send : SendType, receiveMessage : ReceiveMessageType }) : ZalgoPromise<void> {\n    return ZalgoPromise.try(() => {\n        const opener = getOpener(window);\n        \n        if (!opener || !needsBridge({ win: opener })) {\n            return;\n        }\n\n        registerRemoteWindow(opener);\n\n        return awaitRemoteBridgeForWindow(opener).then(bridge => {\n\n            if (!bridge) {\n                return rejectRemoteSendMessage(opener, new Error(`Can not register with opener: no bridge found in opener`));\n            }\n\n            if (!window.name) {\n                return rejectRemoteSendMessage(opener, new Error(`Can not register with opener: window does not have a name`));\n            }\n\n            return getGlobal(assertSameDomain(bridge)).openTunnelToParent({\n\n                name: window.name,\n\n                source: window,\n\n                canary() {\n                    // pass\n                },\n\n                sendMessage(message) {\n\n                    try {\n                        noop(window);\n                    } catch (err) {\n                        return;\n                    }\n\n                    if (!window || window.closed) {\n                        return;\n                    }\n\n                    try {\n                        receiveMessage({\n                            data:   message,\n                            origin: this.origin,\n                            source: this.source\n                        }, { on, send });\n                    } catch (err) {\n                        ZalgoPromise.reject(err);\n                    }\n                }\n\n            }).then(({ source, origin, data }) => {\n\n                if (source !== opener) {\n                    throw new Error(`Source does not match opener`);\n                }\n\n                registerRemoteSendMessage(source, origin, data.sendMessage);\n\n            }).catch(err => {\n\n                rejectRemoteSendMessage(opener, err);\n                throw err;\n            });\n        });\n    });\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { getDomain, getFrameByName, isWindowClosed, getDomainFromUrl, normalizeMockUrl, type CrossDomainWindowType } from 'cross-domain-utils/src';\n\nimport { BRIDGE_TIMEOUT, MESSAGE_NAME } from '../conf';\nimport { awaitWindowHello } from '../lib';\nimport { windowStore, globalStore } from '../global';\nimport type { OnType, SendType, ReceiveMessageType } from '../types';\n\nimport { getBridgeName, documentBodyReady, registerRemoteSendMessage, registerRemoteWindow } from './common';\n\nexport function listenForOpenTunnel({ on, send, receiveMessage } : { on : OnType, send : SendType, receiveMessage : ReceiveMessageType }) {\n    const popupWindowsByName = globalStore('popupWindowsByName');\n\n    on(MESSAGE_NAME.OPEN_TUNNEL, ({ source, origin, data }) => {\n        const bridgePromise = globalStore('bridges').get(origin);\n\n        if (!bridgePromise) {\n            throw new Error(`Can not find bridge promise for domain ${ origin }`);\n        }\n\n        return bridgePromise.then(bridge => {\n            if (source !== bridge) {\n                throw new Error(`Message source does not matched registered bridge for domain ${ origin }`);\n            }\n\n            if (!data.name) {\n                throw new Error(`Register window expected to be passed window name`);\n            }\n\n            if (!data.sendMessage) {\n                throw new Error(`Register window expected to be passed sendMessage method`);\n            }\n\n            if (!popupWindowsByName.has(data.name)) {\n                throw new Error(`Window with name ${ data.name } does not exist, or was not opened by this window`);\n            }\n\n            if (!popupWindowsByName.get(data.name).domain) {\n                throw new Error(`We do not have a registered domain for window ${ data.name }`);\n            }\n\n            if (popupWindowsByName.get(data.name).domain !== origin) {\n                throw new Error(`Message origin ${ origin } does not matched registered window origin ${ popupWindowsByName.get(data.name).domain }`);\n            }\n\n            registerRemoteSendMessage(popupWindowsByName.get(data.name).win, origin, data.sendMessage);\n\n            return {\n                sendMessage(message) {\n\n                    if (!window || window.closed) {\n                        return;\n                    }\n\n                    const winDetails = popupWindowsByName.get(data.name);\n\n                    if (!winDetails) {\n                        return;\n                    }\n\n                    try {\n                        receiveMessage({\n                            data:   message,\n                            origin: winDetails.domain,\n                            source: winDetails.win\n                        }, { on, send });\n                    } catch (err) {\n                        ZalgoPromise.reject(err);\n                    }\n                }\n            };\n        });\n    });\n}\n\nfunction openBridgeFrame(name : string, url : string) : HTMLIFrameElement {\n\n    const iframe = document.createElement(`iframe`);\n\n    iframe.setAttribute(`name`, name);\n    iframe.setAttribute(`id`,   name);\n\n    iframe.setAttribute(`style`, `display: none; margin: 0; padding: 0; border: 0px none; overflow: hidden;`);\n    iframe.setAttribute(`frameborder`, `0`);\n    iframe.setAttribute(`border`, `0`);\n    iframe.setAttribute(`scrolling`, `no`);\n    iframe.setAttribute(`allowTransparency`, `true`);\n\n    iframe.setAttribute(`tabindex`, `-1`);\n    iframe.setAttribute(`hidden`, `true`);\n    iframe.setAttribute(`title`, ``);\n    iframe.setAttribute(`role`, `presentation`);\n\n    iframe.src = url;\n\n    return iframe;\n}\n\nexport function hasBridge(url : string, domain : string) : boolean {\n    const bridges = globalStore('bridges');\n    return bridges.has(domain || getDomainFromUrl(url));\n}\n\nexport function openBridge(url : string, domain : string) : ZalgoPromise<CrossDomainWindowType> {\n    const bridges = globalStore('bridges');\n    const bridgeFrames = globalStore('bridgeFrames');\n    \n    domain = domain || getDomainFromUrl(url);\n    \n    return bridges.getOrSet(domain, () => ZalgoPromise.try(() => {\n\n        if (getDomain() === domain) {\n            throw new Error(`Can not open bridge on the same domain as current domain: ${ domain }`);\n        }\n\n        const name  = getBridgeName(domain);\n        const frame = getFrameByName(window, name);\n\n        if (frame) {\n            throw new Error(`Frame with name ${ name } already exists on page`);\n        }\n\n        const iframe = openBridgeFrame(name, url);\n        bridgeFrames.set(domain, iframe);\n\n        return documentBodyReady.then(body => {\n\n            body.appendChild(iframe);\n            const bridge = iframe.contentWindow;\n\n            return new ZalgoPromise((resolve, reject) => {\n\n                iframe.addEventListener('load', resolve);\n                iframe.addEventListener('error', reject);\n\n            }).then(() => {\n\n                return awaitWindowHello(bridge, BRIDGE_TIMEOUT, `Bridge ${ url }`);\n\n            }).then(() => {\n\n                return bridge;\n            });\n        });\n    }));\n}\n\ntype WinDetails = {|\n    win : CrossDomainWindowType,\n    domain? : ?string,\n    name? : ?string\n|};\n\nexport function linkWindow({ win, name, domain } : WinDetails) : WinDetails {\n    const popupWindowsByName = globalStore('popupWindowsByName');\n    const popupWindowsByWin = windowStore('popupWindowsByWin');\n\n    for (const winName of popupWindowsByName.keys()) {\n        // $FlowFixMe\n        const details = popupWindowsByName.get(winName);\n        if (!details || isWindowClosed(details.win)) {\n            popupWindowsByName.del(winName);\n        }\n    }\n\n    const details = popupWindowsByWin.getOrSet(win, () : WinDetails => {\n        if (!name) {\n            return { win };\n        }\n        \n        return popupWindowsByName.getOrSet(name, () : WinDetails => {\n            return { win, name };\n        });\n    });\n\n    if (details.win && details.win !== win) {\n        throw new Error(`Different window already linked for window: ${ name || 'undefined' }`);\n    }\n\n    if (name) {\n        details.name = name;\n        popupWindowsByName.set(name, details);\n    }\n\n    if (domain) {\n        details.domain = domain;\n        registerRemoteWindow(win);\n    }\n\n    popupWindowsByWin.set(win, details);\n    \n    return details;\n}\n\nexport function linkUrl(win : CrossDomainWindowType, url : string) {\n    linkWindow({ win, domain: getDomainFromUrl(url) });\n}\n\nexport function listenForWindowOpen() {\n    const windowOpen = window.open;\n\n    window.open = function windowOpenWrapper(url : string, name : string, options : string, last : mixed) : mixed {\n        const win = windowOpen.call(this, normalizeMockUrl(url), name, options, last);\n    \n        if (!win) {\n            return win;\n        }\n    \n        linkWindow({ win, name, domain: url ? getDomainFromUrl(url) : null });\n    \n        return win;\n    };\n}\n\nexport function destroyBridges() {\n    const bridges = globalStore('bridges');\n    const bridgeFrames = globalStore('bridgeFrames');\n\n    for (const domain of bridgeFrames.keys()) {\n        const frame = bridgeFrames.get(domain);\n        if (frame && frame.parentNode) {\n            frame.parentNode.removeChild(frame);\n        }\n    }\n    bridgeFrames.reset();\n    bridges.reset();\n}\n","/* @flow */\n\nimport type { OnType, SendType, ReceiveMessageType } from '../types';\n\nimport { listenForWindowOpen, listenForOpenTunnel } from './parent';\nimport { setupOpenTunnelToParent } from './bridge';\nimport { openTunnelToOpener } from './child';\n\nexport function setupBridge({ on, send, receiveMessage } : { on : OnType, send : SendType, receiveMessage : ReceiveMessageType }) {\n    listenForWindowOpen();\n    listenForOpenTunnel({ on, send, receiveMessage });\n    setupOpenTunnelToParent({ on, send });\n    openTunnelToOpener({ on, send, receiveMessage });\n}\n","/* @flow */\n\n\nexport * from './bridge';\nexport * from './child';\nexport * from './common';\nexport * from './parent';\nexport * from './setup';\n","/* @flow */\n\nimport { isSameDomain, isWindowClosed, type CrossDomainWindowType, closeWindow,\n    type DomainMatcher, getOpener, WINDOW_TYPE, isWindow, assertSameDomain } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { uniqueID, memoizePromise } from 'belter/src';\nimport { serializeType, type CustomSerializedType } from 'universal-serialize/src';\n\nimport { SERIALIZATION_TYPE } from '../conf';\nimport { windowStore, globalStore } from '../global';\nimport { getWindowInstanceID } from '../lib';\nimport { linkWindow } from '../bridge';\nimport type { SendType } from '../types';\n\nfunction cleanupProxyWindows() {\n    const idToProxyWindow = globalStore('idToProxyWindow');\n    for (const id of idToProxyWindow.keys()) {\n        // $FlowFixMe\n        if (idToProxyWindow.get(id).shouldClean()) {\n            idToProxyWindow.del(id);\n        }\n    }\n}\n\ntype SerializedWindowType = {|\n    id : string,\n    getType : () => ZalgoPromise<$Values<typeof WINDOW_TYPE>>,\n    close : () => ZalgoPromise<void>,\n    focus : () => ZalgoPromise<void>,\n    isClosed : () => ZalgoPromise<boolean>,\n    setLocation : (string) => ZalgoPromise<void>,\n    getName : () => ZalgoPromise<?string>,\n    setName : (string) => ZalgoPromise<void>,\n    getInstanceID : () => ZalgoPromise<string>\n|};\n\nfunction getSerializedWindow(winPromise : ZalgoPromise<CrossDomainWindowType>, { send, id = uniqueID() } : { send : SendType, id? : string }) : SerializedWindowType {\n    let windowName;\n    \n    return {\n        id,\n        getType: () => winPromise.then(win => {\n            return getOpener(win) ? WINDOW_TYPE.POPUP : WINDOW_TYPE.IFRAME;\n        }),\n        getInstanceID: memoizePromise(() => winPromise.then(win => getWindowInstanceID(win, { send }))),\n        close:         () => winPromise.then(closeWindow),\n        getName:       () => winPromise.then(win => {\n            if (isWindowClosed(win)) {\n                return;\n            }\n\n            return windowName;\n        }),\n        focus:   () => winPromise.then(win => {\n            win.focus();\n        }),\n        isClosed: () => winPromise.then(win => {\n            return isWindowClosed(win);\n        }),\n        setLocation: (href) => winPromise.then(win => {\n            if (isSameDomain(win)) {\n                try {\n                    if (win.location && typeof win.location.replace === 'function') {\n                        // $FlowFixMe\n                        win.location.replace(href);\n                        return;\n                    }\n                } catch (err) {\n                    // pass\n                }\n            }\n\n            win.location = href;\n        }),\n        setName: (name) => winPromise.then(win => {\n            if (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n                linkWindow({ win, name });\n            }\n\n            const sameDomainWin = assertSameDomain(win);\n\n            sameDomainWin.name = name;\n\n            if (sameDomainWin.frameElement) {\n                sameDomainWin.frameElement.setAttribute('name', name);\n            }\n\n            windowName = name;\n        })\n    };\n}\n\nexport class ProxyWindow {\n\n    id : string\n    isProxyWindow : true = true\n    serializedWindow : SerializedWindowType\n    actualWindow : ?CrossDomainWindowType\n    actualWindowPromise : ZalgoPromise<CrossDomainWindowType>\n    send : SendType\n    name : string\n\n    constructor({ send, win, serializedWindow } : { win? : CrossDomainWindowType, serializedWindow? : SerializedWindowType, send : SendType }) {\n        this.actualWindowPromise = new ZalgoPromise();\n        this.serializedWindow = serializedWindow || getSerializedWindow(this.actualWindowPromise, { send });\n        globalStore('idToProxyWindow').set(this.getID(), this);\n        if (win) {\n            this.setWindow(win, { send });\n        }\n    }\n\n    getID() : string {\n        return this.serializedWindow.id;\n    }\n\n    getType() : ZalgoPromise<$Values<typeof WINDOW_TYPE>> {\n        return this.serializedWindow.getType();\n    }\n\n    isPopup() : ZalgoPromise<boolean> {\n        return this.getType().then(type => {\n            return type === WINDOW_TYPE.POPUP;\n        });\n    }\n\n    setLocation(href : string) : ZalgoPromise<ProxyWindow> {\n        return this.serializedWindow.setLocation(href).then(() => this);\n    }\n\n    getName() : ZalgoPromise<?string> {\n        return this.serializedWindow.getName();\n    }\n\n    setName(name : string) : ZalgoPromise<ProxyWindow> {\n        return this.serializedWindow.setName(name).then(() => this);\n    }\n\n    close() : ZalgoPromise<ProxyWindow> {\n        return this.serializedWindow.close().then(() => this);\n    }\n\n    focus() : ZalgoPromise<ProxyWindow> {\n        const isPopupPromise = this.isPopup();\n        const getNamePromise = this.getName();\n\n        const reopenPromise = ZalgoPromise.hash({ isPopup: isPopupPromise, name: getNamePromise }).then(({ isPopup, name }) => {\n            if (isPopup && name) {\n                window.open('', name);\n            }\n        });\n        const focusPromise = this.serializedWindow.focus();\n\n        return ZalgoPromise.all([\n            reopenPromise,\n            focusPromise\n        ]).then(() => this);\n    }\n\n    isClosed() : ZalgoPromise<boolean> {\n        return this.serializedWindow.isClosed();\n    }\n\n    getWindow() : ?CrossDomainWindowType {\n        return this.actualWindow;\n    }\n\n    setWindow(win : CrossDomainWindowType, { send } : { send : SendType }) {\n        this.actualWindow = win;\n        this.actualWindowPromise.resolve(this.actualWindow);\n        this.serializedWindow = getSerializedWindow(this.actualWindowPromise, { send, id: this.getID() });\n        windowStore('winToProxyWindow').set(win, this);\n    }\n\n    awaitWindow() : ZalgoPromise<CrossDomainWindowType> {\n        return this.actualWindowPromise;\n    }\n\n    matchWindow(win : CrossDomainWindowType, { send } : { send : SendType }) : ZalgoPromise<boolean> {\n        return ZalgoPromise.try(() => {\n            if (this.actualWindow) {\n                return win === this.actualWindow;\n            }\n            \n            return ZalgoPromise.hash({\n                proxyInstanceID:       this.getInstanceID(),\n                knownWindowInstanceID: getWindowInstanceID(win, { send })\n            }).then(({ proxyInstanceID, knownWindowInstanceID }) => {\n                const match = proxyInstanceID === knownWindowInstanceID;\n\n                if (match) {\n                    this.setWindow(win, { send });\n                }\n\n                return match;\n            });\n        });\n    }\n\n    unwrap() : CrossDomainWindowType | ProxyWindow {\n        return this.actualWindow || this;\n    }\n\n    getInstanceID() : ZalgoPromise<string> {\n        return this.serializedWindow.getInstanceID();\n    }\n\n    shouldClean() : boolean {\n        return Boolean(this.actualWindow && isWindowClosed(this.actualWindow));\n    }\n\n    serialize() : SerializedWindowType {\n        return this.serializedWindow;\n    }\n\n    static unwrap(win : CrossDomainWindowType | ProxyWindow) : CrossDomainWindowType | ProxyWindow {\n        return ProxyWindow.isProxyWindow(win)\n            // $FlowFixMe\n            ? win.unwrap()\n            : win;\n    }\n\n    static serialize(win : CrossDomainWindowType | ProxyWindow, { send } : { send : SendType }) : SerializedWindowType {\n        cleanupProxyWindows();\n        return ProxyWindow.toProxyWindow(win, { send }).serialize();\n    }\n\n    static deserialize(serializedWindow : SerializedWindowType, { send } : { send : SendType }) : ProxyWindow {\n        cleanupProxyWindows();\n        return globalStore('idToProxyWindow').get(serializedWindow.id) || new ProxyWindow({ serializedWindow, send });\n    }\n\n    static isProxyWindow(obj : CrossDomainWindowType | ProxyWindow) : boolean {\n        // $FlowFixMe\n        return Boolean(obj && !isWindow(obj) && obj.isProxyWindow);\n    }\n\n    static toProxyWindow(win : CrossDomainWindowType | ProxyWindow, { send } : { send : SendType }) : ProxyWindow {\n        cleanupProxyWindows();\n\n        if (ProxyWindow.isProxyWindow(win)) {\n            // $FlowFixMe\n            return win;\n        }\n\n        // $FlowFixMe\n        const actualWindow : CrossDomainWindowType = win;\n        \n        return windowStore('winToProxyWindow').get(actualWindow) || new ProxyWindow({ win: actualWindow, send });\n    }\n}\n\nexport type SerializedWindow = CustomSerializedType<typeof SERIALIZATION_TYPE.CROSS_DOMAIN_WINDOW, SerializedWindowType>;\n\nexport function serializeWindow(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, win : CrossDomainWindowType, { send } : { send : SendType }) : SerializedWindow {\n    return serializeType(SERIALIZATION_TYPE.CROSS_DOMAIN_WINDOW, ProxyWindow.serialize(win, { send }));\n}\n\nexport function deserializeWindow(source : CrossDomainWindowType | ProxyWindow, origin : string, win : SerializedWindowType, { send } : { send : SendType }) : ProxyWindow {\n    return ProxyWindow.deserialize(win, { send });\n}\n","/* @flow */\n\nimport { matchDomain, getDomain, type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { uniqueID, isRegex } from 'belter/src';\nimport { serializeType, type CustomSerializedType } from 'universal-serialize/src';\n\nimport { MESSAGE_NAME, WILDCARD, SERIALIZATION_TYPE } from '../conf';\nimport { windowStore, globalStore } from '../global';\nimport type { OnType, SendType, CancelableType } from '../types';\n\nimport { ProxyWindow } from './window';\n\ntype StoredMethod = {|\n    name : string,\n    domain : DomainMatcher,\n    val : Function,\n    source : CrossDomainWindowType | ProxyWindow\n|};\n\nfunction addMethod(id : string, val : Function, name : string, source : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher) {\n    const methodStore = windowStore('methodStore');\n    const proxyWindowMethods = globalStore('proxyWindowMethods');\n    \n    if (ProxyWindow.isProxyWindow(source)) {\n        proxyWindowMethods.set(id, { val, name, domain, source });\n    } else {\n        proxyWindowMethods.del(id);\n        // $FlowFixMe\n        const methods = methodStore.getOrSet(source, () => ({}));\n        methods[id] = { domain, name, val, source };\n    }\n}\n\nfunction lookupMethod(source : CrossDomainWindowType, id : string) : ?StoredMethod {\n    const methodStore = windowStore('methodStore');\n    const proxyWindowMethods = globalStore('proxyWindowMethods');\n    const methods = methodStore.getOrSet(source, () => ({}));\n    return methods[id] || proxyWindowMethods.get(id);\n}\n\nfunction listenForFunctionCalls({ on, send } : { on : OnType, send : SendType }) : CancelableType {\n    return globalStore('builtinListeners').getOrSet('functionCalls', () => {\n        return on(MESSAGE_NAME.METHOD, { domain: WILDCARD }, ({ source, origin, data } : { source : CrossDomainWindowType, origin : string, data : Object }) => {\n            const { id, name } = data;\n\n            const meth = lookupMethod(source, id);\n    \n            if (!meth) {\n                throw new Error(`Could not find method '${ name }' with id: ${ data.id } in ${ getDomain(window) }`);\n            }\n\n            const { source: methodSource, domain, val } = meth;\n            \n            return ZalgoPromise.try(() => {\n                if (!matchDomain(domain, origin)) {\n                    // $FlowFixMe\n                    throw new Error(`Method '${ data.name }' domain ${ JSON.stringify(isRegex(meth.domain) ? meth.domain.source : meth.domain) } does not match origin ${ origin } in ${ getDomain(window) }`);\n                }\n                \n                if (ProxyWindow.isProxyWindow(methodSource)) {\n                    // $FlowFixMe\n                    return methodSource.matchWindow(source, { send }).then(match => {\n                        if (!match) {\n                            throw new Error(`Method call '${ data.name }' failed - proxy window does not match source in ${ getDomain(window) }`);\n                        }\n                    });\n                }\n            }).then(() => {\n                return val.apply({ source, origin }, data.args);\n            }, err => {\n                return ZalgoPromise.try(() => {\n                    if (val.onError) {\n                        return val.onError(err);\n                    }\n                }).then(() => {\n                    // $FlowFixMe\n                    if (err.stack) {\n                        // $FlowFixMe\n                        err.stack = `Remote call to ${ name }()\\n\\n${ err.stack }`;\n                    }\n\n                    throw err;\n                });\n            }).then(result => {\n                return { result, id, name };\n            });\n        });\n    });\n}\n\nexport type SerializedFunction = CustomSerializedType<typeof SERIALIZATION_TYPE.CROSS_DOMAIN_FUNCTION, {\n    id : string,\n    name : string\n}>;\n\n// eslint-disable-next-line flowtype/require-exact-type\ntype SerializableFunction<T> = {\n    () : ZalgoPromise<T> | T,\n    __id__? : string,\n    __name__? : string\n};\n\nexport function serializeFunction<T>(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, val : SerializableFunction<T>, key : string, { on, send } : { on : OnType, send : SendType }) : SerializedFunction {\n    listenForFunctionCalls({ on, send });\n    \n    const id = val.__id__ || uniqueID();\n    destination = ProxyWindow.unwrap(destination);\n    let name = val.__name__ || val.name || key;\n\n    if (name.indexOf('anonymous::') === 0) {\n        name = name.replace('anonymous::', `${ key }::`);\n    }\n\n    if (ProxyWindow.isProxyWindow(destination)) {\n        addMethod(id, val, name, destination, domain);\n\n        // $FlowFixMe\n        destination.awaitWindow().then(win => {\n            addMethod(id, val, name, win, domain);\n        });\n    } else {\n        addMethod(id, val, name, destination, domain);\n    }\n\n    return serializeType(SERIALIZATION_TYPE.CROSS_DOMAIN_FUNCTION, { id, name });\n}\n\nexport function deserializeFunction<T>(source : CrossDomainWindowType | ProxyWindow, origin : string, { id, name } : { id : string, name : string }, { send } : { send : SendType }) : (...args : $ReadOnlyArray<mixed>) => ZalgoPromise<T> {\n    const getDeserializedFunction = (opts? : Object = {}) => {\n        function crossDomainFunctionWrapper<X : mixed>() : ZalgoPromise<X> {\n            let originalStack;\n    \n            if (__DEBUG__) {\n                originalStack = (new Error(`Original call to ${ name }():`)).stack;\n            }\n    \n            return ProxyWindow.toProxyWindow(source, { send }).awaitWindow().then(win => {\n                const meth = lookupMethod(win, id);\n    \n                if (meth && meth.val !== crossDomainFunctionWrapper) {\n                    return meth.val.apply({ source: window, origin: getDomain() }, arguments);\n                } else {\n                    // $FlowFixMe\n                    const options = { domain: origin, fireAndForget: opts.fireAndForget };\n                    const args = Array.prototype.slice.call(arguments);\n\n                    return send(win, MESSAGE_NAME.METHOD, { id, name, args }, options)\n                        .then(res => {\n                            if (!opts.fireAndForget) {\n                                return res.data.result;\n                            }\n                        });\n                }\n    \n            }).catch(err => {\n                // $FlowFixMe\n                if (__DEBUG__ && originalStack && err.stack) {\n                    // $FlowFixMe\n                    err.stack = `${ err.stack }\\n\\n${ originalStack }`;\n                }\n                throw err;\n            });\n        }\n\n        crossDomainFunctionWrapper.__name__ = name;\n        crossDomainFunctionWrapper.__origin__ = origin;\n        crossDomainFunctionWrapper.__source__ = source;\n        crossDomainFunctionWrapper.__id__ = id;\n\n        crossDomainFunctionWrapper.origin = origin;\n\n        return crossDomainFunctionWrapper;\n    };\n\n    const crossDomainFunctionWrapper = getDeserializedFunction();\n    crossDomainFunctionWrapper.fireAndForget = getDeserializedFunction({ fireAndForget: true });\n\n    return crossDomainFunctionWrapper;\n}\n","/* @flow */\n\nimport { type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { serializeType, type CustomSerializedType, type Thenable } from 'universal-serialize/src';\n\nimport { SERIALIZATION_TYPE } from '../conf';\nimport type { OnType, SendType } from '../types';\n\nimport { serializeFunction, type SerializedFunction } from './function';\nimport { ProxyWindow } from './window';\n\nexport type SerializedPromise = CustomSerializedType<typeof SERIALIZATION_TYPE.CROSS_DOMAIN_ZALGO_PROMISE, {\n    then : SerializedFunction\n}>;\n\nexport function serializePromise(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, val : Thenable, key : string, { on, send } : { on : OnType, send : SendType }) : SerializedPromise {\n    return serializeType(SERIALIZATION_TYPE.CROSS_DOMAIN_ZALGO_PROMISE, {\n        then: serializeFunction(destination, domain, (resolve, reject) => val.then(resolve, reject), key, { on, send })\n    });\n}\n\nexport function deserializePromise<T>(source : CrossDomainWindowType | ProxyWindow, origin : string, { then } : { then : Function }) : ZalgoPromise<T> {\n    return new ZalgoPromise(then);\n}\n","/* @flow */\n\nimport { type CrossDomainWindowType, isWindow, type DomainMatcher } from 'cross-domain-utils/src';\nimport { TYPE, serialize, deserialize, type Thenable } from 'universal-serialize/src';\n\nimport { SERIALIZATION_TYPE } from '../conf';\nimport type { OnType, SendType } from '../types';\n\nimport { serializeFunction, deserializeFunction, type SerializedFunction } from './function';\nimport { serializePromise, deserializePromise, type SerializedPromise } from './promise';\nimport { serializeWindow, deserializeWindow, type SerializedWindow, ProxyWindow } from './window';\n\nexport function serializeMessage<T : mixed>(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, obj : T, { on, send } : { on : OnType, send : SendType }) : string {\n    return serialize(obj, {\n        [ TYPE.PROMISE ]:  (val : Thenable, key : string) : SerializedPromise => serializePromise(destination, domain, val, key, { on, send }),\n        [ TYPE.FUNCTION ]: (val : Function, key : string) : SerializedFunction => serializeFunction(destination, domain, val, key, { on, send }),\n        [ TYPE.OBJECT ]:   (val : CrossDomainWindowType) : Object | SerializedWindow => {\n            return (isWindow(val) || ProxyWindow.isProxyWindow(val)) ? serializeWindow(destination, domain, val, { on, send }) : val;\n        }\n    });\n}\n\nexport function deserializeMessage<T : mixed>(source : CrossDomainWindowType | ProxyWindow, origin : string, message : string, { on, send } : { on : OnType, send : SendType }) : T {\n    return deserialize(message, {\n        [ SERIALIZATION_TYPE.CROSS_DOMAIN_ZALGO_PROMISE ]: (serializedPromise)  => deserializePromise(source, origin, serializedPromise),\n        [ SERIALIZATION_TYPE.CROSS_DOMAIN_FUNCTION ]:      (serializedFunction) => deserializeFunction(source, origin, serializedFunction, { on, send }),\n        [ SERIALIZATION_TYPE.CROSS_DOMAIN_WINDOW ]:        (serializedWindow)   => deserializeWindow(source, origin, serializedWindow, { send })\n    });\n}\n","/* @flow */\n\nexport * from './serialize';\nexport * from './function';\nexport * from './promise';\nexport * from './window';\n","/* @flow */\n\nimport { isSameDomain, isSameTopWindow, isActuallySameDomain, getActualDomain,\n    getDomain, type CrossDomainWindowType, type DomainMatcher, PROTOCOL } from 'cross-domain-utils/src';\n\nimport { SEND_STRATEGY, WILDCARD } from '../../conf';\nimport { needsGlobalMessagingForBrowser } from '../../lib';\nimport { getGlobal } from '../../global';\nimport { sendBridgeMessage, needsBridgeForBrowser, isBridge } from '../../bridge';\n\nexport const SEND_MESSAGE_STRATEGIES = {};\n\nSEND_MESSAGE_STRATEGIES[SEND_STRATEGY.POST_MESSAGE] = (win : CrossDomainWindowType, serializedMessage : string, domain : DomainMatcher) => {\n\n    if (__TEST__) {\n        if (needsGlobalMessagingForBrowser() && isSameTopWindow(window, win) === false) {\n            return;\n        }\n    }\n\n    let domains;\n\n    if (Array.isArray(domain)) {\n        domains = domain;\n    } else if (typeof domain === 'string') {\n        domains = [ domain ];\n    } else {\n        domains = [ WILDCARD ];\n    }\n\n    domains = domains.map(dom => {\n\n        if (__TEST__) {\n            if (dom.indexOf(PROTOCOL.MOCK) === 0) {\n                if (window.location.protocol === PROTOCOL.FILE) {\n                    return WILDCARD;\n                }\n\n                if (!isActuallySameDomain(win)) {\n                    throw new Error(`Attempting to send messsage to mock domain ${ dom }, but window is actually cross-domain`);\n                }\n\n                // $FlowFixMe\n                const windowDomain = getDomain(win);\n                \n                if (windowDomain !== dom) {\n                    throw new Error(`Mock domain target ${ dom } does not match window domain ${ windowDomain }`);\n                }\n\n                // $FlowFixMe\n                return getActualDomain(win);\n\n            }\n        }\n        \n        if (dom.indexOf(PROTOCOL.FILE) === 0) {\n            return WILDCARD;\n        }\n\n        return dom;\n    });\n\n    domains.forEach(dom => {\n        win.postMessage(serializedMessage, dom);\n    });\n};\n\nif (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n\n    SEND_MESSAGE_STRATEGIES[SEND_STRATEGY.BRIDGE] = (win : CrossDomainWindowType, serializedMessage : string, domain : string) => {\n\n        if (!needsBridgeForBrowser() && !isBridge()) {\n            throw new Error(`Bridge not needed for browser`);\n        }\n\n        if (isSameDomain(win)) {\n            throw new Error(`Post message through bridge disabled between same domain windows`);\n        }\n\n        if (isSameTopWindow(window, win) !== false) {\n            throw new Error(`Can only use bridge to communicate between two different windows, not between frames`);\n        }\n\n        sendBridgeMessage(win, domain, serializedMessage);\n    };\n}\n\nif (__POST_ROBOT__.__IE_POPUP_SUPPORT__ || __POST_ROBOT__.__GLOBAL_MESSAGE_SUPPORT__) {\n    \n    SEND_MESSAGE_STRATEGIES[SEND_STRATEGY.GLOBAL] = (win : CrossDomainWindowType, serializedMessage : string) => {\n\n        if (!needsGlobalMessagingForBrowser()) {\n            throw new Error(`Global messaging not needed for browser`);\n        }\n\n        if (!isSameDomain(win)) {\n            throw new Error(`Post message through global disabled between different domain windows`);\n        }\n\n        if (isSameTopWindow(window, win) !== false) {\n            throw new Error(`Can only use global to communicate between two different windows, not between frames`);\n        }\n\n        // $FlowFixMe\n        const foreignGlobal = getGlobal(win);\n\n        if (!foreignGlobal) {\n            throw new Error(`Can not find postRobot global on foreign window`);\n        }\n\n        foreignGlobal.receiveMessage({\n            source: window,\n            origin: getDomain(),\n            data:   serializedMessage\n        });\n    };\n}\n","/* @flow */\n\nimport { isWindowClosed, getDomain, type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { uniqueID, stringifyError } from 'belter/src';\n\nimport { serializeMessage } from '../../serialize';\nimport type { Message } from '../types';\nimport type { OnType, SendType } from '../../types';\n\nimport { SEND_MESSAGE_STRATEGIES } from './strategies';\n\nexport function sendMessage(win : CrossDomainWindowType, domain : DomainMatcher, message : Message, { on, send } : { on : OnType, send : SendType }) {\n    if (isWindowClosed(win)) {\n        throw new Error('Window is closed');\n    }\n    \n    const serializedMessage = serializeMessage(win, domain, {\n        [ __POST_ROBOT__.__GLOBAL_KEY__ ]: {\n            id:     uniqueID(),\n            origin: getDomain(window),\n            ...message\n        }\n    }, { on, send });\n\n    const strategies = Object.keys(SEND_MESSAGE_STRATEGIES);\n    const errors = [];\n\n    for (const strategyName of strategies) {\n        try {\n            SEND_MESSAGE_STRATEGIES[strategyName](win, serializedMessage, domain);\n        } catch (err) {\n            errors.push(err);\n        }\n    }\n\n    if (errors.length === strategies.length) {\n        throw new Error(`All post-robot messaging strategies failed:\\n\\n${ errors.map((err, i) => `${ i }. ${ stringifyError(err) }`).join('\\n\\n') }`);\n    }\n}\n","/* @flow */\n\nimport { type ZalgoPromise } from 'zalgo-promise/src';\nimport { matchDomain, type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { isRegex, getOrSet } from 'belter/src';\n\nimport { getWildcard, type WildCard, globalStore, windowStore } from '../global';\nimport { WILDCARD } from '../conf';\n\nexport function resetListeners() {\n    const responseListeners = globalStore('responseListeners');\n    const erroredResponseListeners = globalStore('erroredResponseListeners');\n    responseListeners.reset();\n    erroredResponseListeners.reset();\n}\n\nconst __DOMAIN_REGEX__ = '__domain_regex__';\n\nexport type RequestListenerType = {|\n    handler : ({ source : CrossDomainWindowType, origin : string, data : mixed }) => (mixed | ZalgoPromise<mixed>),\n    handleError : (err : mixed) => void,\n    window : ?CrossDomainWindowType,\n    name : string,\n    domain : DomainMatcher\n|};\n\nexport type ResponseListenerType = {|\n    name : string,\n    win : CrossDomainWindowType,\n    domain : DomainMatcher,\n    promise : ZalgoPromise<*>,\n    ack? : ?boolean,\n    cancelled? : ?boolean\n|};\n\nexport function addResponseListener(hash : string, listener : ResponseListenerType) {\n    const responseListeners = globalStore('responseListeners');\n    responseListeners.set(hash, listener);\n}\n\nexport function getResponseListener(hash : string) : ?ResponseListenerType {\n    const responseListeners = globalStore('responseListeners');\n    return responseListeners.get(hash);\n}\n\nexport function deleteResponseListener(hash : string) {\n    const responseListeners = globalStore('responseListeners');\n    responseListeners.del(hash);\n}\n\nexport function cancelResponseListeners() {\n    const responseListeners = globalStore('responseListeners');\n    for (const hash of responseListeners.keys()) {\n        const listener = responseListeners.get(hash);\n        if (listener) {\n            listener.cancelled = true;\n        }\n        responseListeners.del(hash);\n    }\n}\n\nexport function markResponseListenerErrored(hash : string) {\n    const erroredResponseListeners = globalStore('erroredResponseListeners');\n    erroredResponseListeners.set(hash, true);\n}\n\nexport function isResponseListenerErrored(hash : string) : boolean {\n    const erroredResponseListeners = globalStore('erroredResponseListeners');\n    return erroredResponseListeners.has(hash);\n}\n\nexport function getRequestListener({ name, win, domain } : { name : string, win : ?(CrossDomainWindowType | WildCard), domain : ?(string | RegExp) }) : ?RequestListenerType {\n    const requestListeners = windowStore('requestListeners');\n\n    if (win === WILDCARD) {\n        win = null;\n    }\n\n    if (domain === WILDCARD) {\n        domain = null;\n    }\n\n    if (!name) {\n        throw new Error(`Name required to get request listener`);\n    }\n\n    for (const winQualifier of [ win, getWildcard() ]) {\n        if (!winQualifier) {\n            continue;\n        }\n\n        const nameListeners = requestListeners.get(winQualifier);\n\n        if (!nameListeners) {\n            continue;\n        }\n\n        const domainListeners = nameListeners[name];\n\n        if (!domainListeners) {\n            continue;\n        }\n\n        if (domain && typeof domain === 'string') {\n            if (domainListeners[domain]) {\n                return domainListeners[domain];\n            }\n\n            if (domainListeners[__DOMAIN_REGEX__]) {\n                for (const { regex, listener } of domainListeners[__DOMAIN_REGEX__]) {\n                    if (matchDomain(regex, domain)) {\n                        return listener;\n                    }\n                }\n            }\n        }\n\n        if (domainListeners[WILDCARD]) {\n            return domainListeners[WILDCARD];\n        }\n    }\n}\n\nexport function addRequestListener({ name, win, domain } : { name : string, win : ?(CrossDomainWindowType | WildCard), domain : ?DomainMatcher }, listener : RequestListenerType) : { cancel : () => void } {\n    const requestListeners = windowStore('requestListeners');\n\n    if (!name || typeof name !== 'string') {\n        throw new Error(`Name required to add request listener`);\n    }\n\n    if (Array.isArray(win)) {\n        const listenersCollection = [];\n\n        for (const item of win) {\n            listenersCollection.push(addRequestListener({ name, domain, win: item }, listener));\n        }\n\n        return {\n            cancel() {\n                for (const cancelListener of listenersCollection) {\n                    cancelListener.cancel();\n                }\n            }\n        };\n    }\n\n    if (Array.isArray(domain)) {\n        const listenersCollection = [];\n\n        for (const item of domain) {\n            listenersCollection.push(addRequestListener({ name, win, domain: item }, listener));\n        }\n\n        return {\n            cancel() {\n                for (const cancelListener of listenersCollection) {\n                    cancelListener.cancel();\n                }\n            }\n        };\n    }\n\n    const existingListener = getRequestListener({ name, win, domain });\n\n    if (!win || win === WILDCARD) {\n        win = getWildcard();\n    }\n\n    domain = domain || WILDCARD;\n\n    if (existingListener) {\n        if (win && domain) {\n            throw new Error(`Request listener already exists for ${ name } on domain ${ domain.toString() } for ${ win === getWildcard() ? 'wildcard' : 'specified' } window`);\n        } else if (win) {\n            throw new Error(`Request listener already exists for ${ name } for ${ win === getWildcard() ? 'wildcard' : 'specified' } window`);\n        } else if (domain) {\n            throw new Error(`Request listener already exists for ${ name } on domain ${ domain.toString() }`);\n        } else {\n            throw new Error(`Request listener already exists for ${ name }`);\n        }\n    }\n\n    const nameListeners = requestListeners.getOrSet(win, () => ({}));\n    const domainListeners = getOrSet(nameListeners, name, () => ({}));\n\n    const strDomain = domain.toString();\n\n    let regexListeners;\n    let regexListener;\n\n    if (isRegex(domain)) {\n        regexListeners = getOrSet(domainListeners, __DOMAIN_REGEX__, () => []);\n        regexListener = { regex: domain, listener };\n        regexListeners.push(regexListener);\n    } else {\n        domainListeners[strDomain] = listener;\n    }\n\n    return {\n        cancel() {\n            delete domainListeners[strDomain];\n\n            if (regexListener) {\n                regexListeners.splice(regexListeners.indexOf(regexListener, 1));\n\n                if (!regexListeners.length) {\n                    delete domainListeners[__DOMAIN_REGEX__];\n                }\n            }\n\n            if (!Object.keys(domainListeners).length) {\n                delete nameListeners[name];\n            }\n\n            if (win && !Object.keys(nameListeners).length) {\n                requestListeners.del(win);\n            }\n        }\n    };\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { getDomain, isWindowClosed, matchDomain, stringifyDomainPattern, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop, stringifyError } from 'belter/src';\n\nimport { MESSAGE_TYPE, MESSAGE_ACK, MESSAGE_NAME } from '../../conf';\nimport { sendMessage } from '../send';\nimport { getRequestListener, getResponseListener, deleteResponseListener, isResponseListenerErrored } from '../listeners';\nimport type { RequestMessage, AckResponseMessage, SuccessResponseMessage, ErrorResponseMessage } from '../types';\nimport type { OnType, SendType } from '../../types';\n\nexport const RECEIVE_MESSAGE_TYPES = {\n\n    [ MESSAGE_TYPE.REQUEST ](source : CrossDomainWindowType, origin : string, message : RequestMessage, { on, send } : { on : OnType, send : SendType }) : ZalgoPromise<void> {\n\n        const options = getRequestListener({ name: message.name, win: source, domain: origin });\n\n        const logName = (message.name === MESSAGE_NAME.METHOD && message.data && typeof message.data.name === 'string') ? `${ message.data.name }()` : message.name;\n\n        if (__DEBUG__) {\n            // eslint-disable-next-line no-console\n            console.info('receive::req', logName, origin, '\\n\\n', message.data);\n        }\n\n        function sendResponse(type : $Values<typeof MESSAGE_TYPE>, ack? : $Values<typeof MESSAGE_ACK>, response = {}) {\n\n            if (message.fireAndForget || isWindowClosed(source)) {\n                return;\n            }\n\n            if (__DEBUG__ && type !== MESSAGE_TYPE.ACK) {\n                if (ack === MESSAGE_ACK.SUCCESS) {\n                    // $FlowFixMe\n                    console.info('respond::res', logName, origin, '\\n\\n', response.data);  // eslint-disable-line no-console\n                } else if (ack === MESSAGE_ACK.ERROR) {\n                    // $FlowFixMe\n                    console.error('respond::err', logName, origin, '\\n\\n', response.error); // eslint-disable-line no-console\n                }\n            }\n\n            try {\n                // $FlowFixMe\n                sendMessage(source, origin, {\n                    type,\n                    ack,\n                    hash:   message.hash,\n                    name:   message.name,\n                    ...response\n                }, { on, send });\n            } catch (err) {\n                throw new Error(`Send response message failed for ${ logName } in ${ getDomain() }\\n\\n${ stringifyError(err) }`);\n            }\n        }\n\n        return ZalgoPromise.all([\n\n            sendResponse(MESSAGE_TYPE.ACK),\n\n            ZalgoPromise.try(() => {\n\n                if (!options) {\n                    throw new Error(`No handler found for post message: ${ message.name } from ${ origin } in ${ window.location.protocol }//${ window.location.host }${ window.location.pathname }`);\n                }\n\n                if (!matchDomain(options.domain, origin)) {\n                    throw new Error(`Request origin ${ origin } does not match domain ${ options.domain.toString() }`);\n                }\n\n                const data = message.data;\n\n                return options.handler({ source, origin, data });\n\n            }).then(data => {\n                return sendResponse(MESSAGE_TYPE.RESPONSE, MESSAGE_ACK.SUCCESS, { data });\n\n            }, error => {\n                return sendResponse(MESSAGE_TYPE.RESPONSE, MESSAGE_ACK.ERROR, { error });\n            })\n\n        ]).then(noop).catch(err => {\n            if (options && options.handleError) {\n                return options.handleError(err);\n            } else {\n                throw err;\n            }\n        });\n    },\n\n    [ MESSAGE_TYPE.ACK ](source : CrossDomainWindowType, origin : string, message : AckResponseMessage) {\n\n        if (isResponseListenerErrored(message.hash)) {\n            return;\n        }\n\n        const options = getResponseListener(message.hash);\n\n        if (!options) {\n            throw new Error(`No handler found for post message ack for message: ${ message.name } from ${ origin } in ${ window.location.protocol }//${ window.location.host }${ window.location.pathname }`);\n        }\n\n        try {\n            if (!matchDomain(options.domain, origin)) {\n                throw new Error(`Ack origin ${ origin } does not match domain ${ options.domain.toString() }`);\n            }\n    \n            if (source !== options.win) {\n                throw new Error(`Ack source does not match registered window`);\n            }\n        } catch (err) {\n            options.promise.reject(err);\n        }\n\n        options.ack = true;\n    },\n\n    [ MESSAGE_TYPE.RESPONSE ](source : CrossDomainWindowType, origin : string, message : SuccessResponseMessage | ErrorResponseMessage) : void | ZalgoPromise<void> {\n\n        if (isResponseListenerErrored(message.hash)) {\n            return;\n        }\n\n        const options = getResponseListener(message.hash);\n\n        if (!options) {\n            throw new Error(`No handler found for post message response for message: ${ message.name } from ${ origin } in ${ window.location.protocol }//${ window.location.host }${ window.location.pathname }`);\n        }\n\n        if (!matchDomain(options.domain, origin)) {\n            throw new Error(`Response origin ${ origin } does not match domain ${ stringifyDomainPattern(options.domain) }`);\n        }\n\n        if (source !== options.win) {\n            throw new Error(`Response source does not match registered window`);\n        }\n\n        deleteResponseListener(message.hash);\n\n        const logName = (message.name === MESSAGE_NAME.METHOD && message.data && typeof message.data.name === 'string') ? `${ message.data.name }()` : message.name;\n\n        if (message.ack === MESSAGE_ACK.ERROR) {\n            if (__DEBUG__) {\n                console.error('receive::err', logName, origin, '\\n\\n', message.error); // eslint-disable-line no-console\n            }\n\n            options.promise.reject(message.error);\n\n        } else if (message.ack === MESSAGE_ACK.SUCCESS) {\n            if (__DEBUG__) {\n                console.info('receive::res', logName, origin, '\\n\\n', message.data); // eslint-disable-line no-console\n            }\n\n            options.promise.resolve({ source, origin, data: message.data });\n        }\n    }\n};\n","/* @flow */\n\nimport { isWindowClosed, type CrossDomainWindowType, getDomain, isSameTopWindow, PROTOCOL  } from 'cross-domain-utils/src';\nimport { addEventListener, noop } from 'belter/src';\n\nimport { markWindowKnown, needsGlobalMessagingForBrowser } from '../../lib';\nimport { deserializeMessage } from '../../serialize';\nimport { getGlobal, globalStore } from '../../global';\nimport type { OnType, SendType, MessageEvent, CancelableType } from '../../types';\n\nimport { RECEIVE_MESSAGE_TYPES } from './types';\n\nfunction parseMessage(message : string, source : CrossDomainWindowType, origin : string, { on, send } : { on : OnType, send : SendType }) : ?Object {\n    let parsedMessage;\n\n    try {\n        parsedMessage = deserializeMessage(source, origin, message, { on, send });\n    } catch (err) {\n        return;\n    }\n\n    if (!parsedMessage) {\n        return;\n    }\n\n    if (typeof parsedMessage !== 'object' || parsedMessage === null) {\n        return;\n    }\n\n    parsedMessage = parsedMessage[__POST_ROBOT__.__GLOBAL_KEY__];\n\n    if (!parsedMessage || typeof parsedMessage !== 'object' || parsedMessage === null) {\n        return;\n    }\n\n    if (!parsedMessage.type || typeof parsedMessage.type !== 'string') {\n        return;\n    }\n\n    if (!RECEIVE_MESSAGE_TYPES[parsedMessage.type]) {\n        return;\n    }\n\n    return parsedMessage;\n}\n\nexport function receiveMessage(event : MessageEvent, { on, send } : { on : OnType, send : SendType }) {\n    const receivedMessages = globalStore('receivedMessages');\n\n    if (!window || window.closed) {\n        throw new Error(`Message recieved in closed window`);\n    }\n\n    try {\n        if (!event.source) {\n            return;\n        }\n    } catch (err) {\n        return;\n    }\n\n    let { source, origin, data } = event;\n\n    if (__TEST__) {\n        // $FlowFixMe\n        origin = getDomain(source);\n    }\n\n    const message = parseMessage(data, source, origin, { on, send });\n\n    if (!message) {\n        return;\n    }\n\n    markWindowKnown(source);\n\n    if (receivedMessages.has(message.id)) {\n        return;\n    }\n\n    receivedMessages.set(message.id, true);\n\n    if (isWindowClosed(source) && !message.fireAndForget) {\n        return;\n    }\n\n    if (message.origin.indexOf(PROTOCOL.FILE) === 0) {\n        origin = `${ PROTOCOL.FILE }//`;\n    }\n\n    RECEIVE_MESSAGE_TYPES[message.type](source, origin, message, { on, send });\n}\n\nexport function setupGlobalReceiveMessage({ on, send } : { on : OnType, send : SendType }) {\n    const global = getGlobal();\n    global.receiveMessage = global.receiveMessage || (message => receiveMessage(message, { on, send }));\n}\n\ntype ListenerEvent = {|\n    source : CrossDomainWindowType,\n    origin : string,\n    data : string,\n    sourceElement : CrossDomainWindowType,\n    originalEvent? : { origin : string }\n|};\n\nexport function messageListener(event : ListenerEvent, { on, send } : { on : OnType, send : SendType }) {\n\n    try {\n        noop(event.source);\n    } catch (err) {\n        return;\n    }\n\n    const source = event.source || event.sourceElement;\n    let origin = event.origin || (event.originalEvent && event.originalEvent.origin);\n    const data = event.data;\n\n    if (origin === 'null') {\n        origin = `${ PROTOCOL.FILE }//`;\n    }\n\n    if (!source) {\n        return;\n    }\n\n    if (!origin) {\n        throw new Error(`Post message did not have origin domain`);\n    }\n\n    if (__TEST__) {\n        if (needsGlobalMessagingForBrowser() && isSameTopWindow(source, window) === false) {\n            return;\n        }\n    }\n\n    receiveMessage({ source, origin, data }, { on, send });\n}\n\nexport function listenForMessages({ on, send } : { on : OnType, send : SendType }) : CancelableType {\n    return globalStore().getOrSet('postMessageListener', () => {\n        return addEventListener(window, 'message', event => {\n            // $FlowFixMe\n            messageListener(event, { on, send });\n        });\n    });\n}\n\nexport function stopListenForMessages() {\n    const listener = globalStore().get('postMessageListener');\n    if (listener) {\n        listener.cancel();\n    }\n}\n","/* @flow */\n\nexport * from './receive';\nexport * from './send';\nexport * from './listeners';\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\n\nimport { addRequestListener, type RequestListenerType } from '../drivers';\nimport { WILDCARD } from '../conf';\nimport type { ServerOptionsType, HandlerType, CancelableType } from '../types';\n\nexport function on(name : string, options : ServerOptionsType | HandlerType, handler : ?HandlerType) : CancelableType {\n\n    if (!name) {\n        throw new Error('Expected name');\n    }\n\n    if (typeof options === 'function') {\n        handler = options;\n        // $FlowFixMe\n        options = {};\n    }\n\n    if (!handler) {\n        throw new Error('Expected handler');\n    }\n\n    options = options || {};\n    options.name = name;\n    options.handler = handler || options.handler;\n\n    const win = options.window;\n    const domain = options.domain;\n\n    const listenerOptions : RequestListenerType = {\n        handler:     options.handler,\n        handleError: options.errorHandler || (err => {\n            throw err;\n        }),\n        window: win,\n        domain: domain || WILDCARD,\n        name\n    };\n\n    const requestListener = addRequestListener({ name, win, domain }, listenerOptions);\n\n    return {\n        cancel() {\n            requestListener.cancel();\n        }\n    };\n}\n\nexport function once(name : string, options? : ServerOptionsType | HandlerType, handler? : HandlerType) : ZalgoPromise<{ source : mixed, origin : string, data : Object }> {\n    \n    // $FlowFixMe\n    options = options || {};\n    if (typeof options === 'function') {\n        handler = options;\n        // $FlowFixMe\n        options = {};\n    }\n\n    const promise = new ZalgoPromise();\n    let listener; // eslint-disable-line prefer-const\n\n    options.errorHandler = (err) => {\n        listener.cancel();\n        promise.reject(err);\n    };\n\n    listener = on(name, options, event => {\n        listener.cancel();\n        promise.resolve(event);\n        if (handler) {\n            return handler(event);\n        }\n    });\n\n    promise.cancel = listener.cancel;\n    return promise;\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { isAncestor, isWindowClosed, getDomain, matchDomain, type CrossDomainWindowType, type DomainMatcher } from 'cross-domain-utils/src';\nimport { uniqueID, isRegex, noop, safeInterval, stringify, stringifyError } from 'belter/src';\n\n\nimport { CHILD_WINDOW_TIMEOUT, MESSAGE_TYPE, WILDCARD, MESSAGE_NAME, ACK_TIMEOUT, RES_TIMEOUT, ACK_TIMEOUT_KNOWN, RESPONSE_CYCLE_TIME } from '../conf';\nimport { sendMessage, addResponseListener, deleteResponseListener, markResponseListenerErrored, type ResponseListenerType } from '../drivers';\nimport { awaitWindowHello, sayHello, isWindowKnown } from '../lib';\nimport { windowStore } from '../global';\nimport type { SendType } from '../types';\n\nimport { on } from './on';\n\nfunction validateOptions(name : string, win : CrossDomainWindowType, domain : ?DomainMatcher) {\n    if (!name) {\n        throw new Error('Expected name');\n    }\n\n    if (domain) {\n        if (typeof domain !== 'string' && !Array.isArray(domain) && !isRegex(domain)) {\n            throw new TypeError(`Expected domain to be a string, array, or regex`);\n        }\n    }\n\n    if (isWindowClosed(win)) {\n        throw new Error('Target window is closed');\n    }\n}\n\nfunction normalizeDomain(win : CrossDomainWindowType, targetDomain : DomainMatcher, actualDomain : ?string, { send } : { send : SendType }) : ZalgoPromise<string | $ReadOnlyArray<string>> {\n    if (typeof targetDomain === 'string') {\n        return ZalgoPromise.resolve(targetDomain);\n    }\n    \n    return ZalgoPromise.try(() => {\n        return actualDomain || sayHello(win, { send }).then(({ domain }) => domain);\n\n    }).then(normalizedDomain => {\n        if (!matchDomain(targetDomain, targetDomain)) {\n            throw new Error(`Domain ${ stringify(targetDomain) } does not match ${ stringify(targetDomain) }`);\n        }\n\n        return normalizedDomain;\n    });\n}\n\nexport const send : SendType = (win, name, data, options) => {\n    options = options || {};\n    let domain = options.domain || WILDCARD;\n    const responseTimeout = options.timeout || RES_TIMEOUT;\n    const childTimeout = options.timeout || CHILD_WINDOW_TIMEOUT;\n    const fireAndForget = options.fireAndForget || false;\n\n    // $FlowFixMe\n    return ZalgoPromise.try(() => {\n        validateOptions(name, win, domain);\n\n        if (isAncestor(window, win)) {\n            return awaitWindowHello(win, childTimeout);\n        }\n        \n    }).then(({ domain: actualDomain } = {}) => {\n\n        return normalizeDomain(win, domain, actualDomain, { send });\n    }).then(targetDomain => {\n\n        domain = targetDomain;\n\n        const logName = (name === MESSAGE_NAME.METHOD && data && typeof data.name === 'string') ? `${ data.name }()` : name;\n\n        if (__DEBUG__) {\n            console.info('send::req', logName, domain, '\\n\\n', data); // eslint-disable-line no-console\n        }\n\n        const promise = new ZalgoPromise();\n        const hash = `${ name }_${ uniqueID() }`;\n\n        if (!fireAndForget) {\n            const responseListener : ResponseListenerType = { name, win, domain, promise };\n            addResponseListener(hash, responseListener);\n\n            const reqPromises = windowStore('requestPromises').getOrSet(win, () => []);\n            reqPromises.push(promise);\n\n            promise.catch(() => {\n                markResponseListenerErrored(hash);\n                deleteResponseListener(hash);\n            });\n\n            const totalAckTimeout = isWindowKnown(win) ? ACK_TIMEOUT_KNOWN : ACK_TIMEOUT;\n            const totalResTimeout = responseTimeout;\n\n            let ackTimeout = totalAckTimeout;\n            let resTimeout = totalResTimeout;\n        \n            const interval = safeInterval(() => {\n                if (isWindowClosed(win)) {\n                    return promise.reject(new Error(`Window closed for ${ name } before ${ responseListener.ack ? 'response' : 'ack' }`));\n                }\n\n                if (responseListener.cancelled) {\n                    return promise.reject(new Error(`Response listener was cancelled for ${ name }`));\n                }\n\n                ackTimeout = Math.max(ackTimeout - RESPONSE_CYCLE_TIME, 0);\n                if (resTimeout !== -1) {\n                    resTimeout = Math.max(resTimeout - RESPONSE_CYCLE_TIME, 0);\n                }\n\n                if (!responseListener.ack && ackTimeout === 0) {\n                    return promise.reject(new Error(`No ack for postMessage ${ logName } in ${ getDomain() } in ${ totalAckTimeout }ms`));\n\n                } else if (resTimeout === 0) {\n                    return promise.reject(new Error(`No response for postMessage ${ logName } in ${ getDomain() } in ${ totalResTimeout }ms`));\n                }\n            }, RESPONSE_CYCLE_TIME);\n\n            promise.finally(() => {\n                interval.cancel();\n                reqPromises.splice(reqPromises.indexOf(promise, 1));\n            }).catch(noop);\n        }\n\n        try {\n            sendMessage(win, domain, {\n                type: MESSAGE_TYPE.REQUEST,\n                hash,\n                name,\n                data,\n                fireAndForget\n            }, { on, send });\n        } catch (err) {\n            throw new Error(`Send request message failed for ${ logName } in ${ getDomain() }\\n\\n${ stringifyError(err) }`);\n        }\n    \n        return fireAndForget ? promise.resolve() : promise;\n    });\n};\n","/* @flow */\n\nexport * from './on';\nexport * from './send';\n","/* @flow */\n\nimport type { CrossDomainWindowType, DomainMatcher } from 'cross-domain-utils/src';\n\nimport { initHello } from './lib';\nimport { listenForMessages, stopListenForMessages, receiveMessage, setupGlobalReceiveMessage, cancelResponseListeners } from './drivers';\nimport { getGlobal, deleteGlobal } from './global';\nimport { on, send } from './public';\nimport { setupBridge } from './bridge';\nimport { serializeMessage as internalSerializeMessage, deserializeMessage as internalDeserializeMessage, ProxyWindow } from './serialize';\n\nexport function serializeMessage<T>(destination : CrossDomainWindowType | ProxyWindow, domain : DomainMatcher, obj : T) : string {\n    return internalSerializeMessage(destination, domain, obj, { on, send });\n}\n\nexport function deserializeMessage<T : mixed>(source : CrossDomainWindowType | ProxyWindow, origin : string, message : string) : T {\n    return internalDeserializeMessage(source, origin, message, { on, send });\n}\n\nexport function createProxyWindow(win? : CrossDomainWindowType) : ProxyWindow {\n    return new ProxyWindow({ send, win });\n}\n\nexport function toProxyWindow(win : CrossDomainWindowType | ProxyWindow) : ProxyWindow {\n    return ProxyWindow.toProxyWindow(win, { send });\n}\n\nexport function setup() {\n    if (!getGlobal().initialized) {\n        getGlobal().initialized = true;\n    \n        setupGlobalReceiveMessage({ on, send });\n        listenForMessages({ on, send });\n    \n        if (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n            setupBridge({ on, send, receiveMessage });\n        }\n\n        initHello({ on, send });\n    }\n}\n\nexport function destroy() {\n    cancelResponseListeners();\n    stopListenForMessages();\n    deleteGlobal();\n}\n","/* @flow */\n\nimport type { ZalgoPromise } from 'zalgo-promise/src';\nimport type { CrossDomainWindowType, DomainMatcher } from 'cross-domain-utils/src';\n\n// export something to force webpack to see this as an ES module\nexport const TYPES = true;\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type CancelableType = {\n    cancel : () => void\n};\n\nexport type ErrorHandlerType = (err : mixed) => void;\n\nexport type HandlerType = ({\n    source : CrossDomainWindowType,\n    origin : string,\n    data : any // eslint-disable-line flowtype/no-weak-types\n}) => (void | any | ZalgoPromise<any>); // eslint-disable-line flowtype/no-weak-types\n\nexport type ServerOptionsType = {|\n    handler? : ?HandlerType,\n    errorHandler? : ?ErrorHandlerType,\n    window? : CrossDomainWindowType,\n    name? : ?string,\n    domain? : ?DomainMatcher,\n    once? : ?boolean,\n    errorOnClose? : ?boolean\n|};\n\nexport type OnType = (\n    name : string,\n    options : ServerOptionsType | HandlerType,\n    handler : ?HandlerType\n) => CancelableType;\n\ntype RegularRequestOptionsType = {|\n    domain? : ?DomainMatcher,\n    fireAndForget? : false,\n    timeout? : ?number\n|};\n\ntype FireAndForgetRequestOptionsType = {|\n    domain? : ?DomainMatcher,\n    fireAndForget : true,\n    timeout? : ?number\n|};\n\nexport type RequestOptionsType = RegularRequestOptionsType | FireAndForgetRequestOptionsType;\n\nexport type ResponseMessageEvent = {|\n    source : CrossDomainWindowType,\n    origin : string,\n    data : Object\n|};\n\ntype RegularSendType = (\n    win : CrossDomainWindowType,\n    name : string,\n    data : ?Object,\n    options? : RegularRequestOptionsType\n) => ZalgoPromise<ResponseMessageEvent>;\n\ntype FireAndForgetSendType = (\n    win : CrossDomainWindowType,\n    name : string,\n    data : ?Object,\n    options? : FireAndForgetRequestOptionsType\n) => ZalgoPromise<void>;\n\nexport type SendType = RegularSendType & FireAndForgetSendType;\n\nexport type MessageEvent = {|\n    source : CrossDomainWindowType,\n    origin : string,\n    data : string\n|};\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type CrossDomainFunctionType<A, R> = {\n    (...args : A) : ZalgoPromise<R>,\n    fireAndForget : (...args : A) => ZalgoPromise<void>,\n    __id__? : string,\n    __name__? : string\n};\n\nexport type ReceiveMessageType = (MessageEvent, { on : OnType, send : SendType }) => void;\n","/* @flow */\n\nimport { type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { noop } from 'belter/src';\n\nimport { windowStore } from './global';\n\nexport function cleanUpWindow(win : CrossDomainWindowType) {\n    const requestPromises = windowStore('requestPromises');\n    for (const promise of requestPromises.get(win, [])) {\n        promise.reject(new Error(`Window cleaned up before response`)).catch(noop);\n    }\n}\n","/* @flow */\n\nimport { setup } from './setup';\nimport { setupBridge, openBridge, linkWindow, linkUrl, isBridge, needsBridge, needsBridgeForBrowser, hasBridge,\n    needsBridgeForWin, needsBridgeForDomain, destroyBridges } from './bridge';\n\nexport { ZalgoPromise as Promise } from 'zalgo-promise/src';\n\nexport * from './types';\nexport { ProxyWindow } from './serialize';\nexport { setup, destroy, serializeMessage, deserializeMessage, createProxyWindow, toProxyWindow } from './setup';\nexport { on, once, send } from './public';\nexport { markWindowKnown } from './lib';\nexport { cleanUpWindow } from './clean';\nexport let bridge;\n\nif (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n    bridge = { setupBridge, openBridge, linkWindow, linkUrl, isBridge, needsBridge,\n        needsBridgeForBrowser, hasBridge, needsBridgeForWin, needsBridgeForDomain, destroyBridges };\n}\n\nif (__POST_ROBOT__.__AUTO_SETUP__) {\n    setup();\n}\n","/* @flow */\n\nimport { isSameDomain, type CrossDomainWindowType } from 'cross-domain-utils/src';\n\nexport function getGlobal(win? : CrossDomainWindowType = window) : Object {\n\n    if (!isSameDomain(win)) {\n        throw new Error(`Can not get global for window on different domain`);\n    }\n\n    if (!win[__ZOID__.__GLOBAL_KEY__]) {\n        win[__ZOID__.__GLOBAL_KEY__] = {};\n    }\n\n    return win[__ZOID__.__GLOBAL_KEY__];\n}\n\nexport function destroyGlobal() {\n    delete window[__ZOID__.__GLOBAL_KEY__];\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\n\nexport type ProxyObject<T> = {|\n    get : () => ZalgoPromise<T>\n|};\n\nexport function getProxyObject<T>(obj : T) : ProxyObject<T> {\n    return {\n        get() : ZalgoPromise<T> {\n            return ZalgoPromise.try(() => {\n                if (this.source && this.source !== window) {\n                    throw new Error(`Can not call get on proxy object from a remote window`);\n                }\n    \n                return obj;\n            });\n        }\n    };\n}\n","/* @flow */\n\nexport * from './global';\nexport * from './serialize';\n","/* @flow */\n\nimport { WINDOW_TYPE } from 'cross-domain-utils/src';\n\nexport const ZOID = `zoid`;\n\nexport const POST_MESSAGE = {\n    DELEGATE:       `${ ZOID }_delegate`,\n    ALLOW_DELEGATE: `${ ZOID }_allow_delegate`\n};\n\nexport const PROP_TYPE = {\n    STRING:   `string`,\n    OBJECT:   `object`,\n    FUNCTION: `function`,\n    BOOLEAN:  `boolean`,\n    NUMBER:   `number`,\n    ARRAY:    `array`\n};\n\nexport const INITIAL_PROPS = {\n    RAW: 'raw',\n    UID: 'uid'\n};\n\nexport const WINDOW_REFERENCES = {\n    OPENER: ('opener' : 'opener'),\n    PARENT: ('parent' : 'parent'),\n    GLOBAL: ('global' : 'global')\n};\n\nexport const PROP_SERIALIZATION = {\n    JSON:   ('json' : 'json'),\n    DOTIFY: ('dotify' : 'dotify'),\n    BASE64: ('base64' : 'base64')\n};\n\nexport const CONTEXT = WINDOW_TYPE;\n\nexport const WILDCARD = '*';\n\nexport const DEFAULT_DIMENSIONS = {\n    WIDTH:  '300px',\n    HEIGHT: '150px'\n};\n\nexport const EVENT = {\n    RENDER:   'zoid-render',\n    RENDERED: 'zoid-rendered',\n    DISPLAY:  'zoid-display',\n    ERROR:    'zoid-error',\n    CLOSE:    'zoid-close',\n    PROPS:    'zoid-props',\n    RESIZE:   'zoid-resize',\n    FOCUS:    'zoid-focus'\n};\n","/* @flow */\n\nimport { getDomain, isSameDomain, type CrossDomainWindowType } from 'cross-domain-utils/src';\n\nimport type { Component } from '../component';\nimport type { PropsType, MixedPropDefinitionType } from '../component/props';\n\nimport type { ChildHelpers } from './index';\n\nexport function normalizeChildProp<T, P>(component : Component<P>, props : (PropsType<P>), key : string, value : T, helpers : ChildHelpers<P>) : ?T  {\n\n    // $FlowFixMe\n    const prop : MixedPropDefinitionType<P> = component.getPropDefinition(key);\n\n    if (!prop) {\n        return value;\n    }\n\n    if (typeof prop.childDecorate === 'function') {\n        const { close, focus, onError, onProps, resize, getParent, getParentDomain, show, hide } = helpers;\n        return prop.childDecorate({ value, close, focus, onError, onProps, resize, getParent, getParentDomain, show, hide });\n    }\n\n    return value;\n}\n\n// eslint-disable-next-line max-params\nexport function normalizeChildProps<P>(parentComponentWindow : CrossDomainWindowType, component : Component<P>, props : (PropsType<P>), origin : string, helpers : ChildHelpers<P>, isUpdate : boolean = false) : (PropsType<P>) {\n\n    const result = {};\n\n    for (const key of Object.keys(props)) {\n        const prop = component.getPropDefinition(key);\n\n        if (prop && prop.sameDomain && (origin !== getDomain(window) || !isSameDomain(parentComponentWindow))) {\n            continue;\n        }\n\n        // $FlowFixMe\n        const value = normalizeChildProp(component, props, key, props[key], helpers);\n\n        result[key] = value;\n        if (prop && prop.alias && !result[prop.alias]) {\n            result[prop.alias] = value;\n        }\n    }\n\n    if (!isUpdate) {\n        for (const key of component.getPropNames()) {\n            if (!props.hasOwnProperty(key)) {\n                result[key] = normalizeChildProp(component, props, key, props[key], helpers);\n            }\n        }\n    }\n\n    // $FlowFixMe\n    return result;\n}\n","/* @flow */\n\nimport { inlineMemoize, stringifyError, base64decode } from 'belter/src';\n\nimport { ZOID } from '../constants';\nimport type { ChildPayload } from '../parent';\n\nfunction parseChildWindowName(windowName : string) : ChildPayload {\n    return inlineMemoize(parseChildWindowName, () => {\n        if (!windowName) {\n            throw new Error(`No window name`);\n        }\n    \n        const [ , zoidcomp, name, encodedPayload ] = windowName.split('__');\n    \n        if (zoidcomp !== ZOID) {\n            throw new Error(`Window not rendered by zoid - got ${ zoidcomp }`);\n        }\n    \n        if (!name) {\n            throw new Error(`Expected component name`);\n        }\n    \n        if (!encodedPayload) {\n            throw new Error(`Expected encoded payload`);\n        }\n    \n        try {\n            return JSON.parse(base64decode(encodedPayload));\n        } catch (err) {\n            throw new Error(`Can not decode window name payload: ${ encodedPayload }: ${ stringifyError(err) }`);\n        }\n    }, [ windowName ]);\n}\n\nexport function getChildPayload() : ?ChildPayload {\n    try {\n        return parseChildWindowName(window.name);\n    } catch (err) {\n        // pass\n    }\n}\n","/* @flow */\n/* eslint max-lines: 0 */\n\nimport { isSameDomain, matchDomain, getDomain, getOpener,\n    getNthParentFromTop, getAncestor, getAllFramesInWindow,\n    type CrossDomainWindowType, onCloseWindow } from 'cross-domain-utils/src';\nimport { markWindowKnown, deserializeMessage, type CrossDomainFunctionType } from 'post-robot/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { extend, waitForDocumentBody, onResize, getElementSafe, assertExists } from 'belter/src';\n\nimport { getGlobal } from '../lib';\nimport { CONTEXT, INITIAL_PROPS, WINDOW_REFERENCES } from '../constants';\nimport type { Component } from '../component';\nimport type { PropsType } from '../component/props';\nimport type { WindowRef, PropRef, ParentExportsType } from '../parent';\n\nimport { normalizeChildProps } from './props';\nimport { getChildPayload } from './window';\n\nexport * from './window';\n\nexport type ChildExportsType<P> = {|\n    updateProps : CrossDomainFunctionType<[ PropsType<P> ], void>,\n    close : CrossDomainFunctionType<[], void>\n|};\n\nexport type ChildHelpers<P> = {|\n    close : () => ZalgoPromise<void>,\n    focus : () => ZalgoPromise<void>,\n    resize : ({ width : ?number, height : ?number }) => ZalgoPromise<void>,\n    onError : (mixed) => ZalgoPromise<void>,\n    onProps : ((PropsType<P>) => void) => void,\n    getParent : () => CrossDomainWindowType,\n    getParentDomain : () => string,\n    show : () => ZalgoPromise<void>,\n    hide : () => ZalgoPromise<void>\n|};\n\n/*  Child Component\n    ---------------\n\n    This is the portion of code which runs inside the frame or popup window containing the component's implementation.\n\n    When the component author calls myComponent.attach(), it creates a new instance of ChildComponent, which is then\n    responsible for managing the state and messaging back up to the parent, and providing props for the component to\n    utilize.\n*/\n\nexport class ChildComponent<P> {\n\n    component : Component<P>\n    props : PropsType<P>\n    context : string\n    parent : ParentExportsType<P>\n    parentDomain : string\n    parentComponentWindow : CrossDomainWindowType\n\n    onPropHandlers : Array<(PropsType<P>) => void> // eslint-disable-line flowtype/no-mutable-array\n    autoResize : { width : boolean, height : boolean, element? : string }\n\n    constructor(component : Component<P>) {\n        ZalgoPromise.try(() => {\n            this.component = component;\n            this.onPropHandlers = [];\n            \n            const childPayload = getChildPayload();\n\n            if (!childPayload) {\n                throw new Error(`No child payload found`);\n            }\n\n            if (childPayload.version !== __ZOID__.__VERSION__) {\n                throw new Error(`Parent window has zoid version ${ childPayload.version }, child window has version ${ __ZOID__.__VERSION__ }`);\n            }\n\n            const { parent, parentDomain, exports, context, props } = childPayload;\n\n            this.context = context;\n            this.parentComponentWindow = this.getParentComponentWindow(parent);\n            this.parentDomain = parentDomain;\n            this.parent = deserializeMessage(this.parentComponentWindow, parentDomain, exports);\n\n            this.checkParentDomain(parentDomain);\n\n            const initialProps = this.getPropsByRef(this.parentComponentWindow, parentDomain, props);\n            this.setProps(initialProps, parentDomain);\n            markWindowKnown(this.parentComponentWindow);\n            \n            this.watchForClose();\n\n            return this.parent.init(this.buildExports());\n\n        }).then(() => {\n            return this.watchForResize();\n\n        }).catch(err => {\n            this.onError(err);\n        });\n    }\n\n    getHelpers() : ChildHelpers<P> {\n        return {\n            focus:           () => this.focus(),\n            close:           () => this.close(),\n            resize:          ({ width, height }) => this.resize({ width, height }),\n            onError:         (err) => this.onError(err),\n            onProps:         (handler) => this.onProps(handler),\n            getParent:       () => this.parentComponentWindow,\n            getParentDomain: () => this.parentDomain,\n            show:            () => this.show(),\n            hide:            () => this.hide()\n        };\n    }\n\n    show() : ZalgoPromise<void> {\n        return this.parent.show();\n    }\n\n    hide() : ZalgoPromise<void> {\n        return this.parent.hide();\n    }\n\n    checkParentDomain(domain : string) {\n        if (!matchDomain(this.component.allowedParentDomains, domain)) {\n            throw new Error(`Can not be rendered by domain: ${ domain }`);\n        }\n    }\n\n    onProps(handler : Function) {\n        this.onPropHandlers.push(handler);\n    }\n\n    getPropsByRef(parentComponentWindow : CrossDomainWindowType, domain : string, { type, value, uid } : PropRef) : (PropsType<P>) {\n        let props;\n\n        if (type === INITIAL_PROPS.RAW) {\n            props = value;\n        } else if (type === INITIAL_PROPS.UID) {\n            if (!isSameDomain(parentComponentWindow)) {\n                throw new Error(`Parent component window is on a different domain - expected ${ getDomain() } - can not retrieve props`);\n            }\n\n            const global = getGlobal(parentComponentWindow);\n            props = assertExists('props', global && global.props[uid]);\n        }\n\n        if (!props) {\n            throw new Error(`Could not find props`);\n        }\n\n        return deserializeMessage(parentComponentWindow, domain, props);\n    }\n\n    getParentComponentWindow(ref : WindowRef) : CrossDomainWindowType {\n        const { type } = ref;\n    \n        if (type === WINDOW_REFERENCES.OPENER) {\n            return assertExists('opener', getOpener(window));\n    \n        } else if (type === WINDOW_REFERENCES.PARENT && typeof ref.distance === 'number') {\n            return assertExists('parent', getNthParentFromTop(window, ref.distance));\n\n        } else if (type === WINDOW_REFERENCES.GLOBAL && ref.uid && typeof ref.uid === 'string') {\n            const { uid } = ref;\n            const ancestor = getAncestor(window);\n\n            if (!ancestor) {\n                throw new Error(`Can not find ancestor window`);\n            }\n\n            for (const frame of getAllFramesInWindow(ancestor)) {\n                if (isSameDomain(frame)) {\n                    const global = getGlobal(frame);\n\n                    if (global && global.windows && global.windows[uid]) {\n                        return global.windows[uid];\n                    }\n                }\n            }\n        }\n    \n        throw new Error(`Unable to find ${ type } parent component window`);\n    }\n\n    getProps() : PropsType<P> {\n        // $FlowFixMe\n        this.props = this.props || {};\n        return this.props;\n    }\n\n    setProps(props : PropsType<P>, origin : string, isUpdate : boolean = false) {\n        const helpers = this.getHelpers();\n        const existingProps = this.getProps();\n        const normalizedProps = normalizeChildProps(this.parentComponentWindow, this.component, props, origin, helpers, isUpdate);\n\n        extend(existingProps, normalizedProps);\n\n        for (const handler of this.onPropHandlers) {\n            handler.call(this, existingProps);\n        }\n    }\n\n    watchForClose() {\n        window.addEventListener('beforeunload', () => {\n            this.parent.checkClose.fireAndForget();\n        });\n\n        window.addEventListener('unload', () => {\n            this.parent.checkClose.fireAndForget();\n        });\n\n        onCloseWindow(this.parentComponentWindow, () => {\n            this.destroy();\n        });\n    }\n\n    getAutoResize() : { width : boolean, height : boolean, element : ?HTMLElement } {\n        let { width = false, height = false, element = 'body' } = this.autoResize || this.component.autoResize || {};\n        element = getElementSafe(element);\n        return { width, height, element };\n    }\n\n    watchForResize() : ?ZalgoPromise<void> {\n        return waitForDocumentBody().then(() => {\n            const { width, height, element } = this.getAutoResize();\n\n            if (!element || (!width && !height) || this.context === CONTEXT.POPUP) {\n                return;\n            }\n\n            onResize(element, ({ width: newWidth, height: newHeight }) => {\n                this.resize({\n                    width:  width ? newWidth : undefined,\n                    height: height ? newHeight : undefined\n                });\n            }, { width, height });\n        });\n    }\n\n    buildExports() : ChildExportsType<P> {\n\n        const self = this;\n\n        return {\n            updateProps(props : (PropsType<P>)) : ZalgoPromise<void> {\n                return ZalgoPromise.try(() => self.setProps(props, this.__origin__, true));\n            },\n\n            close() : ZalgoPromise<void> {\n                return ZalgoPromise.try(() => self.destroy());\n            }\n        };\n    }\n\n    resize({ width, height } : { width : ?number, height : ?number }) : ZalgoPromise<void> {\n        return this.parent.resize.fireAndForget({ width, height });\n    }\n\n    close() : ZalgoPromise<void> {\n        return this.parent.close();\n    }\n    \n    destroy() : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            window.close();\n        });\n    }\n\n    focus() : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            window.focus();\n        });\n    }\n\n    onError(err : mixed) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            if (this.parent && this.parent.onError) {\n                return this.parent.onError(err);\n            } else {\n                throw err;\n            }\n        });\n    }\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { cleanUpWindow, ProxyWindow, toProxyWindow } from 'post-robot/src';\nimport { assertSameDomain, closeWindow } from 'cross-domain-utils/src';\nimport { iframe, popup, destroyElement, normalizeDimension, watchElementForClose,\n    awaitFrameWindow, uniqueID } from 'belter/src';\n\nimport { CONTEXT } from '../constants';\nimport { getProxyObject, type ProxyObject } from '../lib';\n\n\nexport type ContextDriverType = {|\n    openOnClick : boolean,\n    openFrame? : () => ProxyObject<HTMLIFrameElement>,\n    open : (?ProxyObject<HTMLIFrameElement>) => ZalgoPromise<ProxyWindow>,\n    openPrerenderFrame? : () => ProxyObject<HTMLIFrameElement>,\n    openPrerender : (ProxyWindow, ?ProxyObject<HTMLIFrameElement>) => ZalgoPromise<ProxyWindow>,\n    resize? : ({ width : ?number, height : ?number }) => void,\n    delegate : $ReadOnlyArray<string>\n|};\n\nexport const RENDER_DRIVERS : { [string] : ContextDriverType } = {};\n\nRENDER_DRIVERS[CONTEXT.IFRAME] = {\n    openOnClick: false,\n\n    openFrame() : ProxyObject<HTMLIFrameElement> {\n        return getProxyObject(iframe({\n            attributes: {\n                title: this.component.name,\n                ...this.component.attributes.iframe\n            }\n        }));\n    },\n\n    open(proxyFrame : ?ProxyObject<HTMLIFrameElement>) : ZalgoPromise<ProxyWindow> {\n        if (!proxyFrame) {\n            throw new Error(`Expected proxy frame to be passed`);\n        }\n\n        return proxyFrame.get().then(frame => {\n            return awaitFrameWindow(frame).then(win => {\n\n                const frameWatcher = watchElementForClose(frame, () => this.close());\n                this.clean.register(() => frameWatcher.cancel());\n                this.clean.register(() => destroyElement(frame));\n                this.clean.register(() => cleanUpWindow(win));\n\n                return toProxyWindow(win);\n            });\n        });\n    },\n\n    openPrerenderFrame() : ProxyObject<HTMLIFrameElement> {\n        return getProxyObject(iframe({\n            attributes: {\n                name:  `__zoid_prerender_frame__${ this.component.name }_${ uniqueID() }__`,\n                title: `prerender__${ this.component.name }`,\n                ...this.component.attributes.iframe\n            }\n        }));\n    },\n\n    openPrerender(proxyWin : ProxyWindow, proxyPrerenderFrame : ?ProxyObject<HTMLIFrameElement>) : ZalgoPromise<ProxyWindow> {\n        if (!proxyPrerenderFrame) {\n            throw new Error(`Expected proxy frame to be passed`);\n        }\n        \n        return proxyPrerenderFrame.get().then(prerenderFrame => {\n            this.clean.register(() => destroyElement(prerenderFrame));\n\n            return awaitFrameWindow(prerenderFrame).then(prerenderFrameWindow => {\n                return assertSameDomain(prerenderFrameWindow);\n            }).then(win => {\n                return toProxyWindow(win);\n            });\n        });\n    },\n\n    delegate: [\n        'getProxyContainer',\n        'renderContainer',\n        'openFrame',\n        'openPrerenderFrame',\n        'prerender',\n        'open',\n        'openPrerender',\n        'show',\n        'hide'\n    ]\n};\n\nif (__ZOID__.__POPUP_SUPPORT__) {\n    RENDER_DRIVERS[CONTEXT.POPUP] = {\n        openOnClick: true,\n\n        open() : ZalgoPromise<ProxyWindow> {\n            return ZalgoPromise.try(() => {\n                let { width, height } = this.component.dimensions;\n\n                width = normalizeDimension(width, window.outerWidth);\n                height = normalizeDimension(height, window.outerWidth);\n\n                const win = popup('', {\n                    width,\n                    height,\n                    ...this.component.attributes.popup\n                });\n\n                this.clean.register(() => {\n                    closeWindow(win);\n                    cleanUpWindow(win);\n                });\n\n                return toProxyWindow(win);\n            });\n        },\n\n        openPrerender(proxyWin : ProxyWindow) : ZalgoPromise<ProxyWindow> {\n            return ZalgoPromise.try(() => {\n                return proxyWin;\n            });\n        },\n\n        delegate: [\n            'getProxyContainer',\n            'renderContainer',\n            'setProxyWin',\n            'show',\n            'hide'\n        ]\n    };\n}\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { dotify, isDefined, extend } from 'belter/src';\n\nimport type { Component } from '../component';\nimport type { BuiltInPropsDefinitionType, PropsInputType, PropsType, MixedPropDefinitionType } from '../component/props';\nimport { PROP_SERIALIZATION } from '../constants';\n\nimport type { ParentHelpers } from './index';\n\n/*  Normalize Props\n    ---------------\n\n    Turn props into normalized values, using defaults, function options, etc.\n*/\n\nexport function extendProps<P>(component : Component<P>, props : PropsType<P>, inputProps : PropsInputType<P>, helpers : ParentHelpers<P>, isUpdate : boolean = false) { // eslint-disable-line complexity\n\n    // $FlowFixMe\n    inputProps = inputProps || {};\n    extend(props, inputProps);\n\n    const propNames = isUpdate ? [] : [ ...component.getPropNames() ];\n\n    for (const key of Object.keys(inputProps)) {\n        if (propNames.indexOf(key) === -1) {\n            propNames.push(key);\n        }\n    }\n\n    const aliases = [];\n\n    const { state, close, focus, event, onError } = helpers;\n\n    for (const key of propNames) {\n        const propDef = component.getPropDefinition(key);\n        let value = inputProps[key];\n\n        if (!propDef) {\n            continue;\n        }\n\n        const alias = propDef.alias;\n        if (alias) {\n            if (!isDefined(value) && isDefined(inputProps[alias])) {\n                value = inputProps[alias];\n            }\n            aliases.push(alias);\n        }\n\n        if (propDef.value) {\n            value = propDef.value({ props, state, close, focus, event, onError });\n        }\n\n        if (!isDefined(value) && propDef.default) {\n            value = propDef.default({ props, state, close, focus, event, onError });\n        }\n\n        if (isDefined(value)) {\n            if (propDef.type === 'array' ? !Array.isArray(value) : (typeof value !== propDef.type)) {\n                throw new TypeError(`Prop is not of type ${ propDef.type }: ${ key }`);\n            }\n        }\n        \n        // $FlowFixMe\n        props[key] = value;\n    }\n\n    for (const alias of aliases) {\n        delete props[alias];\n    }\n\n    // $FlowFixMe\n    for (const key of Object.keys(props)) {\n        const propDef = component.getPropDefinition(key);\n        const value = props[key];\n\n        if (!propDef) {\n            continue;\n        }\n\n        if (isDefined(value) && propDef.validate) {\n            // $FlowFixMe\n            propDef.validate({ value, props });\n        }\n\n        if (isDefined(value) && propDef.decorate) {\n            props[key] = propDef.decorate({ value, props, state, close, focus, event, onError });\n        }\n    }\n\n    for (const key of component.getPropNames()) {\n        const propDef = component.getPropDefinition(key);\n        if (propDef.required !== false && !isDefined(props[key])) {\n            throw new Error(`Expected prop \"${ key }\" to be defined`);\n        }\n    }\n}\n\n// $FlowFixMe\nfunction getQueryParam<T, P>(prop : MixedPropDefinitionType<P>, key : string, value : T) : ZalgoPromise<string> {\n    return ZalgoPromise.try(() => {\n        if (typeof prop.queryParam === 'function') {\n            return prop.queryParam({ value });\n        } else if (typeof prop.queryParam === 'string') {\n            return prop.queryParam;\n        } else {\n            return key;\n        }\n    });\n}\n\n// $FlowFixMe\nfunction getQueryValue<T, P>(prop : MixedPropDefinitionType<P>, key : string, value : T) : ZalgoPromise<mixed> {\n    return ZalgoPromise.try(() => {\n        if (typeof prop.queryValue === 'function' && isDefined(value)) {\n            return prop.queryValue({ value });\n        } else {\n            return value;\n        }\n    });\n}\n\nexport function propsToQuery<P>(propsDef : BuiltInPropsDefinitionType<P>, props : (PropsType<P>)) : ZalgoPromise<{ [string] : string }> {\n\n    const params = {};\n\n    // $FlowFixMe\n    const keys = Object.keys(props);\n    \n    return ZalgoPromise.all(keys.map(key => {\n\n        const prop = propsDef[key];\n\n        if (!prop) {\n            return; // eslint-disable-line array-callback-return\n        }\n\n        return ZalgoPromise.resolve().then(() => {\n\n            const value = props[key];\n\n            if (!value) {\n                return;\n            }\n\n            if (!prop.queryParam) {\n                return;\n            }\n\n            return value;\n\n        }).then(value => {\n\n            if (value === null || typeof value === 'undefined') {\n                return;\n            }\n\n            return ZalgoPromise.all([\n                getQueryParam(prop, key, value),\n                getQueryValue(prop, key, value)\n            ]).then(([ queryParam, queryValue ]) => {\n\n                let result;\n\n                if (typeof queryValue === 'boolean') {\n                    result = queryValue.toString();\n                } else if (typeof queryValue === 'string') {\n                    result = queryValue.toString();\n                } else if (typeof queryValue === 'object' && queryValue !== null) {\n\n                    if (prop.serialization === PROP_SERIALIZATION.JSON) {\n                        result = JSON.stringify(queryValue);\n                    } else if (prop.serialization === PROP_SERIALIZATION.BASE64) {\n                        result = btoa(JSON.stringify(queryValue));\n                    } else if (prop.serialization === PROP_SERIALIZATION.DOTIFY || !prop.serialization) {\n                        result = dotify(queryValue, key);\n\n                        for (const dotkey of Object.keys(result)) {\n                            params[dotkey] = result[dotkey];\n                        }\n\n                        return;\n                    }\n\n                } else if (typeof queryValue === 'number') {\n                    result = queryValue.toString();\n                }\n\n                params[queryParam] = result;\n            });\n        });\n\n    })).then(() => {\n        return params;\n    });\n}\n","/* @flow */\n/* eslint max-lines: 0 */\n\nimport { send, bridge, serializeMessage, ProxyWindow, toProxyWindow, type CrossDomainFunctionType } from 'post-robot/src';\nimport { isSameDomain, matchDomain, getDomainFromUrl, isBlankDomain,\n    getDomain, type CrossDomainWindowType,\n    getDistanceFromTop, normalizeMockUrl, assertSameDomain } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { addEventListener, uniqueID, elementReady, writeElementToWindow, eventEmitter, type EventEmitterType,\n    noop, onResize, extendUrl, appendChild, cleanup, type CleanupType, base64encode,\n    once, stringifyError, destroyElement, getElementSafe, showElement, hideElement } from 'belter/src';\n\nimport { ZOID, POST_MESSAGE, CONTEXT, EVENT,\n    INITIAL_PROPS, WINDOW_REFERENCES } from '../constants';\nimport type { Component, onErrorPropType } from '../component';\nimport { getGlobal, getProxyObject, type ProxyObject } from '../lib';\nimport type { PropsInputType, PropsType } from '../component/props';\nimport type { ChildExportsType } from '../child';\nimport type { DimensionsType } from '../types';\n\nimport { RENDER_DRIVERS, type ContextDriverType } from './drivers';\nimport { propsToQuery, extendProps } from './props';\n\nexport type RenderOptionsType<P> = {|\n    uid : string,\n    props : PropsInputType<P>,\n    tag : string,\n    context : string,\n    close : (?string) => ZalgoPromise<void>,\n    focus : () => ZalgoPromise<ProxyWindow>,\n    doc : Document,\n    container? : HTMLElement,\n    dimensions : DimensionsType,\n    state : Object,\n    event : EventEmitterType,\n    frame : ?HTMLIFrameElement,\n    prerenderFrame : ?HTMLIFrameElement\n|};\n\nexport type ParentExportsType<P> = {|\n    init : (ChildExportsType<P>) => ZalgoPromise<void>,\n    close : () => ZalgoPromise<void>,\n    checkClose : CrossDomainFunctionType<[], void>,\n    resize : CrossDomainFunctionType<[{ width? : ?number, height? : ?number }], void>,\n    onError : (mixed) => ZalgoPromise<void>,\n    show : () => ZalgoPromise<void>,\n    hide : () => ZalgoPromise<void>\n|};\n\nexport type PropRef =\n    {| type : typeof INITIAL_PROPS.RAW, uid? : string, value? : string |};\n\nexport type WindowRef =\n    {| type : typeof WINDOW_REFERENCES.OPENER |} |\n    {| type : typeof WINDOW_REFERENCES.PARENT, distance : number |} |\n    {| type : typeof WINDOW_REFERENCES.GLOBAL, uid : string |};\n\nexport type ChildPayload = {|\n    uid : string,\n    tag : string,\n    version : string,\n    context : $Values<typeof CONTEXT>,\n    parentDomain : string,\n    childDomain : string,\n    parent : WindowRef,\n    props : PropRef,\n    exports : string\n|};\n\nexport type StateType = Object;\n\nexport type ParentHelpers<P> = {|\n    state : StateType,\n    close : () => ZalgoPromise<void>,\n    focus : () => ZalgoPromise<void>,\n    resize : ({ width : ?number, height : ?number }) => ZalgoPromise<void>,\n    onError : (mixed) => ZalgoPromise<void>,\n    updateProps : PropsInputType<P> => ZalgoPromise<void>,\n    event : EventEmitterType,\n    show : () => ZalgoPromise<void>,\n    hide : () => ZalgoPromise<void>\n|};\n\nexport class ParentComponent<P> {\n\n    component : Component<P>\n    driver : ContextDriverType\n    clean : CleanupType\n    event : EventEmitterType\n\n    initPromise : ZalgoPromise<void>\n    handledErrors : Array<mixed> // eslint-disable-line flowtype/no-mutable-array\n    \n    props : PropsType<P>\n    state : StateType\n    child : ?ChildExportsType<P>\n\n    proxyContainer : ?ProxyObject<HTMLElement>\n    proxyWin : ?ProxyWindow\n\n    visible : boolean = true\n\n    constructor(component : Component<P>, props : PropsInputType<P>) {\n        this.initPromise = new ZalgoPromise();\n        this.handledErrors = [];\n\n        // $FlowFixMe\n        this.props = {};\n\n        this.clean = cleanup(this);\n        this.state = {};\n\n        this.component = component;\n\n        this.setupEvents(props.onError);\n        this.setProps(props);\n        this.component.registerActiveComponent(this);\n        this.clean.register(() => this.component.destroyActiveComponent(this));\n        this.watchForUnload();\n    }\n\n    setupEvents(onError : ?onErrorPropType) {\n        this.event = eventEmitter();\n        \n        this.event.on(EVENT.RENDER,   () => this.props.onRender());\n        this.event.on(EVENT.DISPLAY,  () => this.props.onDisplay());\n        this.event.on(EVENT.RENDERED, () => this.props.onRendered());\n        this.event.on(EVENT.CLOSE,    () => this.props.onClose());\n        this.event.on(EVENT.RESIZE,   () => this.props.onResize());\n        this.event.on(EVENT.FOCUS,    () => this.props.onFocus());\n        this.event.on(EVENT.PROPS,    (props) => this.props.onProps(props));\n\n        this.event.on(EVENT.ERROR, err => {\n            if (this.props && this.props.onError) {\n                return this.props.onError(err);\n            } else if (onError) {\n                return onError(err);\n            } else {\n                return this.initPromise.reject(err).then(() => {\n                    setTimeout(() => {\n                        throw err;\n                    }, 1);\n                });\n            }\n        });\n    }\n\n    render(target : CrossDomainWindowType, container : string | HTMLElement, context : $Values<typeof CONTEXT>) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            this.component.log(`render`);\n\n            this.driver = RENDER_DRIVERS[context];\n            const uid = `${ ZOID }-${ this.component.tag }-${ uniqueID() }`;\n            const domain = this.getDomain();\n            const childDomain = this.getChildDomain();\n            \n            this.component.checkAllowRender(target, domain, container);\n\n            if (target !== window) {\n                this.delegate(context, target);\n            }\n\n            const init = this.initPromise;\n            const buildUrl = this.buildUrl();\n            const onRender = this.event.trigger(EVENT.RENDER);\n\n            const getProxyContainer = this.getProxyContainer(container);\n\n            const openFrame = this.openFrame();\n            const openPrerenderFrame = this.openPrerenderFrame();\n\n            const renderContainer = ZalgoPromise.hash({ proxyContainer: getProxyContainer, proxyFrame: openFrame, proxyPrerenderFrame: openPrerenderFrame }).then(({ proxyContainer, proxyFrame, proxyPrerenderFrame }) => {\n                return this.renderContainer(proxyContainer, { context, uid, proxyFrame, proxyPrerenderFrame, visible: this.visible });\n            }).then(proxyContainer => {\n                this.proxyContainer = proxyContainer;\n                return proxyContainer;\n            });\n\n            const open = this.driver.openOnClick\n                ? this.open()\n                : openFrame.then(proxyFrame => this.open(proxyFrame));\n\n            const openPrerender = ZalgoPromise.hash({ proxyWin: open, proxyPrerenderFrame: openPrerenderFrame }).then(({ proxyWin, proxyPrerenderFrame }) => {\n                return this.openPrerender(proxyWin, proxyPrerenderFrame);\n            });\n\n            const setState = open.then(proxyWin => {\n                this.proxyWin = proxyWin;\n                return this.setProxyWin(proxyWin);\n            });\n            \n            const prerender = ZalgoPromise.hash({ proxyPrerenderWin: openPrerender, state: setState }).then(({ proxyPrerenderWin }) => {\n                return this.prerender(proxyPrerenderWin, { context, uid });\n            });\n\n            const buildWindowName = open.then(proxyWin => {\n                return this.buildWindowName({ proxyWin, childDomain, domain, target, context, uid });\n            });\n\n            const setWindowName =  ZalgoPromise.hash({ proxyWin: open, windowName: buildWindowName }).then(({ proxyWin, windowName }) => {\n                return proxyWin.setName(windowName);\n            });\n\n            const loadUrl = ZalgoPromise.hash({ proxyWin: open, url: buildUrl, windowName: setWindowName, prerender }).then(({ proxyWin, url }) => {\n                return proxyWin.setLocation(url);\n            });\n\n            const watchForClose = open.then(proxyWin => {\n                this.watchForClose(proxyWin);\n            });\n\n            const onDisplay = ZalgoPromise.hash({ container: renderContainer, prerender }).then(() => {\n                return this.event.trigger(EVENT.DISPLAY);\n            });\n\n            const openBridge = open.then(proxyWin => {\n                return this.openBridge(proxyWin, childDomain, context);\n            });\n\n            const runTimeout = loadUrl.then(() => {\n                return this.runTimeout();\n            });\n\n            const onRendered = init.then(() => {\n                return this.event.trigger(EVENT.RENDERED);\n            });\n\n            return ZalgoPromise.hash({\n                init, buildUrl, onRender, getProxyContainer, openFrame, openPrerenderFrame, renderContainer, open,\n                openPrerender, setState, prerender, loadUrl, buildWindowName, setWindowName, watchForClose, onDisplay,\n                openBridge, runTimeout, onRendered\n            });\n            \n        }).catch(err => {\n            return ZalgoPromise.all([\n                this.onError(err),\n                this.destroy(err)\n            ]).then(() => {\n                throw err;\n            }, () => {\n                throw err;\n            });\n        }).then(noop);\n    }\n\n    getProxyContainer(container : string | HTMLElement) : ZalgoPromise<ProxyObject<HTMLElement>> {\n        return ZalgoPromise.try(() => {\n            return elementReady(container);\n        }).then(containerElement => {\n            return getProxyObject(containerElement);\n        });\n    }\n\n    buildWindowName({ proxyWin, childDomain, domain, target, uid, context } : { proxyWin : ProxyWindow, childDomain : string, domain : string | RegExp, target : CrossDomainWindowType, context : $Values<typeof CONTEXT>, uid : string }) : string {\n        const childPayload = this.buildChildPayload({ proxyWin, childDomain, domain, target, context, uid });\n        return `__${ ZOID }__${ this.component.name }__${ base64encode(JSON.stringify(childPayload)) }__`;\n    }\n\n    getPropsRef(proxyWin : ProxyWindow, childDomain : string, domain : string | RegExp, uid : string) : PropRef {\n        const value = serializeMessage(proxyWin, domain, this.getPropsForChild(domain));\n\n        const propRef = (childDomain === getDomain())\n            ? { type: INITIAL_PROPS.UID, uid }\n            : { type: INITIAL_PROPS.RAW, value };\n\n        if (propRef.type === INITIAL_PROPS.UID) {\n            const global = getGlobal(window);\n            global.props = global.props || {};\n            global.props[uid] = value;\n\n            this.clean.register(() => {\n                delete global.props[uid];\n            });\n        }\n\n        return propRef;\n    }\n\n    buildChildPayload({ proxyWin, childDomain, domain, target = window, context, uid } : { proxyWin : ProxyWindow, childDomain : string, domain : string | RegExp, target : CrossDomainWindowType, context : $Values<typeof CONTEXT>, uid : string } = {}) : ChildPayload {\n        return {\n            uid,\n            context,\n            version:      __ZOID__.__VERSION__,\n            childDomain,\n            parentDomain: getDomain(window),\n            tag:          this.component.tag,\n            parent:       this.getWindowRef(target, childDomain, uid, context),\n            props:        this.getPropsRef(proxyWin, childDomain, domain, uid),\n            exports:      serializeMessage(proxyWin, domain, this.buildParentExports(proxyWin))\n        };\n    }\n\n    setProxyWin(proxyWin : ProxyWindow) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            this.proxyWin = proxyWin;\n        });\n    }\n\n    getHelpers() : ParentHelpers<P> {\n        return {\n            state:       this.state,\n            event:       this.event,\n            close:       () => this.close(),\n            focus:       () => this.focus(),\n            resize:      ({ width, height }) => this.resize({ width, height }),\n            onError:     (err) => this.onError(err),\n            updateProps: (props) => this.updateProps(props),\n            show:        () => this.show(),\n            hide:        () => this.hide()\n        };\n    }\n\n    show() : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            this.visible = true;\n            if (this.proxyContainer) {\n                return this.proxyContainer.get()\n                    .then(showElement);\n            }\n        });\n    }\n\n    hide() : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            this.visible = false;\n            if (this.proxyContainer) {\n                return this.proxyContainer.get()\n                    .then(hideElement);\n            }\n        });\n    }\n\n    setProps(props : PropsInputType<P>, isUpdate : boolean = false) {\n        if (this.component.validate) {\n            this.component.validate({ props });\n        }\n\n        const helpers = this.getHelpers();\n        extendProps(this.component, this.props, props, helpers, isUpdate);\n    }\n\n    buildUrl() : ZalgoPromise<string> {\n        return propsToQuery({ ...this.component.props, ...this.component.builtinProps }, this.props).then(query => {\n            return extendUrl(normalizeMockUrl(this.component.getUrl(this.props)), { query });\n        });\n    }\n\n    getDomain() : string | RegExp {\n        return this.component.getDomain(this.props);\n    }\n\n    getChildDomain() : string {\n        return this.component.getChildDomain(this.props);\n    }\n\n    getPropsForChild(domain : string | RegExp) : (PropsType<P>) {\n        const result = {};\n\n        for (const key of Object.keys(this.props)) {\n            const prop = this.component.getPropDefinition(key);\n\n            if (prop && prop.sendToChild === false) {\n                continue;\n            }\n\n            if (prop && prop.sameDomain && !matchDomain(domain, getDomain(window))) {\n                continue;\n            }\n            \n            result[key] = this.props[key];\n        }\n\n        // $FlowFixMe\n        return result;\n    }\n\n    updateProps(props : PropsInputType<P>) : ZalgoPromise<void> {\n        this.setProps(props, true);\n\n        return this.initPromise.then(() => {\n            if (this.child) {\n                return this.child.updateProps(this.getPropsForChild(this.getDomain())).catch(err => {\n                    if (!this.child || !this.proxyWin) {\n                        return;\n                    }\n\n                    return this.checkClose(this.proxyWin).then(() => {\n                        if (this.child) {\n                            throw err;\n                        }\n                    });\n                });\n            }\n        });\n    }\n\n    openFrame() : ZalgoPromise<?ProxyObject<HTMLIFrameElement>> {\n        return ZalgoPromise.try(() => {\n            if (this.driver.openFrame) {\n                return this.driver.openFrame.call(this);\n            }\n        });\n    }\n\n    openPrerenderFrame() : ZalgoPromise<?ProxyObject<HTMLIFrameElement>> {\n        return ZalgoPromise.try(() => {\n            if (this.driver.openPrerenderFrame) {\n                return this.driver.openPrerenderFrame.call(this);\n            }\n        });\n    }\n    \n    open(proxyFrame : ?ProxyObject<HTMLIFrameElement>) : ZalgoPromise<ProxyWindow> {\n        return ZalgoPromise.try(() => {\n            this.component.log(`open`);\n\n            const windowProp = this.props.window;\n\n            if (windowProp) {\n                this.clean.register(() => windowProp.close());\n                return toProxyWindow(windowProp);\n            }\n\n            return this.driver.open.call(this, proxyFrame);\n\n        }).then(proxyWin => {\n            this.proxyWin = proxyWin;\n            return proxyWin;\n        });\n    }\n\n    openPrerender(proxyWin : ProxyWindow, proxyPrerenderFrame : ?ProxyObject<HTMLIFrameElement>) : ZalgoPromise<ProxyWindow> {\n        return ZalgoPromise.try(() => {\n            return this.driver.openPrerender.call(this, proxyWin, proxyPrerenderFrame);\n        });\n    }\n\n    focus() : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            const proxyWin = this.proxyWin;\n            if (proxyWin) {\n                this.event.trigger(EVENT.FOCUS);\n                return proxyWin.focus().then(noop);\n            }\n        });\n    }\n\n    delegate(context : $Values<typeof CONTEXT>, target : CrossDomainWindowType) {\n        this.component.log(`delegate`);\n\n        const props = {};\n        for (const propName of this.component.getPropNames()) {\n            if (this.component.getPropDefinition(propName).allowDelegate) {\n                props[propName] = this.props[propName];\n            }\n        }\n\n        const overridesPromise = send(target, `${ POST_MESSAGE.DELEGATE }_${ this.component.name }`, {\n            context,\n            props,\n            overrides: {\n                event:   this.event,\n                close:   () => this.close(),\n                onError: (err) => this.onError(err)\n            }\n\n        }).then(({ data }) => {\n            this.clean.register(data.destroy);\n            return data.overrides;\n\n        }).catch(err => {\n            throw new Error(`Unable to delegate rendering. Possibly the component is not loaded in the target window.\\n\\n${ stringifyError(err) }`);\n        });\n\n        for (const key of this.driver.delegate) {\n            // $FlowFixMe\n            this[key] = function overriddenFunction() : ZalgoPromise<mixed> {\n                return overridesPromise.then(overrides => {\n                    return overrides[key].apply(this, arguments);\n                });\n            };\n        }\n    }\n\n    getWindowRef(target : CrossDomainWindowType, domain : string, uid : string, context : $Values<typeof CONTEXT>) : WindowRef {\n        \n        if (domain === getDomain(window)) {\n            const global = getGlobal(window);\n            global.windows = global.windows || {};\n            global.windows[uid] = window;\n            this.clean.register(() => {\n                delete global.windows[uid];\n            });\n    \n            return { type: WINDOW_REFERENCES.GLOBAL, uid };\n        }\n\n        if (context === CONTEXT.POPUP) {\n            return { type: WINDOW_REFERENCES.OPENER };\n        }\n\n        return { type: WINDOW_REFERENCES.PARENT, distance: getDistanceFromTop(window) };\n    }\n\n    watchForClose(proxyWin : ProxyWindow) : ZalgoPromise<void> {\n        let cancelled = false;\n\n        this.clean.register(() => {\n            cancelled = true;\n        });\n\n        return ZalgoPromise.delay(2000).then(() => {\n            return proxyWin.isClosed();\n        }).then(isClosed => {\n            if (isClosed) {\n                this.component.log(`detect_close_child`);\n                return this.close();\n            } else if (!cancelled) {\n                return this.watchForClose(proxyWin);\n            }\n        });\n    }\n\n    watchForUnload() {\n        const unloadWindowListener = addEventListener(window, 'unload', once(() => {\n            this.component.log(`navigate_away`);\n            this.destroy(new Error(`Window navigated away`));\n        }));\n\n        this.clean.register(unloadWindowListener.cancel);\n    }\n\n    runTimeout() : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            const timeout = this.props.timeout;\n\n            if (timeout) {\n                return this.initPromise.timeout(timeout, new Error(`Loading component timed out after ${ timeout } milliseconds`));\n            }\n        });\n    }\n\n    initChild(child : ChildExportsType<P>) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            this.clean.set('child', child);\n            this.initPromise.resolve();\n        });\n    }\n\n    buildParentExports(win : ProxyWindow) : ParentExportsType<P> {\n        const onError    = (err) => this.onError(err);\n        const init       = (child) => this.initChild(child);\n        const close      = () => this.close();\n        const checkClose = () => this.checkClose(win);\n        const resize     = ({ width, height }) => this.resize({ width, height });\n        const show       = () => this.show();\n        const hide       = () => this.hide();\n\n        init.onError = onError;\n\n        return { init, close, checkClose, resize, onError, show, hide };\n    }\n\n    resize({ width, height } : { width? : ?number, height? : ?number }) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            this.event.trigger(EVENT.RESIZE, { width, height });\n        });\n    }\n\n    checkClose(win : ProxyWindow) : ZalgoPromise<void> {\n        return win.isClosed().then(closed => {\n            if (closed) {\n                return this.close();\n            }\n\n            return ZalgoPromise.delay(200)\n                .then(() => win.isClosed())\n                .then(secondClosed => {\n                    if (secondClosed) {\n                        return this.close();\n                    }\n                });\n        });\n    }\n\n    close() : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            this.component.log(`close`);\n            return this.event.trigger(EVENT.CLOSE);\n\n        }).then(() => {\n            if (this.child) {\n                this.child.close.fireAndForget().catch(noop);\n            }\n\n            return this.destroy(new Error(`Window closed`), false);\n        });\n    }\n\n    prerender(proxyPrerenderWin : ProxyWindow, { context, uid } : { context : $Values<typeof CONTEXT>, uid : string }) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            const prerenderTemplate = this.component.prerenderTemplate;\n\n            if (!prerenderTemplate) {\n                return;\n            }\n\n            let prerenderWindow = proxyPrerenderWin.getWindow();\n\n            if (!prerenderWindow || !isSameDomain(prerenderWindow) || !isBlankDomain(prerenderWindow)) {\n                return;\n            }\n\n            prerenderWindow = assertSameDomain(prerenderWindow);\n    \n            const doc = prerenderWindow.document;\n            const el = this.renderTemplate(prerenderTemplate, { context, uid, doc });\n\n            if (!el) {\n                return;\n            }\n\n            if (el.ownerDocument !== doc) {\n                throw new Error(`Expected prerender template to have been created with document from child window`);\n            }\n\n            writeElementToWindow(prerenderWindow, el);\n\n            let { width = false, height = false, element = 'body' } = this.component.autoResize || {};\n            element = getElementSafe(element, doc);\n            \n            if (element && (width || height)) {\n                onResize(element, ({ width: newWidth, height: newHeight }) => {\n                    this.resize({\n                        width:  width ? newWidth : undefined,\n                        height: height ? newHeight : undefined\n                    });\n                }, { width, height, win: prerenderWindow });\n            }\n        });\n    }\n\n    renderTemplate(renderer : (RenderOptionsType<P>) => ?HTMLElement, { context, uid, container, doc, frame, prerenderFrame } : { context : $Values<typeof CONTEXT>, uid : string, container? : HTMLElement, doc : Document, frame? : ?HTMLIFrameElement, prerenderFrame? : ?HTMLIFrameElement }) : ?HTMLElement {\n        // $FlowFixMe\n        return renderer.call(this, {\n            container,\n            context,\n            uid,\n            doc,\n            frame,\n            prerenderFrame,\n            focus:      () => this.focus(),\n            close:      () => this.close(),\n            state:      this.state,\n            props:      this.props,\n            tag:        this.component.tag,\n            dimensions: this.component.dimensions,\n            event:      this.event\n        });\n    }\n\n    renderContainer(proxyContainer : ProxyObject<HTMLElement>, { proxyFrame, proxyPrerenderFrame, context, uid, visible } :\n        { context : $Values<typeof CONTEXT>, uid : string, proxyFrame : ?ProxyObject<HTMLIFrameElement>, proxyPrerenderFrame : ?ProxyObject<HTMLIFrameElement>, visible : boolean }) : ZalgoPromise<?ProxyObject<HTMLElement>> {\n        \n\n        return ZalgoPromise.hash({\n            container:      proxyContainer.get().then(elementReady),\n            // $FlowFixMe\n            frame:          proxyFrame ? proxyFrame.get() : null,\n            // $FlowFixMe\n            prerenderFrame: proxyPrerenderFrame ? proxyPrerenderFrame.get() : null\n        }).then(({ container, frame, prerenderFrame }) => {\n            const innerContainer = this.renderTemplate(this.component.containerTemplate, { context, uid, container, frame, prerenderFrame, doc: document });\n            if (innerContainer) {\n                if (!visible) {\n                    hideElement(innerContainer);\n                }\n                appendChild(container, innerContainer);\n                this.clean.register(() => destroyElement(innerContainer));\n                this.proxyContainer = getProxyObject(innerContainer);\n                return getProxyObject(innerContainer);\n            }\n        });\n    }\n\n    destroy(err? : mixed, trigger? : boolean = true) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            if (!err) {\n                trigger = false;\n                err = new Error('Component destroyed');\n            }\n            this.component.log(`destroy`);\n            return this.onError(err, trigger);\n        }).then(() => {\n            return this.clean.all();\n        });\n    }\n\n    onError(err : mixed, trigger? : boolean = true) : ZalgoPromise<void> {\n        return ZalgoPromise.try(() => {\n            if (this.handledErrors.indexOf(err) !== -1) {\n                return;\n            }\n\n            this.handledErrors.push(err);\n            this.initPromise.asyncReject(err);\n\n            if (trigger) {\n                return this.event.trigger(EVENT.ERROR, err);\n            }\n        });\n    }\n\n    openBridge(proxyWin : ProxyWindow, domain : string, context : $Values<typeof CONTEXT>) : ?ZalgoPromise<?CrossDomainWindowType> {\n        if (__POST_ROBOT__.__IE_POPUP_SUPPORT__) {\n            return ZalgoPromise.try(() => {\n                return proxyWin.awaitWindow();\n                \n            }).then(win => {\n                if (!bridge || !bridge.needsBridge({ win, domain }) || bridge.hasBridge(domain, domain)) {\n                    return;\n                }\n\n                const bridgeUrl = this.component.getBridgeUrl();\n\n                if (!bridgeUrl) {\n                    throw new Error(`Bridge needed to render ${ context }`);\n                }\n\n                const bridgeDomain = getDomainFromUrl(bridgeUrl);\n                bridge.linkUrl(win, domain);\n                return bridge.openBridge(normalizeMockUrl(bridgeUrl), bridgeDomain);\n            });\n        }\n    }\n}\n","/* @flow */\n\nimport { onCloseWindow, type CrossDomainWindowType } from 'cross-domain-utils/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { ProxyWindow } from 'post-robot/src';\nimport { cleanup, type CleanupType, type EventEmitterType } from 'belter/src';\n\nimport { ParentComponent } from '../parent';\nimport { RENDER_DRIVERS, type ContextDriverType } from '../parent/drivers';\nimport type { Component } from '../component';\n\nexport type DelegatePropsType = {|\n    onClose : () => ?ZalgoPromise<void>,\n    onDisplay : () => ?ZalgoPromise<void>,\n    window : ?ProxyWindow\n|};\n\nexport type DelegateOptionsType = {|\n    context : string,\n    props : DelegatePropsType,\n    overrides : {\n        close : () => ZalgoPromise<void>,\n        onError : (mixed) => ZalgoPromise<void>,\n        event : EventEmitterType\n    }\n|};\n\nexport type DelegateReturnType = {|\n    overrides : Object,\n    destroy : () => ZalgoPromise<void>\n|};\n\nexport class DelegateComponent<P>  {\n\n    component : Component<P>\n    source : CrossDomainWindowType\n    context : string\n    driver : ContextDriverType\n    props : DelegatePropsType\n    clean : CleanupType\n\n    focus : () => ZalgoPromise<void>\n    resize : ({ width? : ?number, height? : ?number }) => ZalgoPromise<void>\n    renderTemplate : Function\n\n    close : () => ZalgoPromise<void>\n    onError : (mixed) => ZalgoPromise<void>\n    event : EventEmitterType\n\n    constructor(component : Component<P>, source : CrossDomainWindowType, options : DelegateOptionsType) {\n        this.component = component;\n        this.context = options.context;\n        this.driver = RENDER_DRIVERS[options.context];\n        this.clean = cleanup(this);\n        \n        this.focus = ParentComponent.prototype.focus;\n        this.resize = ParentComponent.prototype.resize;\n        this.renderTemplate = ParentComponent.prototype.renderTemplate;\n\n        // $FlowFixMe\n        this.props = {};\n        \n        for (const propName of Object.keys(options.props)) {\n            const propDef = this.component.getPropDefinition(propName);\n            if (propDef && propDef.allowDelegate && options.props[propName]) {\n                // $FlowFixMe\n                this.props[propName] = options.props[propName];\n            }\n        }\n\n        this.close   = options.overrides.close;\n        this.onError = options.overrides.onError;\n        this.event   = options.overrides.event;\n\n        this.component.registerActiveComponent(this);\n        this.clean.register(() => this.component.destroyActiveComponent(this));\n\n        this.watchForSourceClose(source);\n    }\n\n    getDelegate() : DelegateReturnType {\n        return {\n            overrides: this.getOverrides(),\n            destroy:   () => this.destroy()\n        };\n    }\n\n    watchForSourceClose(source : CrossDomainWindowType) {\n        const closeSourceWindowListener = onCloseWindow(source, () => this.destroy(), 3000);\n        this.clean.register(closeSourceWindowListener.cancel);\n    }\n\n    getOverrides() : { [string] : mixed } {\n        const overrides = {};\n        const self = this;\n\n        for (const key of this.driver.delegate) {\n            overrides[key] = function delegateOverride() : mixed {\n                // $FlowFixMe\n                return ParentComponent.prototype[key].apply(self, arguments);\n            };\n            overrides[key].__name__ = key;\n        }\n\n        return overrides;\n    }\n\n    destroy() : ZalgoPromise<void> {\n        return this.clean.all();\n    }\n}\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","/* @flow */\n/* eslint react/no-deprecated: off, react/no-find-dom-node: off, react/display-name: off, react/no-did-mount-set-state: off, react/destructuring-assignment: off, react/prop-types: off */\n\nimport { extend, noop } from 'belter/src';\n\nimport type { Component, ComponentDriverType } from '../component';\nimport { CONTEXT } from '../constants';\n\ndeclare class ReactClassType {\n\n}\n\ntype ReactElementType = {|\n\n|};\n\ndeclare class __ReactComponent {\n\n}\n\ntype ReactType = {|\n    Component : __ReactComponent,\n    createClass : ({ render : () => ReactElementType, componentDidMount : () => void, componentDidUpdate : () => void }) => (typeof ReactClassType),\n    createElement : (string, ?{ [string] : mixed }, ...children : $ReadOnlyArray<ReactElementType>) => ReactElementType\n|};\n\ntype ReactDomType = {|\n    findDOMNode : (typeof ReactClassType) => HTMLElement\n|};\n\ntype ReactLibraryType = {|\n    React : ReactType,\n    ReactDOM : ReactDomType\n|};\n\nexport const react : ComponentDriverType<*, ReactLibraryType> = {\n\n    register(component : Component<*>, { React, ReactDOM } : ReactLibraryType) : (typeof ReactClassType) {\n\n        // $FlowFixMe\n        return class extends React.Component {\n            render() : ReactElementType {\n                return React.createElement('div', null);\n            }\n\n            componentDidMount() {\n                component.log(`instantiate_react_component`);\n                \n                const el = ReactDOM.findDOMNode(this);\n\n                const parent = component.init(extend({}, this.props));\n                parent.render(el, CONTEXT.IFRAME);\n                this.setState({ parent });\n            }\n\n            componentDidUpdate() {\n\n                if (this.state && this.state.parent) {\n                    this.state.parent.updateProps(extend({}, this.props)).catch(noop);\n                }\n            }\n        };\n    }\n};\n","/* @flow */\n\nimport { noop } from 'belter/src';\n\nimport type { Component, ComponentDriverType } from '../component';\nimport { CONTEXT } from '../constants';\n\ntype VueComponent = {|\n    render : (Function) => Element,\n    inheritAttrs : boolean,\n    mounted : () => void,\n    watch : {|\n        $attrs : {|\n            deep : boolean,\n            handler : () => void\n        |}\n    |}\n|};\n\ntype RegisteredVueComponent = {|\n    \n|};\n\ntype VueType = {|\n    component : (string, VueComponent) => RegisteredVueComponent\n|};\n\nexport const vue : ComponentDriverType<*, VueType> = {\n\n    register<P>(component : Component<P>, Vue : VueType) : RegisteredVueComponent {\n\n        return Vue.component(component.tag, {\n            render(createElement) : Element {\n                return createElement('div');\n            },\n\n            inheritAttrs: false,\n\n            mounted() {\n                const el = this.$el;\n                \n                this.parent = component.init({ ...this.$attrs });\n                this.parent.render(el, CONTEXT.IFRAME);\n            },\n\n            watch: {\n                $attrs: {\n                    handler: function handler() {\n                        if (this.parent && this.$attrs) {\n                            this.parent.updateProps({ ...this.$attrs }).catch(noop);\n                        }\n                    },\n                    deep: true\n                }\n            }\n        });\n    }\n};\n","/* @flow */\n\nimport { dasherizeToCamel, replaceObject, noop } from 'belter/src';\n\nimport type { Component, ComponentDriverType } from '../component';\nimport { CONTEXT } from '../constants';\n\ntype AngularModule = {|\n    directive : (string, () => {\n        scope : { [string] : '=' | '@' },\n        restrict : string,\n        controller : $ReadOnlyArray<string | Function>\n    }) => AngularModule\n|};\n\ntype Angular = {|\n    module : (string, $ReadOnlyArray<string>) => AngularModule\n|};\n\nexport const angular : ComponentDriverType<*, Angular> = {\n\n    register(component : Component<*>, ng : Angular) : AngularModule {\n\n        const module = ng.module(component.tag, []).directive(dasherizeToCamel(component.tag), () => {\n\n            const scope = {};\n\n            for (const key of component.getPropNames()) {\n                scope[key] = '=';\n            }\n\n            scope.props = '=';\n\n            return {\n                scope,\n\n                restrict: 'E',\n\n                controller: [ '$scope', '$element', ($scope, $element) => {\n                    component.log(`instantiate_angular_component`);\n\n                    function safeApply() {\n                        if ($scope.$root.$$phase !== '$apply' && $scope.$root.$$phase !== '$digest') {\n                            try {\n                                $scope.$apply();\n                            } catch (err) {\n                                // pass\n                            }\n                        }\n                    }\n\n                    const getProps = () => {\n                        return replaceObject($scope.props, item => {\n                            if (typeof item === 'function') {\n                                return function angularWrapped() : mixed {\n                                    // $FlowFixMe\n                                    const result = item.apply(this, arguments);\n                                    safeApply();\n                                    return result;\n                                };\n                            }\n                            return item;\n                        });\n                    };\n\n                    const instance = component.init(getProps());\n                    instance.render($element[0], CONTEXT.IFRAME);\n\n                    $scope.$watch(() => {\n                        instance.updateProps(getProps()).catch(noop);\n                    });\n                } ]\n            };\n        });\n\n        return module;\n    }\n};\n","/* @flow */\n/* eslint new-cap: 0 */\n\nimport { replaceObject } from 'belter/src';\n\nimport type { Component, ComponentDriverType } from '../component';\nimport { CONTEXT } from '../constants';\n\ntype Angular2Injection = {||};\n\ntype Angular2Component = {||};\n\ntype Angular2Module = {||};\n\ntype Angular2 = {|\n    Component : ({ selector : string, template : string, inputs : $ReadOnlyArray<string> }) => {\n        Class : ({ constructor : $ReadOnlyArray<Angular2Injection | Function>, ngOnInit : () => void, ngDoCheck : () => void }) => Angular2Component\n    },\n    NgModule : ({ declarations : $ReadOnlyArray<Angular2Component>, exports : $ReadOnlyArray<Angular2Component> }) => {\n        Class : ({ constructor : () => void }) => Angular2Module\n    },\n    ElementRef : Angular2Injection,\n    NgZone : Angular2Injection\n|};\n\nconst equals = (obj1, obj2) => {\n    const checked = {};\n\n    for (const key in obj1) {\n        if (obj1.hasOwnProperty(key)) {\n            checked[key] = true;\n\n            if (obj1[key] !== obj2[key]) {\n                return false;\n            }\n        }\n    }\n\n    for (const key in obj2) {\n        if (!checked[key]) {\n            return false;\n        }\n    }\n\n    return true;\n};\n\nexport const angular2 : ComponentDriverType<*, Angular2> = {\n\n    register(zoid : Component<*>, { Component : AngularComponent, NgModule, ElementRef, NgZone }) : Angular2Module {\n\n        zoid.log('initializing angular2 component');\n\n        const getProps = (component) => {\n            return replaceObject({ ...component.internalProps, ...component.props }, item => {\n                if (typeof item === 'function') {\n                    return function angular2Wrapped() : void {\n                        // $FlowFixMe\n                        return component.zone.run(() => item.apply(this, arguments));\n                    };\n                }\n                return item;\n            });\n        };\n\n        const ComponentInstance =\n            AngularComponent({\n                selector: zoid.tag,\n                template: '<div></div>',\n                inputs:   [ 'props' ]\n            }).Class({\n                constructor: [ ElementRef, NgZone, function angularConstructor(elementRef, zone) {\n                    this._props = {};\n                    this.elementRef = elementRef;\n                    this.zone = zone;\n                } ],\n                ngOnInit () {\n                    const targetElement = this.elementRef.nativeElement;\n                    \n                    this.parent = zoid.init(getProps(this));\n                    this.parent.render(targetElement, CONTEXT.IFRAME);\n                },\n                ngDoCheck() {\n                    if (this.parent && !equals(this._props, this.props)) {\n                        this._props = { ...this.props };\n                        this.parent.updateProps(getProps(this));\n                    }\n                }\n            });\n\n\n        const ModuleInstance = NgModule({\n            declarations: [ ComponentInstance ],\n            exports:      [ ComponentInstance ]\n        }).Class({\n            constructor () {\n                // pass\n            }\n        });\n\n        return ModuleInstance;\n    }\n};\n","/* @flow */\n\nexport * from './react';\nexport * from './vue';\nexport * from './angular';\nexport * from './angular2';\n","/* @flow */\n\nimport { isPerc, isPx, values } from 'belter/src';\n\nimport { CONTEXT, PROP_TYPE } from '../constants';\n\nimport type { ComponentOptionsType } from './index';\n\nfunction validatePropDefinitions<P>(options : ComponentOptionsType<P>) {\n\n    if (options.props && !(typeof options.props === 'object')) {\n        throw new Error(`Expected options.props to be an object`);\n    }\n\n    const PROP_TYPE_LIST = values(PROP_TYPE);\n\n    if (options.props) {\n        for (const key of Object.keys(options.props)) {\n            const prop = options.props[key];\n\n            if (!prop || !(typeof prop === 'object')) {\n                throw new Error(`Expected options.props.${ key } to be an object`);\n            }\n\n            if (!prop.type) {\n                throw new Error(`Expected prop.type`);\n            }\n\n            if (PROP_TYPE_LIST.indexOf(prop.type) === -1) {\n                throw new Error(`Expected prop.type to be one of ${ PROP_TYPE_LIST.join(', ') }`);\n            }\n\n            if (prop.required && prop.default) {\n                throw new Error(`Required prop can not have a default value`);\n            }\n\n            if (prop.type === PROP_TYPE.FUNCTION && prop.queryParam && !prop.queryValue) {\n                throw new Error(`Do not pass queryParam for function prop`);\n            }\n        }\n    }\n}\n\n// eslint-disable-next-line complexity\nexport function validate<P>(options : ?ComponentOptionsType<P>) { // eslint-ignore-line\n\n    if (!options) {\n        throw new Error(`Expected options to be passed`);\n    }\n\n    // eslint-disable-next-line security/detect-unsafe-regex, unicorn/no-unsafe-regex\n    if (!options.tag || !options.tag.match(/^([a-z0-9][a-z0-9-]*)+[a-z0-9]+$/)) {\n        throw new Error(`Invalid options.tag: ${ options.tag }`);\n    }\n\n    validatePropDefinitions(options);\n\n    if (options.dimensions) {\n        if (options.dimensions && !isPx(options.dimensions.width) && !isPerc(options.dimensions.width)) {\n            throw new Error(`Expected options.dimensions.width to be a px or % string value`);\n        }\n\n        if (options.dimensions && !isPx(options.dimensions.height) && !isPerc(options.dimensions.height)) {\n            throw new Error(`Expected options.dimensions.height to be a px or % string value`);\n        }\n    }\n\n    if (options.defaultContext) {\n        if (options.defaultContext !== CONTEXT.IFRAME && options.defaultContext !== CONTEXT.POPUP) {\n            throw new Error(`Unsupported context type: ${ options.defaultContext || 'unknown' }`);\n        }\n    }\n\n    if (!options.url) {\n        throw new Error(`Must pass url`);\n    }\n\n    if (typeof options.url !== 'string' && typeof options.url !== 'function') {\n        throw new TypeError(`Expected url to be string or function`);\n    }\n\n    if (options.prerenderTemplate && typeof options.prerenderTemplate !== 'function') {\n        throw new Error(`Expected options.prerenderTemplate to be a function`);\n    }\n\n    if ((options.containerTemplate || !__ZOID__.__DEFAULT_CONTAINER__) && typeof options.containerTemplate !== 'function') {\n        throw new Error(`Expected options.containerTemplate to be a function`);\n    }\n}\n","/* @flow */\n/* eslint react/react-in-jsx-scope: off */\n\nimport { destroyElement, toCSS } from 'belter/src';\n\nimport { type RenderOptionsType } from '../../parent';\nimport { EVENT } from '../../constants';\n\nconst CLASS = {\n    VISIBLE:   'visible',\n    INVISIBLE: 'invisible'\n};\n\nexport function defaultContainerTemplate<P>({ uid, frame, prerenderFrame, doc, props, event, dimensions : { width, height } } : RenderOptionsType<P>) : ?HTMLElement {\n    if (__ZOID__.__DEFAULT_CONTAINER__) {\n        if (!frame || !prerenderFrame) {\n            return;\n        }\n\n        const div = doc.createElement('div');\n        div.setAttribute('id', uid);\n        const style = doc.createElement('style');\n        if (props.cspNonce) {\n            style.setAttribute('nonce', props.cspNonce);\n        }\n\n        style.appendChild(doc.createTextNode(`\n            #${ uid } {\n                display: inline-block;\n                position: relative;\n                width: ${ width };\n                height: ${ height };\n            }\n\n            #${ uid } > iframe {\n                display: inline-block;\n                position: absolute;\n                width: 100%;\n                height: 100%;\n                top: 0;\n                left: 0;\n                transition: opacity .2s ease-in-out;\n            }\n\n            #${ uid } > iframe.${ CLASS.INVISIBLE } {\n                opacity: 0;\n            }\n\n            #${ uid } > iframe.${ CLASS.VISIBLE } {\n                opacity: 1;\n        }\n        `));\n\n        div.appendChild(frame);\n        div.appendChild(prerenderFrame);\n        div.appendChild(style);\n\n        prerenderFrame.classList.add(CLASS.VISIBLE);\n        frame.classList.add(CLASS.INVISIBLE);\n    \n        event.on(EVENT.RENDERED, () => {\n            prerenderFrame.classList.remove(CLASS.VISIBLE);\n            prerenderFrame.classList.add(CLASS.INVISIBLE);\n    \n            frame.classList.remove(CLASS.INVISIBLE);\n            frame.classList.add(CLASS.VISIBLE);\n    \n            setTimeout(() => {\n                destroyElement(prerenderFrame);\n            }, 1);\n        });\n\n        event.on(EVENT.RESIZE, ({ width: newWidth, height: newHeight }) => {\n            if (typeof newWidth === 'number') {\n                div.style.width = toCSS(newWidth);\n            }\n    \n            if (typeof newHeight === 'number') {\n                div.style.height = toCSS(newHeight);\n            }\n        });\n\n        return div;\n    }\n}\n","/* @flow */\n/* eslint react/react-in-jsx-scope: off */\n\nimport { type RenderOptionsType } from '../../parent';\n\nexport function defaultPrerenderTemplate<P>({ doc, props } : RenderOptionsType<P>) : ?HTMLElement {\n    if (__ZOID__.__DEFAULT_PRERENDER__) {\n        const html = doc.createElement('html');\n        const body = doc.createElement('body');\n        const style = doc.createElement('style');\n        const spinner = doc.createElement('div');\n        spinner.classList.add('spinner');\n\n        if (props.cspNonce) {\n            style.setAttribute('nonce', props.cspNonce);\n        }\n\n        html.appendChild(body);\n        body.appendChild(spinner);\n        body.appendChild(style);\n        style.appendChild(doc.createTextNode(`\n            html, body {\n                width: 100%;\n                height: 100%;\n            }\n\n            .spinner {\n                position: fixed;\n                max-height: 60vmin;\n                max-width: 60vmin;\n                height: 40px;\n                width: 40px;\n                top: 50%;\n                left: 50%;\n                box-sizing: border-box;\n                border: 3px solid rgba(0, 0, 0, .2);\n                border-top-color: rgba(33, 128, 192, 0.8);\n                border-radius: 100%;\n                animation: rotation .7s infinite linear;\n            }\n\n            @keyframes rotation {\n                from {\n                    transform: translateX(-50%) translateY(-50%) rotate(0deg);\n                }\n                to {\n                    transform: translateX(-50%) translateY(-50%) rotate(359deg);\n                }\n            }\n        `));\n\n        return html;\n    }\n}\n","/* @flow */\n\nexport * from './container';\nexport * from './component';\n","/* @flow */\n\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { once, noop, type EventEmitterType } from 'belter/src';\nimport { isWindow, type CrossDomainWindowType, isWindowClosed, isSameDomain } from 'cross-domain-utils/src';\nimport { ProxyWindow, toProxyWindow } from 'post-robot/src';\n\nimport { PROP_SERIALIZATION } from '../constants';\n\nexport type EventHandlerType<T> = (T) => void | ZalgoPromise<void>;\n\nexport type timeoutPropType = number;\nexport type windowPropType = CrossDomainWindowType | ProxyWindow;\nexport type cspNoncePropType = string;\nexport type closePropType = () => ZalgoPromise<void>;\nexport type focusPropType = () => ZalgoPromise<void>;\nexport type resizePropType = ({ width : ?number, height : ?number }) => ZalgoPromise<void>;\n\nexport type onDisplayPropType = EventHandlerType<void>;\nexport type onRenderedPropType = EventHandlerType<void>;\nexport type onRenderPropType = EventHandlerType<void>;\nexport type onClosePropType = EventHandlerType<void>;\nexport type onResizePropType = EventHandlerType<void>;\nexport type onFocusPropType = EventHandlerType<void>;\nexport type onErrorPropType = EventHandlerType<mixed>;\nexport type onPropsPropType<P> = ((PropsType<P>) => void) => void; // eslint-disable-line no-use-before-define\n\nexport type PropsInputType<P> = {\n    timeout? : timeoutPropType,\n    window? : windowPropType,\n    cspNonce? : cspNoncePropType,\n\n    onDisplay? : onDisplayPropType,\n    onRendered? : onRenderedPropType,\n    onRender? : onRenderPropType,\n    onClose? : onClosePropType,\n    onResize? : onResizePropType,\n    onFocus? : onFocusPropType,\n    onError? : onErrorPropType,\n    onProps? : onPropsPropType<P>\n} & P;\n\nexport type PropsType<P> = {|\n    timeout? : timeoutPropType,\n    window? : ?windowPropType,\n    close? : ?closePropType,\n    focus? : ?focusPropType,\n    resize? : ?resizePropType,\n    cspNonce? : ?cspNoncePropType,\n\n    onDisplay : onDisplayPropType,\n    onRendered : onRenderedPropType,\n    onRender : onRenderPropType,\n    onClose : onClosePropType,\n    onResize : onResizePropType,\n    onFocus : onFocusPropType,\n    onError : onErrorPropType,\n    onProps : onPropsPropType<P>\n|} & P;\n\ntype PropDefinitionType<T, P, S : string> = {|\n    type : S,\n    alias? : string,\n    value? : ({|\n        props : P,\n        state : Object,\n        close : () => ZalgoPromise<void>,\n        focus : () => ZalgoPromise<void>,\n        onError : (mixed) => ZalgoPromise<void>,\n        event : EventEmitterType\n    |}) => ?T,\n    default? : ({|\n        props : P,\n        state : Object,\n        close : () => ZalgoPromise<void>,\n        focus : () => ZalgoPromise<void>,\n        onError : (mixed) => ZalgoPromise<void>,\n        event : EventEmitterType\n    |}) => ?T,\n    decorate? : ({|\n        value : T,\n        props : PropsType<P>,\n        state : Object,\n        close : () => ZalgoPromise<void>,\n        focus : () => ZalgoPromise<void>,\n        onError : (mixed) => ZalgoPromise<void>,\n        event : EventEmitterType\n    |}) => T,\n    childDecorate? : ({|\n        value : T,\n        close : () => ZalgoPromise<void>,\n        focus : () => ZalgoPromise<void>,\n        onError : (mixed) => ZalgoPromise<void>,\n        onProps : ((PropsType<P>) => void) => void,\n        resize : ({ width : ?number, height : ?number }) => ZalgoPromise<void>,\n        getParentDomain : () => string,\n        getParent : () => CrossDomainWindowType,\n        show : () => ZalgoPromise<void>,\n        hide : () => ZalgoPromise<void>\n    |}) => ?T,\n    required? : boolean,\n    queryParam? : boolean | string | ({ value : T }) => (string | ZalgoPromise<string>),\n    queryValue? : ({| value : T |}) => (ZalgoPromise<mixed> | mixed),\n    sendToChild? : boolean,\n    allowDelegate? : boolean,\n    validate? : ({| value : T, props : PropsInputType<P> |}) => void,\n    sameDomain? : boolean,\n    serialization? : $Values<typeof PROP_SERIALIZATION>\n|};\n\nexport type BooleanPropDefinitionType<T : boolean, P> = PropDefinitionType<T, P, 'boolean'>;\nexport type StringPropDefinitionType<T : string, P> = PropDefinitionType<T, P, 'string'>;\nexport type NumberPropDefinitionType<T : number, P> = PropDefinitionType<T, P, 'number'>;\nexport type FunctionPropDefinitionType<T : Function, P> = PropDefinitionType<T, P, 'function'>;\nexport type ArrayPropDefinitionType<T : Array<*> | $ReadOnlyArray<*>, P> = PropDefinitionType<T, P, 'array'>; // eslint-disable-line flowtype/no-mutable-array\nexport type ObjectPropDefinitionType<T : Object, P> = PropDefinitionType<T, P, 'object'>;\n\nexport type MixedPropDefinitionType<P> = BooleanPropDefinitionType<*, P> | StringPropDefinitionType<*, P> | NumberPropDefinitionType<*, P> | FunctionPropDefinitionType<*, P> | ObjectPropDefinitionType<*, P> | ArrayPropDefinitionType<*, P>;\n\nexport type UserPropsDefinitionType<P> = {\n    [string] : MixedPropDefinitionType<P>\n};\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type BuiltInPropsDefinitionType<P> = {\n    timeout : NumberPropDefinitionType<timeoutPropType, P>,\n    window : ObjectPropDefinitionType<windowPropType, P>,\n    close : FunctionPropDefinitionType<closePropType, P>,\n    focus : FunctionPropDefinitionType<focusPropType, P>,\n    resize : FunctionPropDefinitionType<resizePropType, P>,\n\n    onDisplay : FunctionPropDefinitionType<onDisplayPropType, P>,\n    onRendered : FunctionPropDefinitionType<onRenderedPropType, P>,\n    onRender : FunctionPropDefinitionType<onRenderPropType, P>,\n    onClose : FunctionPropDefinitionType<onClosePropType, P>,\n    onResize : FunctionPropDefinitionType<onClosePropType, P>,\n    onFocus : FunctionPropDefinitionType<onFocusPropType, P>,\n    onError : FunctionPropDefinitionType<onErrorPropType, P>,\n    onProps : FunctionPropDefinitionType<onPropsPropType<P>, P>\n};\n\nconst defaultNoop = () => noop;\nconst decorateOnce = ({ value }) => once(value);\n\nexport function getBuiltInProps<P>() : BuiltInPropsDefinitionType<P> {\n    return {\n        window: {\n            type:          'object',\n            sendToChild:   false,\n            required:      false,\n            allowDelegate: true,\n            validate({ value } : { value : CrossDomainWindowType | ProxyWindow }) {\n                if (!isWindow(value) && !ProxyWindow.isProxyWindow(value)) {\n                    throw new Error(`Expected Window or ProxyWindow`);\n                }\n\n                if (isWindow(value)) {\n                    // $FlowFixMe\n                    if (isWindowClosed(value)) {\n                        throw new Error(`Window is closed`);\n                    }\n\n                    // $FlowFixMe\n                    if (!isSameDomain(value)) {\n                        throw new Error(`Window is not same domain`);\n                    }\n                }\n            },\n            decorate({ value } : { value : CrossDomainWindowType | ProxyWindow }) : ProxyWindow {\n                return toProxyWindow(value);\n            }\n        },\n\n        timeout: {\n            type:        'number',\n            required:    false,\n            sendToChild: false\n        },\n\n        close: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ close }) => close\n        },\n\n        focus: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ focus }) => focus\n        },\n\n        resize: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ resize }) => resize\n        },\n\n        cspNonce: {\n            type:     'string',\n            required: false\n        },\n\n        getParent: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ getParent }) => getParent\n        },\n\n        getParentDomain: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ getParentDomain }) => getParentDomain\n        },\n\n        show: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ show }) => show\n        },\n\n        hide: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ hide }) => hide\n        },\n\n        onDisplay: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            allowDelegate: true,\n            default:       defaultNoop,\n            decorate:      decorateOnce\n        },\n\n        onRendered: {\n            type:        'function',\n            required:    false,\n            sendToChild: false,\n            default:     defaultNoop,\n            decorate:    decorateOnce\n        },\n\n        onRender: {\n            type:        'function',\n            required:    false,\n            sendToChild: false,\n            default:     defaultNoop,\n            decorate:    decorateOnce\n        },\n\n        onClose: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            allowDelegate: true,\n            default:       defaultNoop,\n            decorate:      decorateOnce\n        },\n\n        onResize: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            allowDelegate: true,\n            default:       defaultNoop\n        },\n\n        onFocus: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            allowDelegate: true,\n            default:       defaultNoop\n        },\n\n        onError: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            childDecorate: ({ onError }) => onError\n        },\n\n        onProps: {\n            type:          'function',\n            required:      false,\n            sendToChild:   false,\n            default:       defaultNoop,\n            childDecorate: ({ onProps }) => onProps\n        }\n    };\n}\n","/* @flow */\n/* eslint max-lines: 0 */\n\nimport { setup as setupPostRobot, on, send, bridge, toProxyWindow, destroy as destroyPostRobot } from 'post-robot/src';\nimport { ZalgoPromise } from 'zalgo-promise/src';\nimport { isWindow, getDomainFromUrl, type CrossDomainWindowType, isSameTopWindow, getDomain, matchDomain, isSameDomain } from 'cross-domain-utils/src';\nimport { isRegex, noop, isElement } from 'belter/src';\n\nimport { ChildComponent, getChildPayload } from '../child';\nimport { ParentComponent, type RenderOptionsType, type ParentHelpers } from '../parent';\nimport { DelegateComponent } from '../delegate';\nimport { CONTEXT, POST_MESSAGE, WILDCARD, DEFAULT_DIMENSIONS } from '../constants';\nimport { react, angular, vue, angular2 } from '../drivers';\nimport { getGlobal, destroyGlobal } from '../lib';\nimport type { CssDimensionsType, StringMatcherType } from '../types';\n\nimport { validate } from './validate';\nimport { defaultContainerTemplate, defaultPrerenderTemplate } from './templates';\nimport { getBuiltInProps, type UserPropsDefinitionType, type BuiltInPropsDefinitionType, type PropsInputType, type PropsType, type MixedPropDefinitionType } from './props';\n\ntype LoggerPayload = { [string] : ?string };\n\n// eslint-disable-next-line flowtype/require-exact-type\ntype Logger = {\n    debug : (event : string, payload? : LoggerPayload) => any, // eslint-disable-line flowtype/no-weak-types\n    info : (event : string, payload? : LoggerPayload) => any, // eslint-disable-line flowtype/no-weak-types\n    warn : (event : string, payload? : LoggerPayload) => any, // eslint-disable-line flowtype/no-weak-types\n    error : (event : string, payload? : LoggerPayload) => any // eslint-disable-line flowtype/no-weak-types\n};\n\n/*  Component\n    ---------\n\n    This is the spec for the component. The idea is, when I call zoid.create(), it will create a new instance\n    of Component with the blueprint needed to set up ParentComponents and ChildComponents.\n\n    This is the one portion of code which is required by -- and shared to -- both the parent and child windows, and\n    contains all of the configuration needed for them to set themselves up.\n*/\n\nexport type ComponentOptionsType<P> = {|\n\n    tag : string,\n\n    url : string | ({ props : PropsType<P> }) => string,\n    domain? : string | RegExp,\n    bridgeUrl? : string,\n\n    props? : UserPropsDefinitionType<P>,\n\n    dimensions? : CssDimensionsType,\n    autoResize? : { width? : boolean, height? : boolean, element? : string },\n\n    allowedParentDomains? : StringMatcherType,\n\n    attributes? : {\n        iframe? : { [string] : string },\n        popup? : { [string] : string }\n    },\n\n    defaultContext? : $Values<typeof CONTEXT>,\n\n    containerTemplate? : (RenderOptionsType<P>) => ?HTMLElement,\n    prerenderTemplate? : (RenderOptionsType<P>) => ?HTMLElement,\n\n    validate? : ({ props : PropsInputType<P> }) => void,\n\n    logger? : Logger\n|};\n\ntype ZoidRenderer = {|\n    render : (container? : string | HTMLElement, context? : $Values<typeof CONTEXT>) => ZalgoPromise<void>,\n    renderTo : (target : CrossDomainWindowType, container? : string, context? : $Values<typeof CONTEXT>) => ZalgoPromise<void>\n|};\n\nexport type ZoidComponentInstance<P> = {| ...ParentHelpers<P>, ...ZoidRenderer |};\n\n// eslint-disable-next-line flowtype/require-exact-type\nexport type ZoidComponent<P> = {\n    (PropsInputType<P>) : ZoidComponentInstance<P>,\n    driver : (string, mixed) => mixed,\n    isChild : () => boolean,\n    xprops? : PropsType<P>,\n    canRenderTo : (CrossDomainWindowType) => ZalgoPromise<boolean>\n};\n\nexport class Component<P> {\n\n    tag : string\n    name : string\n    \n    url : string | ({ props : PropsType<P> }) => string\n    domain : void | string | RegExp\n    bridgeUrl : void | string\n\n    props : UserPropsDefinitionType<P>\n    builtinProps : BuiltInPropsDefinitionType<P>\n\n    dimensions : CssDimensionsType\n    autoResize : void | { width? : boolean, height? : boolean, element? : string }\n\n    allowedParentDomains : StringMatcherType\n\n    defaultContext : $Values<typeof CONTEXT>\n    \n    attributes : {\n        iframe? : { [string] : string },\n        popup? : { [string] : string }\n    }\n\n    containerTemplate : (RenderOptionsType<P>) => ?HTMLElement\n    prerenderTemplate : ?(RenderOptionsType<P>) => ?HTMLElement\n\n    validate : void | ({ props : PropsInputType<P> }) => void\n\n    driverCache : { [string] : mixed }\n\n    xprops : ?PropsType<P>\n\n    logger : Logger\n\n    propNames : $ReadOnlyArray<string>\n\n    constructor(options : ComponentOptionsType<P>) {\n        validate(options);\n\n        // The tag name of the component. Used by some drivers (e.g. angular) to turn the component into an html element,\n        // e.g. <my-component>\n\n        this.tag = options.tag;\n        this.name = this.tag.replace(/-/g, '_');\n\n        this.allowedParentDomains = options.allowedParentDomains || WILDCARD;\n\n        const global = getGlobal();\n        global.components = global.components || {};\n\n        if (global.components[this.tag]) {\n            throw new Error(`Can not register multiple components with the same tag: ${ this.tag }`);\n        }\n\n        // A json based spec describing what kind of props the component accepts. This is used to validate any props before\n        // they are passed down to the child.\n\n        this.builtinProps = getBuiltInProps();\n        this.props = options.props || {};\n\n        // The dimensions of the component, e.g. { width: '300px', height: '150px' }\n\n        const { width = DEFAULT_DIMENSIONS.WIDTH, height = DEFAULT_DIMENSIONS.HEIGHT } = options.dimensions || {};\n        this.dimensions = { width, height };\n\n        this.url = options.url;\n        this.domain = options.domain;\n        this.bridgeUrl = options.bridgeUrl;\n\n        this.attributes = options.attributes || {};\n        this.attributes.iframe = this.attributes.iframe || {};\n        this.attributes.popup = this.attributes.popup || {};\n\n        this.defaultContext = options.defaultContext || CONTEXT.IFRAME;\n\n        this.autoResize = options.autoResize;\n\n        if (options.containerTemplate) {\n            this.containerTemplate = options.containerTemplate;\n        } else if (__ZOID__.__DEFAULT_CONTAINER__) {\n            this.containerTemplate = defaultContainerTemplate;\n        }\n\n        if (options.prerenderTemplate) {\n            this.prerenderTemplate = options.prerenderTemplate;\n        } else if (__ZOID__.__DEFAULT_PRERENDER__) {\n            this.prerenderTemplate = defaultPrerenderTemplate;\n        }\n\n        this.validate = options.validate;\n\n        this.logger = options.logger || {\n            debug: noop,\n            info:  noop,\n            warn:  noop,\n            error: noop\n        };\n\n        this.registerChild();\n        this.listenDelegate();\n\n        global.components[this.tag] = this;\n    }\n\n    getPropNames() : $ReadOnlyArray<string> {\n        if (this.propNames) {\n            return this.propNames;\n        }\n\n        const propNames = Object.keys(this.props);\n        for (const key of Object.keys(this.builtinProps)) {\n            if (propNames.indexOf(key) === -1) {\n                propNames.push(key);\n            }\n        }\n\n        this.propNames = propNames;\n        return propNames;\n    }\n\n    getPropDefinition(name : string) : MixedPropDefinitionType<P> {\n        return this.props[name] || this.builtinProps[name];\n    }\n\n    driver(name : string, dep : mixed) : mixed {\n        if (__ZOID__.__FRAMEWORK_SUPPORT__) {\n            const drivers = { react, angular, vue, angular2 };\n\n            if (!drivers[name]) {\n                throw new Error(`Could not find driver for framework: ${ name }`);\n            }\n    \n            this.driverCache = this.driverCache || {};\n    \n            if (!this.driverCache[name]) {\n                this.driverCache[name] = drivers[name].register(this, dep);\n            }\n    \n            return this.driverCache[name];\n        } else {\n            throw new Error(`Driver support not enabled`);\n        }\n    }\n\n    registerChild() {\n        if (this.isChild()) {\n            if (window.xprops) {\n                throw new Error(`Can not register ${ this.name } as child - can not attach multiple components to the same window`);\n            }\n\n            const child = new ChildComponent(this);\n            window.xprops = this.xprops = child.getProps();\n        }\n    }\n\n    listenDelegate() {\n        on(`${ POST_MESSAGE.ALLOW_DELEGATE }_${ this.name }`, () => {\n            return true;\n        });\n\n        on(`${ POST_MESSAGE.DELEGATE }_${ this.name }`, ({ source, data: { context, props, overrides } }) => {\n            const delegate = new DelegateComponent(this, source, { context, props, overrides });\n            return delegate.getDelegate();\n        });\n    }\n\n    canRenderTo(win : CrossDomainWindowType) : ZalgoPromise<boolean> {\n        return send(win, `${ POST_MESSAGE.ALLOW_DELEGATE }_${ this.name }`).then(({ data }) => {\n            return data;\n        }).catch(() => {\n            return false;\n        });\n    }\n\n    getUrl(props : PropsType<P>) : string {\n        if (typeof this.url === 'function') {\n            return this.url({ props });\n        }\n\n        return this.url;\n    }\n\n    getChildDomain(props : PropsType<P>) : string {\n        if (this.domain && typeof this.domain === 'string') {\n            return this.domain;\n        }\n\n        return getDomainFromUrl(this.getUrl(props));\n    }\n\n    getDomain(props : PropsType<P>) : string | RegExp {\n        if (this.domain && isRegex(this.domain)) {\n            return this.domain;\n        }\n\n        return this.getChildDomain(props);\n    }\n\n    getBridgeUrl() : ?string {\n        if (this.bridgeUrl) {\n            return this.bridgeUrl;\n        }\n    }\n\n    isChild() : boolean {\n        const payload = getChildPayload();\n        return Boolean(payload && payload.tag === this.tag && payload.childDomain === getDomain());\n    }\n\n    getDefaultContainer(context : $Values<typeof CONTEXT>, container? : string | HTMLElement) : string | HTMLElement {\n        if (container) {\n            if (typeof container !== 'string' && !isElement(container)) {\n                throw new TypeError(`Expected string or element selector to be passed`);\n            }\n\n            return container;\n        }\n\n        if (context === CONTEXT.POPUP) {\n            return 'body';\n        }\n\n        throw new Error(`Expected element to be passed to render iframe`);\n    }\n\n    getDefaultContext(context : ?$Values<typeof CONTEXT>, props : PropsInputType<P>) : ZalgoPromise<$Values<typeof CONTEXT>> {\n        return ZalgoPromise.try(() => {\n            if (props.window) {\n                return toProxyWindow(props.window).getType();\n            }\n    \n            if (context) {\n                if (context !== CONTEXT.IFRAME && context !== CONTEXT.POPUP) {\n                    throw new Error(`Unrecognized context: ${ context }`);\n                }\n                \n                return context;\n            }\n    \n            return this.defaultContext;\n        });\n    }\n\n    init(props : PropsInputType<P>) : ZoidComponentInstance<P> {\n\n        // $FlowFixMe\n        props = props || {};\n        \n        const parent = new ParentComponent(this, props);\n\n        const render = (target, container, context) => {\n            return ZalgoPromise.try(() => {\n                if (!isWindow(target)) {\n                    throw new Error(`Must pass window to renderTo`);\n                }\n\n                return this.getDefaultContext(context, props);\n                \n            }).then(finalContext => {\n                container = this.getDefaultContainer(finalContext, container);\n                return parent.render(target, container, finalContext);\n            });\n        };\n\n        return {\n            ...parent.getHelpers(),\n            render:   (container, context) => render(window, container, context),\n            renderTo: (target, container, context) => render(target, container, context)\n        };\n    }\n\n    checkAllowRender(target : CrossDomainWindowType, domain : string | RegExp, container : string | HTMLElement) {\n        if (target === window) {\n            return;\n        }\n\n        if (!isSameTopWindow(window, target)) {\n            throw new Error(`Can only renderTo an adjacent frame`);\n        }\n\n        const origin = getDomain();\n\n        if (!matchDomain(domain, origin) && !isSameDomain(target)) {\n            throw new Error(`Can not render remotely to ${ domain.toString() } - can only render to ${ origin }`);\n        }\n\n        if (container && typeof container !== 'string') {\n            throw new Error(`Container passed to renderTo must be a string selector, got ${ typeof container } }`);\n        }\n    }\n\n    log(event : string, payload? : LoggerPayload) {\n        this.logger.info(`${ this.name }_${ event }`, payload);\n    }\n\n    registerActiveComponent<Q>(instance : ParentComponent<Q> | DelegateComponent<Q>) {\n        const global = getGlobal();\n        global.activeComponents = global.activeComponents || [];\n        global.activeComponents.push(instance);\n    }\n\n    destroyActiveComponent<Q>(instance : ParentComponent<Q> | DelegateComponent<Q>) {\n        const global = getGlobal();\n        global.activeComponents = global.activeComponents || [];\n        global.activeComponents.splice(global.activeComponents.indexOf(instance), 1);\n    }\n}\n\nexport type ComponentDriverType<P, T : mixed> = {|\n    register : (Component<P>, T) => mixed\n|};\n\nexport function create<P>(options : ComponentOptionsType<P>) : ZoidComponent<P> {\n    setupPostRobot();\n\n    const component : Component<P> = new Component(options);\n\n    const init = (props) => component.init(props);\n    init.driver = (name, dep) => component.driver(name, dep);\n    init.isChild = () => component.isChild();\n    init.canRenderTo = (win) => component.canRenderTo(win);\n    init.xprops = component.xprops;\n    \n    return init;\n}\n\nexport function destroyAll() : ZalgoPromise<void> {\n    if (bridge) {\n        bridge.destroyBridges();\n    }\n\n    const results = [];\n\n    const global = getGlobal();\n    global.activeComponents = global.activeComponents || [];\n    while (global.activeComponents.length) {\n        results.push(global.activeComponents[0].destroy(new Error(`zoid destroyed all`), false));\n    }\n\n    return ZalgoPromise.all(results).then(noop);\n}\n\nexport const destroyComponents = destroyAll;\n\nexport function destroy() {\n    destroyAll();\n    destroyGlobal();\n    destroyPostRobot();\n}\n","/* @flow */\n\nexport * from './component';\nexport * from './props';\n","/* @flow */\n\nexport { PopupOpenError } from 'belter/src';\nexport { create, destroy, destroyComponents, destroyAll, Component } from './component';\nexport type { ZoidComponent, ZoidComponentInstance } from './component';\nexport type { RenderOptionsType } from './parent';\nexport { PROP_TYPE, PROP_SERIALIZATION, CONTEXT, EVENT } from './constants';\n","/* @flow */\n/** @jsx node */\n\nimport { destroyElement, toCSS, toNum } from \"belter/src/index\";\nimport { EVENT, type RenderOptionsType } from \"zoid/src/index\";\n\nconst CLASS = {\n  OUTLET: \"outlet\",\n  VISIBLE: \"visible\",\n  INVISIBLE: \"invisible\",\n  COMPONENT_FRAME: \"component-frame\",\n  PRERENDER_FRAME: \"prerender-frame\"\n};\n\nexport function containerTemplate<P>({\n  uid,\n  frame,\n  props,\n  prerenderFrame,\n  doc,\n  event\n}: RenderOptionsType<P>): ?HTMLElement {\n  if (!frame || !prerenderFrame) {\n    return;\n  }\n\n  const div = doc.createElement(\"div\");\n  div.setAttribute(\"id\", uid);\n  div.classList.add(\"mcs-chat\");\n  const style = doc.createElement(\"style\");\n  if (props.cspNonce) {\n    style.setAttribute(\"nonce\", props.cspNonce);\n  }\n\n  style.appendChild(\n    doc.createTextNode(`\n      #${uid} {\n        z-index: 2147483000;\n        position: fixed;\n        overflow: hidden;\n        min-width: 68px;\n        max-width: 400px;\n        min-height: 68px;\n        max-height: calc(100% - 40px);\n        right: 0;\n        bottom: 0;\n        -webkit-transition:350ms cubic-bezier(.25,.1,0,1);\n        transition:350ms cubic-bezier(.25,.1,0,1);\n      }\n      #${uid} > iframe {\n        display: inline-block;\n        position: absolute;\n        width: 100%;\n        height: 100%;\n        top: 0;\n        left: 0;\n        transition: opacity .2s ease-in-out;\n        margin: 0;\n      }\n      #${uid} > iframe:not(:first-of-type) {\n        width: 100%;\n        position: absolute;\n        bottom: 0;\n        overflow: hidden;\n        display: flex;\n        pointer-events: none;\n      }\n      #${uid} > iframe.${CLASS.INVISIBLE} {\n        opacity: 0;\n      }\n      #${uid} > iframe.${CLASS.VISIBLE} {\n        opacity: 1;\n      }\n      @media (min-device-width: 320px) and (max-device-width: 480px) {\n        #${uid} {\n          width: 100px;\n          height: 100px;\n          min-width: 100px;\n          max-width: 100%;\n          min-height: 100px;\n          max-height: 100%;\n          border-radius: 0;\n        }\n        .mcs-chat > iframe {\n          bottom: 0;\n          right: 0;\n          width: auto;\n          height: auto;\n        }\n      }\n      @media (min-device-width: 768px) and (max-device-width: 1024px) {\n        #${uid} {\n          width: 100px;\n          height: 100px;\n          min-width: 100px;\n          max-width: 100%;\n          min-height: 100px;\n          max-height: 100%;\n          border-radius: 0;\n        }\n        .mcs-chat > iframe {\n          bottom: 0;\n          right: 0;\n          width: auto;\n          height: auto;\n        }\n      }\n      @media (min-width: 768px) and (max-width: 1024px) {\n        #${uid} {\n          width: 100px;\n          height: 100px;\n          min-width: 100px;\n          max-width: 100%;\n          min-height: 100px;\n          max-height: 100%;\n          border-radius: 0;\n        }\n        .mcs-chat > iframe {\n          bottom: 0;\n          right: 0;\n          width: auto;\n          height: auto;\n        }\n      }\n      `)\n  );\n\n  div.appendChild(frame);\n  div.appendChild(prerenderFrame);\n  div.appendChild(style);\n\n  prerenderFrame.classList.add(CLASS.VISIBLE);\n  frame.classList.add(CLASS.INVISIBLE);\n\n  event.on(EVENT.RENDERED, () => {\n    prerenderFrame.classList.remove(CLASS.VISIBLE);\n    prerenderFrame.classList.add(CLASS.INVISIBLE);\n\n    frame.classList.remove(CLASS.INVISIBLE);\n    frame.classList.add(CLASS.VISIBLE);\n\n    setTimeout(() => {\n      destroyElement(prerenderFrame);\n    }, 1);\n  });\n\n  event.on(EVENT.RESIZE, ({ height: newHeight, width: newWidth }) => {\n    if (newHeight) {\n      div.style.height = toCSS(newHeight);\n    }\n\n    if (newWidth) {\n      div.style.width = toCSS(newWidth);\n    }\n\n    // to lock parent body scroll when webchat is open\n    if (\n      navigator.userAgent.match(\n        /Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i\n      )\n    ) {\n      const numInPixel = toCSS(newWidth);\n      const num = toNum(numInPixel);\n      if (num > 300) {\n        doc.body.style.overflow = \"hidden\";\n      } else {\n        doc.body.style.overflow = \"visible\";\n      }\n    }\n  });\n\n  return div;\n}\n","/* @flow */\n\nimport { create } from \"zoid/src/index\";\n\nimport { containerTemplate } from \"./template\";\n// import { playAlertSound } from \"./utils\";\n\nexport const Chat = create({\n  tag: \"mcs-whatsapp\",\n\n  url: ({ props }) => {\n    return {\n      mobileLocal: `http://${__LOCAL_MOBILE_URL__}:3000`,\n      local: `http://localhost:3000`,\n      production: `https://c.mcstech.dev`\n    }[props.env];\n  },\n\n  attributes: {\n    iframe: {\n      scrolling: \"no\"\n    }\n  },\n\n  autoResize: {\n    width: true,\n    height: true,\n    element: \".mcs-chat\"\n  },\n\n  props: {\n    env: {\n      type: \"string\",\n      default: () => \"production\"\n    },\n    phoneNumber: {\n      type: \"string\",\n      required: false,\n      default: () => \"+6012345678\"\n    },\n    chatHeader: {\n      type: \"object\",\n      required: false,\n      default: () => ({\n        chatHeader: {\n          name: \"Chlo\",\n          caption: \"Typically replies within a day\",\n          avatar:\n            \"https://i.pinimg.com/originals/24/d0/75/24d0752430c3cec6d08b605b66c27315.jpg\"\n        }\n      })\n    },\n    welcomeMessage: {\n      type: \"object\",\n      required: false,\n      default: ({ props }) => ({\n        author: props.chatHeader.name,\n        message: \"Hi there, <br />How can I help you?\",\n        timestamp: Date.now()\n      })\n    },\n    layout: {\n      type: \"object\",\n      required: false,\n      default: () => ({ layout: { web: \"MB2\", mobile: \"discreet\" } })\n    }\n  },\n\n  defaultContext: __DEFAULT_CONTEXT__,\n\n  containerTemplate\n});\n","/* @flow */\n\nexport * from './chat';\n"],"sourceRoot":""}